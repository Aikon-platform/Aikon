var regionList=function(){"use strict";function e(){}const t=e=>e;function n(e){return e()}function s(){return Object.create(null)}function i(e){e.forEach(n)}function r(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let l;function a(e,t){return l||(l=document.createElement("a")),l.href=t,e===l.href}function c(t,...n){if(null==t)return e;const s=t.subscribe(...n);return s.unsubscribe?()=>s.unsubscribe():s}function u(e){let t;return c(e,(e=>t=e))(),t}function d(e,t,n){e.$$.on_destroy.push(c(t,n))}function p(e,t,n,s){if(e){const i=g(e,t,n,s);return e[0](i)}}function g(e,t,n,s){return e[1]&&s?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](s(t))):n.ctx}function f(e,t,n,s){if(e[2]&&s){const i=e[2](s(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let s=0;s<n;s+=1)e[s]=t.dirty[s]|i[s];return e}return t.dirty|i}return t.dirty}function m(e,t,n,s,i,r){if(i){const o=g(t,n,s,r);e.p(o,i)}}function h(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}const $="undefined"!=typeof window;let b=$?()=>window.performance.now():()=>Date.now(),w=$?e=>requestAnimationFrame(e):e;const y=new Set;function v(e){y.forEach((t=>{t.c(e)||(y.delete(t),t.f())})),0!==y.size&&w(v)}function k(e,t){e.appendChild(t)}function x(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function L(e){const t=R("style");return function(e,t){k(e.head||e,t),t.sheet}(x(e),t),t.sheet}function C(e,t,n){e.insertBefore(t,n||null)}function I(e){e.parentNode&&e.parentNode.removeChild(e)}function S(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function R(e){return document.createElement(e)}function O(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function P(e){return document.createTextNode(e)}function E(){return P(" ")}function _(){return P("")}function N(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function T(e){return function(t){return t.preventDefault(),e.call(this,t)}}function j(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function q(e,t){t=""+t,e.data!==t&&(e.data=t)}function A(e,t,n,s){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,s?"important":"")}function M(e,t,n){e.classList[n?"add":"remove"](t)}function V(e,t,{bubbles:n=!1,cancelable:s=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(e,n,s,t),i}const U=new Map;let z,F=0;function B(e,t,n,s,i,r,o,l=0){const a=16.666/s;let c="{\n";for(let e=0;e<=1;e+=a){const s=t+(n-t)*r(e);c+=100*e+`%{${o(s,1-s)}}\n`}const u=c+`100% {${o(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${l}`,p=x(e),{stylesheet:g,rules:f}=U.get(p)||function(e,t){const n={stylesheet:L(t),rules:{}};return U.set(e,n),n}(p,e);f[d]||(f[d]=!0,g.insertRule(`@keyframes ${d} ${u}`,g.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${d} ${s}ms linear ${i}ms 1 both`,F+=1,d}function D(e,t){const n=(e.style.animation||"").split(", "),s=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),i=n.length-s.length;i&&(e.style.animation=s.join(", "),F-=i,F||w((()=>{F||(U.forEach((e=>{const{ownerNode:t}=e.stylesheet;t&&I(t)})),U.clear())})))}function H(e){z=e}function J(){if(!z)throw new Error("Function called outside component initialization");return z}const K=[],X=[];let Q=[];const G=[],Z=Promise.resolve();let W=!1;function Y(e){Q.push(e)}const ee=new Set;let te,ne=0;function se(){if(0!==ne)return;const e=z;do{try{for(;ne<K.length;){const e=K[ne];ne++,H(e),ie(e.$$)}}catch(e){throw K.length=0,ne=0,e}for(H(null),K.length=0,ne=0;X.length;)X.pop()();for(let e=0;e<Q.length;e+=1){const t=Q[e];ee.has(t)||(ee.add(t),t())}Q.length=0}while(K.length);for(;G.length;)G.pop()();W=!1,ee.clear(),H(e)}function ie(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Y)}}function re(e,t,n){e.dispatchEvent(V(`${t?"intro":"outro"}${n}`))}const oe=new Set;let le;function ae(){le={r:0,c:[],p:le}}function ce(){le.r||i(le.c),le=le.p}function ue(e,t){e&&e.i&&(oe.delete(e),e.i(t))}function de(e,t,n,s){if(e&&e.o){if(oe.has(e))return;oe.add(e),le.c.push((()=>{oe.delete(e),s&&(n&&e.d(1),s())})),e.o(t)}else s&&s()}const pe={duration:0};function ge(n,s,o,l){const a={direction:"both"};let c=s(n,o,a),u=l?0:1,d=null,p=null,g=null;function f(){g&&D(n,g)}function m(e,t){const n=e.b-u;return t*=Math.abs(n),{a:u,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function h(s){const{delay:r=0,duration:o=300,easing:l=t,tick:a=e,css:h}=c||pe,$={start:b()+r,b:s};s||($.group=le,le.r+=1),d||p?p=$:(h&&(f(),g=B(n,u,s,o,r,l,h)),s&&a(0,1),d=m($,o),Y((()=>re(n,s,"start"))),function(e){let t;0===y.size&&w(v),new Promise((n=>{y.add(t={c:e,f:n})}))}((e=>{if(p&&e>p.start&&(d=m(p,o),p=null,re(n,d.b,"start"),h&&(f(),g=B(n,u,d.b,d.duration,0,l,c.css))),d)if(e>=d.end)a(u=d.b,1-u),re(n,d.b,"end"),p||(d.b?f():--d.group.r||i(d.group.c)),d=null;else if(e>=d.start){const t=e-d.start;u=d.a+d.d*l(t/d.duration),a(u,1-u)}return!(!d&&!p)})))}return{run(e){r(c)?(te||(te=Promise.resolve(),te.then((()=>{te=null}))),te).then((()=>{c=c(a),h(e)})):h(e)},end(){f(),d=p=null}}}function fe(e,t){const n=t.token={};function s(e,s,i,r){if(t.token!==n)return;t.resolved=r;let o=t.ctx;void 0!==i&&(o=o.slice(),o[i]=r);const l=e&&(t.current=e)(o);let a=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==s&&e&&(ae(),de(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),ce())})):t.block.d(1),l.c(),ue(l,1),l.m(t.mount(),t.anchor),a=!0),t.block=l,t.blocks&&(t.blocks[s]=l),a&&se()}if(!(i=e)||"object"!=typeof i&&"function"!=typeof i||"function"!=typeof i.then){if(t.current!==t.then)return s(t.then,1,t.value,e),!0;t.resolved=e}else{const n=J();if(e.then((e=>{H(n),s(t.then,1,t.value,e),H(null)}),(e=>{if(H(n),s(t.catch,2,t.error,e),H(null),!t.hasCatch)throw e})),t.current!==t.pending)return s(t.pending,0),!0}var i}function me(e,t,n){const s=t.slice(),{resolved:i}=e;e.current===e.then&&(s[e.value]=i),e.current===e.catch&&(s[e.error]=i),e.block.p(s,n)}function he(e,t){de(e,1,1,(()=>{t.delete(e.key)}))}function $e(e,t,n,s,r,o,l,a,c,u,d,p){let g=e.length,f=o.length,m=g;const h={};for(;m--;)h[e[m].key]=m;const $=[],b=new Map,w=new Map,y=[];for(m=f;m--;){const e=p(r,o,m),i=n(e);let a=l.get(i);a?s&&y.push((()=>a.p(e,t))):(a=u(i,e),a.c()),b.set(i,$[m]=a),i in h&&w.set(i,Math.abs(m-h[i]))}const v=new Set,k=new Set;function x(e){ue(e,1),e.m(a,d),l.set(e.key,e),d=e.first,f--}for(;g&&f;){const t=$[f-1],n=e[g-1],s=t.key,i=n.key;t===n?(d=t.first,g--,f--):b.has(i)?!l.has(s)||v.has(s)?x(t):k.has(i)?g--:w.get(s)>w.get(i)?(k.add(s),x(t)):(v.add(i),g--):(c(n,l),g--)}for(;g--;){const t=e[g];b.has(t.key)||c(t,l)}for(;f;)x($[f-1]);return i(y),$}function be(e){e&&e.c()}function we(e,t,s,o){const{fragment:l,after_update:a}=e.$$;l&&l.m(t,s),o||Y((()=>{const t=e.$$.on_mount.map(n).filter(r);e.$$.on_destroy?e.$$.on_destroy.push(...t):i(t),e.$$.on_mount=[]})),a.forEach(Y)}function ye(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];Q.forEach((s=>-1===e.indexOf(s)?t.push(s):n.push(s))),n.forEach((e=>e())),Q=t}(n.after_update),i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ve(e,t){-1===e.$$.dirty[0]&&(K.push(e),W||(W=!0,Z.then(se)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ke(t,n,r,o,l,a,c,u=[-1]){const d=z;H(t);const p=t.$$={fragment:null,ctx:[],props:a,update:e,not_equal:l,bound:s(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(d?d.$$.context:[])),callbacks:s(),dirty:u,skip_bound:!1,root:n.target||d.$$.root};c&&c(p.root);let g=!1;if(p.ctx=r?r(t,n.props||{},((e,n,...s)=>{const i=s.length?s[0]:n;return p.ctx&&l(p.ctx[e],p.ctx[e]=i)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](i),g&&ve(t,e)),n})):[],p.update(),g=!0,i(p.before_update),p.fragment=!!o&&o(p.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);p.fragment&&p.fragment.l(e),e.forEach(I)}else p.fragment&&p.fragment.c();n.intro&&ue(t.$$.fragment),we(t,n.target,n.anchor,n.customElement),se()}H(d)}class xe{$destroy(){ye(this,1),this.$destroy=e}$on(t,n){if(!r(n))return e;const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(n),()=>{const e=s.indexOf(n);-1!==e&&s.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Le=[];function Ce(t,n=e){let s;const i=new Set;function r(e){if(o(t,e)&&(t=e,s)){const e=!Le.length;for(const e of i)e[1](),Le.push(e,t);if(e){for(let e=0;e<Le.length;e+=2)Le[e][0](Le[e+1]);Le.length=0}}}return{set:r,update:function(e){r(e(t))},subscribe:function(o,l=e){const a=[o,l];return i.add(a),1===i.size&&(s=n(r)||e),o(t),()=>{i.delete(a),0===i.size&&s&&(s(),s=null)}}}}function Ie(t,n,s){const o=!Array.isArray(t),l=o?[t]:t,a=n.length<2;return u=t=>{let s=!1;const u=[];let d=0,p=e;const g=()=>{if(d)return;p();const s=n(o?u[0]:u,t);a?t(s):p=r(s)?s:e},f=l.map(((e,t)=>c(e,(e=>{u[t]=e,d&=~(1<<t),s&&g()}),(()=>{d|=1<<t}))));return s=!0,g(),function(){i(f),p(),s=!1}},{subscribe:Ce(s,u).subscribe};var u}const Se=Ce(!1);async function Re(e){Se.set(!0);try{return await e()}finally{Se.set(!1)}}function Oe(e=null,t="full",n="full"){if(!e)return"https://via.placeholder.com/96x96?text=No+Image";if((e=e.split("_")).length<3)return"https://via.placeholder.com/96x96?text=No+Image";const s=e[e.length-1].includes(",")?e.pop().replace(".jpg",""):t,i=e.join("_").replace(".jpg","");return`${CANTALOUPE_APP_URL??"http://localhost:8182"}/iiif/2/${i}.jpg/${s}/${n}/0/default.jpg`}function Pe(e=null,t=1){return`${SAS_APP_URL??"http://localhost:3000"}/index.html?iiif-content=${e}&canvas=${t}`}function Ee(e,t=null,n=!1){return new Promise((s=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:s(void 0),t&&(document.getElementById("modal-title").textContent=t),document.getElementById("modal-body").textContent=e,document.getElementById("hidden-msg-btn").click();const i=document.getElementById("cancel-btn"),r=document.getElementById("ok-btn"),o=document.getElementById("modal-bkg"),l=()=>{i.removeEventListener("click",a),o.removeEventListener("click",a),r.removeEventListener("click",c),document.getElementById("modal-footer").hidden=!0},a=()=>{l(),s(!1)},c=()=>{l(),s(!0)};i.addEventListener("click",a),r.addEventListener("click",c)}else n?s(window.confirm(e)):(window.alert(e),s(void 0))}))}const _e="Regions";const Ne=function(){const e=Ce(JSON.parse(localStorage.getItem("documentSet"))||{}),{subscribe:t,get:n,update:s}=e;function i(e){localStorage.setItem("documentSet",JSON.stringify(e))}function r(e,t=!0){return t?e[_e]??{}:Object.entries(e).filter((([e,t])=>e!==_e))}function o(e,t,n){if(e[n]){const{[t]:s,...i}=e[n];e={...e,[n]:i}}return i(e),e}function l(e,t){return e.hasOwnProperty(t.type)||(e[t.type]={}),e[t.type]={...e[t.type],[t.id]:t},i(e),e}return{subscribe:t,save:()=>s((e=>(console.log(e),e))),empty:e=>s((t=>(e?delete t[_e]:Object.keys(t).forEach((e=>{e!==_e&&delete t[e]})),i(t),t))),addAll:e=>s((t=>function(e,t){return t.forEach((t=>{e[t.type]||(e[t.type]={}),e[t.type][t.id]=t})),i(e),e}(t,e))),removeAll:(e,t)=>s((n=>function(e,t,n){return e[n]?(t.forEach((t=>{delete e[n][t]})),i(e),e):e}(n,e,t))),remove:(e,t)=>s((n=>o(n,e,t))),add:e=>s((t=>l(t,e))),toggle:e=>s((t=>t[e.type]?.[e.id]?o(t,e.id,e.type):l(t,e))),toggleAll:(e,t,n)=>s((e=>{})),isSelected:Ie(e,(e=>t=>e[t.type]?.hasOwnProperty(t.id)||!1)),selected:Ie(e,(e=>t=>r(e,t))),nbSelected:Ie(e,(e=>t=>{const n=r(e,t);return t?Object.keys(n).length:n.reduce(((e,[t,n])=>e+Object.keys(n).length),0)}))}}();const Te=function(){const e=Ce(1),t=Ce({}),n=Ce({}),s=`${window.location.origin}${window.location.pathname}`;if("undefined"!=typeof window){const t=new URLSearchParams(window.location.search).get("p");t&&e.set(parseInt(t))}const i=(async()=>{const e=await fetch(`${s}canvas`),n=await e.json();let i={};return Object.values(n).forEach((e=>{Object.entries(e).forEach((([e,t])=>{i[e]=t}))})),t.set(i),n})(),r=Ie(e,(e=>(async()=>{const t=await fetch(`${s}canvas?p=${e}`),i=await t.json();return n.set(i),i})()));return{currentPage:e,pageRegions:n,allRegions:t,fetchPages:r,fetchAll:i,handlePageUpdate:function(t){if(e.set(t),"undefined"!=typeof window){const e=new URL(window.location.href);e.searchParams.set("p",t),window.history.pushState({},"",e)}},remove:function(e){t.update((t=>(delete t[e],{...t}))),n.update((t=>{for(const n in t)if(t[n][e]){const{[e]:s,...i}=t[n];return t[n]=i,t}return t}))}}}();function je(e,{delay:n=0,duration:s=400,easing:i=t}={}){const r=+getComputedStyle(e).opacity;return{delay:n,duration:s,easing:i,css:e=>"opacity: "+e*r}}function qe(e){let t,n,s;return{c(){t=R("div"),t.innerHTML='<div class="loader svelte-vizlcg"></div>',j(t,"class","bkg-shade svelte-vizlcg")},m(e,n){C(e,t,n),s=!0},i(e){s||(Y((()=>{s&&(n||(n=ge(t,je,{duration:150},!0)),n.run(1))})),s=!0)},o(e){n||(n=ge(t,je,{duration:150},!1)),n.run(0),s=!1},d(e){e&&I(t),e&&n&&n.end()}}}function Ae(e){let t,n,s=e[0]&&qe();return{c(){s&&s.c(),t=_()},m(e,i){s&&s.m(e,i),C(e,t,i),n=!0},p(e,[n]){e[0]?s?1&n&&ue(s,1):(s=qe(),s.c(),ue(s,1),s.m(t.parentNode,t)):s&&(ae(),de(s,1,1,(()=>{s=null})),ce())},i(e){n||(ue(s),n=!0)},o(e){de(s),n=!1},d(e){s&&s.d(e),e&&I(t)}}}function Me(e,t,n){let{visible:s=!1}=t;return e.$$set=e=>{"visible"in e&&n(0,s=e.visible)},[s]}class Ve extends xe{constructor(e){super(),ke(this,e,Me,Ae,o,{visible:0})}}function Ue(e){let t;return{c(){t=O("path"),j(t,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),j(t,"class","svelte-es4wbs")},m(e,n){C(e,t,n)},d(e){e&&I(t)}}}function ze(e){let t;return{c(){t=O("path"),j(t,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),j(t,"class","svelte-es4wbs")},m(e,n){C(e,t,n)},d(e){e&&I(t)}}}function Fe(e){let t,n="en"===e[2]?"Copy ID":"Copier l'ID";return{c(){t=P(n)},m(e,n){C(e,t,n)},p(e,s){4&s&&n!==(n="en"===e[2]?"Copy ID":"Copier l'ID")&&q(t,n)},d(e){e&&I(t)}}}function Be(e){let t,n="en"===e[2]?"Copied!":"Copié !";return{c(){t=P(n)},m(e,n){C(e,t,n)},p(e,s){4&s&&n!==(n="en"===e[2]?"Copied!":"Copié !")&&q(t,n)},d(e){e&&I(t)}}}function De(e){let t,n,s,r,o,l,c,u,d,p,g,f,m,h,$,b,w,y,v,x=e[0].title+"";function L(e,t){return e[1]?ze:Ue}let S=L(e),_=S(e);function T(e,t){return e[1]?Be:Fe}let A=T(e),M=A(e);return{c(){t=R("div"),n=R("figure"),s=R("img"),o=E(),l=R("div"),c=R("span"),u=P(x),p=E(),g=R("button"),f=O("svg"),_.c(),m=E(),h=R("span"),M.c(),a(s.src,r=Oe(e[0].img,e[0].xyhw,e[3]?"96,":"140,"))||j(s,"src",r),j(s,"alt","Extracted region"),j(c,"class","overlay-desc"),j(l,"class","overlay is-center svelte-es4wbs"),j(n,"class",d="image card "+(e[3]?"is-96x96":"")+" svelte-es4wbs"),j(n,"tabindex","-1"),j(f,"xmlns","http://www.w3.org/2000/svg"),j(f,"viewBox","0 0 384 512"),j(f,"class","svelte-es4wbs"),j(h,"class","tooltip svelte-es4wbs"),j(g,"class","button region-btn tag svelte-es4wbs"),j(t,"class",$="region image is-center "+(e[4](e[0])?"checked":"")+" svelte-es4wbs")},m(i,r){C(i,t,r),k(t,n),k(n,s),k(n,o),k(n,l),k(l,c),k(c,u),k(t,p),k(t,g),k(g,f),_.m(f,null),k(g,m),k(g,h),M.m(h,null),w=!0,y||(v=[N(n,"click",e[7]),N(n,"keyup",He),N(g,"click",e[8])],y=!0)},p(e,[i]){(!w||9&i&&!a(s.src,r=Oe(e[0].img,e[0].xyhw,e[3]?"96,":"140,")))&&j(s,"src",r),(!w||1&i)&&x!==(x=e[0].title+"")&&q(u,x),(!w||8&i&&d!==(d="image card "+(e[3]?"is-96x96":"")+" svelte-es4wbs"))&&j(n,"class",d),S!==(S=L(e))&&(_.d(1),_=S(e),_&&(_.c(),_.m(f,null))),A===(A=T(e))&&M?M.p(e,i):(M.d(1),M=A(e),M&&(M.c(),M.m(h,null))),(!w||17&i&&$!==($="region image is-center "+(e[4](e[0])?"checked":"")+" svelte-es4wbs"))&&j(t,"class",$)},i(e){w||(Y((()=>{w&&(b||(b=ge(t,je,{duration:500},!0)),b.run(1))})),w=!0)},o(e){b||(b=ge(t,je,{duration:500},!1)),b.run(0),w=!1},d(e){e&&I(t),_.d(),M.d(),e&&b&&b.end(),y=!1,i(v)}}}const He=()=>null;function Je(e,t,n){let s;const{isSelected:i}=Ne;d(e,i,(e=>n(4,s=e)));const r=function(){const e=J();return(t,n,{cancelable:s=!1}={})=>{const i=e.$$.callbacks[t];if(i){const r=V(t,n,{cancelable:s});return i.slice().forEach((t=>{t.call(e,r)})),!r.defaultPrevented}return!0}}();let{item:o}=t,{isCopied:l=!1}=t,{appLang:a="en"}=t,{isSquare:c=!0}=t;function u(){r("copyRef",{item:o})}return e.$$set=e=>{"item"in e&&n(0,o=e.item),"isCopied"in e&&n(1,l=e.isCopied),"appLang"in e&&n(2,a=e.appLang),"isSquare"in e&&n(3,c=e.isSquare)},[o,l,a,c,s,i,u,()=>Ne.toggle(o),()=>u()]}class Ke extends xe{constructor(e){super(),ke(this,e,Je,De,o,{item:0,isCopied:1,appLang:2,isSquare:3})}}function Xe(t){let n,s,i,r,o,l,a,c,u,d="en"===t[1]?"Selection":"Sélection";return{c(){n=R("div"),s=R("button"),i=R("span"),r=R("i"),o=E(),l=P(d),a=P("\n            ("),c=P(t[0]),u=P(")"),j(r,"class","fa-solid fa-book-bookmark"),j(i,"id","btn-content"),j(s,"id","set-btn"),j(s,"class","button px-5 py-4 is-link js-modal-trigger svelte-hs48f9"),j(s,"data-target","selection-modal"),j(n,"class","set-container svelte-hs48f9")},m(e,t){C(e,n,t),k(n,s),k(s,i),k(i,r),k(i,o),k(i,l),k(i,a),k(i,c),k(i,u)},p(e,[t]){2&t&&d!==(d="en"===e[1]?"Selection":"Sélection")&&q(l,d),1&t&&q(c,e[0])},i:e,o:e,d(e){e&&I(n)}}}function Qe(e,t,n){let{selectionLength:s=0}=t,{appLang:i="en"}=t,r=s;return e.$$set=e=>{"selectionLength"in e&&n(0,s=e.selectionLength),"appLang"in e&&n(1,i=e.appLang)},e.$$.update=()=>{if(5&e.$$.dirty&&s!==r){const e=s>r;n(2,r=s);const t=document.getElementById("btn-content");t&&t.animate([{transform:e?"translateY(-7px)":"translateX(-5px)"},{transform:e?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[s,i,r]}class Ge extends xe{constructor(e){super(),ke(this,e,Qe,Xe,o,{selectionLength:0,appLang:1})}}function Ze(t){let n,s,r,o,l,a,c,u,d,p,g,f="en"===t[0]?"Clear selection":"Vider la sélection",m="en"===t[0]?"Save selection":"Sauvegarder la sélection";return{c(){n=R("footer"),s=R("div"),r=R("button"),o=P(f),l=E(),a=R("button"),c=R("i"),u=E(),d=P(m),j(r,"class","button is-link is-light"),j(c,"class","fa-solid fa-floppy-disk"),j(a,"class","button is-link"),j(s,"class","buttons"),j(n,"class","modal-card-foot is-center")},m(e,i){C(e,n,i),k(n,s),k(s,r),k(r,o),k(s,l),k(s,a),k(a,c),k(a,u),k(a,d),p||(g=[N(r,"click",t[2]),N(a,"click",t[3])],p=!0)},p(e,[t]){1&t&&f!==(f="en"===e[0]?"Clear selection":"Vider la sélection")&&q(o,f),1&t&&m!==(m="en"===e[0]?"Save selection":"Sauvegarder la sélection")&&q(d,m)},i:e,o:e,d(e){e&&I(n),p=!1,i(g)}}}function We(e,t,n){let{appLang:s="en"}=t,{isRegion:i=!0}=t;return e.$$set=e=>{"appLang"in e&&n(0,s=e.appLang),"isRegion"in e&&n(1,i=e.isRegion)},[s,i,()=>Ne.empty(i),()=>Ne.save()]}class Ye extends xe{constructor(e){super(),ke(this,e,We,Ze,o,{appLang:0,isRegion:1})}}function et(t){let n,s,i,r,o,l,a,c,u,d,p,g,f,m,h,$,b="en"===t[0]?"Cancel":"Annuler";return{c(){n=R("button"),s=E(),i=R("div"),r=R("div"),o=E(),l=R("div"),a=R("div"),a.innerHTML='<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div> \n            <button class="delete media-left" aria-label="close"></button>',c=E(),u=R("section"),d=E(),p=R("footer"),g=R("div"),f=R("button"),m=P(b),h=E(),$=R("button"),$.textContent="OK",j(n,"id","hidden-msg-btn"),j(n,"class","js-modal-trigger"),j(n,"data-target","msg-modal"),n.hidden=!0,j(r,"id","modal-bkg"),j(r,"class","modal-background"),j(a,"class","modal-card-head media mb-0"),j(u,"id","modal-body"),j(u,"class","modal-card-body"),j(f,"id","cancel-btn"),j(f,"class","button is-link is-light"),j($,"id","ok-btn"),j($,"class","button is-link"),j(g,"class","buttons"),j(p,"id","modal-footer"),j(p,"class","modal-card-foot is-center pt-3"),p.hidden=!0,j(l,"class","modal-content"),j(i,"id","msg-modal"),j(i,"class","modal fade"),j(i,"tabindex","-1"),j(i,"aria-labelledby","selection-modal-label"),j(i,"aria-hidden","true")},m(e,t){C(e,n,t),C(e,s,t),C(e,i,t),k(i,r),k(i,o),k(i,l),k(l,a),k(l,c),k(l,u),k(l,d),k(l,p),k(p,g),k(g,f),k(f,m),k(g,h),k(g,$)},p(e,[t]){1&t&&b!==(b="en"===e[0]?"Cancel":"Annuler")&&q(m,b)},i:e,o:e,d(e){e&&I(n),e&&I(s),e&&I(i)}}}function tt(e,t,n){let{appLang:s="en"}=t;return e.$$set=e=>{"appLang"in e&&n(0,s=e.appLang)},[s]}class nt extends xe{constructor(e){super(),ke(this,e,tt,et,o,{appLang:0})}}function st(e){let t,n,s="en"===e[0]?"Automatic region extraction":"Extraction automatique des régions";return{c(){t=R("button"),n=P(s),j(t,"class","button is-link is-inverted")},m(e,s){C(e,t,s),k(t,n)},p(e,t){1&t&&s!==(s="en"===e[0]?"Automatic region extraction":"Extraction automatique des régions")&&q(n,s)},d(e){e&&I(t)}}}function it(t){let n,s,i,r,o,l,a,c,u,d="en"===t[0]?"Manually annotate":"Annoter manuellement",p="en"===t[0]?"Import regions file":"Importer un fichier de région",g=t[1].includes("regions"),f=g&&st(t);return{c(){n=R("div"),s=R("button"),i=P(d),r=E(),o=R("button"),l=P(p),a=E(),f&&f.c(),j(s,"class","button is-link"),j(o,"class","button is-link is-light"),j(n,"class","is-center buttons is-centered pt-5")},m(e,d){C(e,n,d),k(n,s),k(s,i),k(n,r),k(n,o),k(o,l),k(n,a),f&&f.m(n,null),c||(u=N(s,"click",t[2]),c=!0)},p(e,[t]){1&t&&d!==(d="en"===e[0]?"Manually annotate":"Annoter manuellement")&&q(i,d),1&t&&p!==(p="en"===e[0]?"Import regions file":"Importer un fichier de région")&&q(l,p),2&t&&(g=e[1].includes("regions")),g?f?f.p(e,t):(f=st(e),f.c(),f.m(n,null)):f&&(f.d(1),f=null)},i:e,o:e,d(e){e&&I(n),f&&f.d(),c=!1,u()}}}function rt(e,t,n){let{appLang:s="en"}=t,{modules:i=[]}=t,{witness:r={}}=t,{currentRegionId:o}=t,{baseUrl:l}=t;return e.$$set=e=>{"appLang"in e&&n(0,s=e.appLang),"modules"in e&&n(1,i=e.modules),"witness"in e&&n(3,r=e.witness),"currentRegionId"in e&&n(4,o=e.currentRegionId),"baseUrl"in e&&n(5,l=e.baseUrl)},[s,i,async function(){const e=window.location.origin;let t=`${e}/witness/${r.id}/regions/add`;if(1===r.regions.length||o){const n=o||r.regions[0];t=`${e}/witness/${r.id}/regions/${n}/add`}const n=await Re((()=>fetch(t,{method:"POST",headers:{"X-CSRFToken":CSRF_TOKEN}})));if(!n.ok)throw await Ee(`Failed to create regions: '${n.statusText}'`,"Error"),new Error(`Failed to create regions: '${n.statusText}'`);let s;try{s=await n.json()}catch(e){throw await Ee(`Failed to parse JSON response: '${e}'`,"Error"),new Error(`Failed to parse JSON response: '${e}'`)}console.log(s),s.hasOwnProperty("mirador_url")&&window.open(s.mirador_url),s.hasOwnProperty("regions_id")&&(window.location.href=`${l.split("regions/")[0]}regions/${s.regions_id}`)},r,o,l]}class ot extends xe{constructor(e){super(),ke(this,e,rt,it,o,{appLang:0,modules:1,witness:3,currentRegionId:4,baseUrl:5})}}function lt(e,t,n){const s=e.slice();return s[5]=t[n],s}function at(e){let t,n=e[0].regions,s=[];for(let t=0;t<n.length;t+=1)s[t]=ut(lt(e,n,t));return{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=_()},m(e,n){for(let t=0;t<s.length;t+=1)s[t]&&s[t].m(e,n);C(e,t,n)},p(e,i){if(5&i){let r;for(n=e[0].regions,r=0;r<n.length;r+=1){const o=lt(e,n,r);s[r]?s[r].p(o,i):(s[r]=ut(o),s[r].c(),s[r].m(t.parentNode,t))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(e){S(s,e),e&&I(t)}}}function ct(e){let t,n,s,i,r="en"===e[1]?"Delete regions record":"Supprimer l'intégralité des régions";return{c(){t=R("button"),n=P(r),j(t,"class","tag is-danger")},m(r,o){C(r,t,o),k(t,n),s||(i=N(t,"click",e[4]),s=!0)},p(e,t){2&t&&r!==(r="en"===e[1]?"Delete regions record":"Supprimer l'intégralité des régions")&&q(n,r)},d(e){e&&I(t),s=!1,i()}}}function ut(e){let t,n,s,i,r=e[5]+"";return{c(){t=R("a"),n=P("Regions #"),s=P(r),j(t,"href",i=""+(e[2]+e[5])),j(t,"class","tag is-dark mr-3 is-rounded")},m(e,i){C(e,t,i),k(t,n),k(t,s)},p(e,n){1&n&&r!==(r=e[5]+"")&&q(s,r),5&n&&i!==(i=""+(e[2]+e[5]))&&j(t,"href",i)},d(e){e&&I(t)}}}function dt(t){let n;function s(e,t){return e[3]?ct:at}let i=s(t),r=i(t);return{c(){n=R("div"),r.c(),j(n,"class","is-right")},m(e,t){C(e,n,t),r.m(n,null)},p(e,[t]){i===(i=s(e))&&r?r.p(e,t):(r.d(1),r=i(e),r&&(r.c(),r.m(n,null)))},i:e,o:e,d(e){e&&I(n),r.d()}}}function pt(e,t,n){let{witness:s}=t,{appLang:i="en"}=t,{baseUrl:r=`${window.location.origin}${window.location.pathname}`}=t,{currentRegionId:o}=t;return e.$$set=e=>{"witness"in e&&n(0,s=e.witness),"appLang"in e&&n(1,i=e.appLang),"baseUrl"in e&&n(2,r=e.baseUrl),"currentRegionId"in e&&n(3,o=e.currentRegionId)},[s,i,r,o,async function(){if(!await Ee("en"===i?"Are you sure you want to delete this record?":"Voulez-vous vraiment supprimer cet enregistrement?","en"===i?"Confirm deletion":"Confirmer la suppression",!0))return;if("number"!=typeof o)throw new Error("Invalid region ID");const e=`${window.location.origin}/regions/${o}/delete`;try{const t=await Re((()=>fetch(e,{method:"DELETE",headers:{"X-CSRFToken":CSRF_TOKEN}})));if(204!==t.status)throw new Error(`Failed to delete regions: '${t.statusText}'`);window.location.href=`${r.split("regions/")[0]}regions/`}catch(e){console.error(e)}}]}class gt extends xe{constructor(e){super(),ke(this,e,pt,dt,o,{witness:0,appLang:1,baseUrl:2,currentRegionId:3})}}function ft(e){let t;return{c(){t=O("path"),j(t,"d","M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"),j(t,"class","svelte-h0t5l9")},m(e,n){C(e,t,n)},d(e){e&&I(t)}}}function mt(e){let t;return{c(){t=O("path"),j(t,"d","M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"),j(t,"class","svelte-h0t5l9")},m(e,n){C(e,t,n)},d(e){e&&I(t)}}}function ht(e){let t,n="en"===e[0]?"Edit":"Modifier";return{c(){t=P(n)},m(e,n){C(e,t,n)},p(e,s){1&s&&n!==(n="en"===e[0]?"Edit":"Modifier")&&q(t,n)},d(e){e&&I(t)}}}function $t(e){let t,n="en"===e[0]?"Validate":"Valider";return{c(){t=P(n)},m(e,n){C(e,t,n)},p(e,s){1&s&&n!==(n="en"===e[0]?"Validate":"Valider")&&q(t,n)},d(e){e&&I(t)}}}function bt(e){let t;return{c(){t=O("path"),j(t,"d","m10.6 16.2l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21z"),j(t,"class","svelte-h0t5l9")},m(e,n){C(e,t,n)},d(e){e&&I(t)}}}function wt(e){let t;return{c(){t=O("path"),j(t,"d","m10.6 16.2l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21zm0-2h14V5H5zM5 5v14z"),j(t,"class","svelte-h0t5l9")},m(e,n){C(e,t,n)},d(e){e&&I(t)}}}function yt(e){let t,n,s,r,o,l,a,c,u,d,p,g,f,m,h,$,b,w="en"===e[0]?"Reload":"Recharger",y="en"===e[0]?"Go to editor":"Aller à l'éditeur",v="en"===e[0]?"Delete selected regions":"Supprimer les régions sélectionnées";return{c(){t=R("button"),n=R("i"),s=E(),r=P(w),o=E(),l=R("a"),a=R("i"),c=E(),u=P(y),p=E(),g=R("button"),f=R("i"),m=E(),h=P(v),j(n,"class","fa-solid fa-rotate-right"),j(t,"class","tag is-link is-light is-rounded mr-3"),j(a,"class","fa-solid fa-edit"),j(l,"class","tag is-link is-rounded mr-3"),j(l,"href",d=Pe(e[1])),j(l,"target","_blank"),j(f,"class","fa-solid fa-trash"),j(g,"class","tag is-danger is-rounded")},m(i,d){C(i,t,d),k(t,n),k(t,s),k(t,r),C(i,o,d),C(i,l,d),k(l,a),k(l,c),k(l,u),C(i,p,d),C(i,g,d),k(g,f),k(g,m),k(g,h),$||(b=[N(t,"click",e[18]),N(g,"click",e[8])],$=!0)},p(e,t){1&t&&w!==(w="en"===e[0]?"Reload":"Recharger")&&q(r,w),1&t&&y!==(y="en"===e[0]?"Go to editor":"Aller à l'éditeur")&&q(u,y),2&t&&d!==(d=Pe(e[1]))&&j(l,"href",d),1&t&&v!==(v="en"===e[0]?"Delete selected regions":"Supprimer les régions sélectionnées")&&q(h,v)},d(e){e&&I(t),e&&I(o),e&&I(l),e&&I(p),e&&I(g),$=!1,i(b)}}}function vt(t){let n,s,r,o,l,a,c,u,d,p,g,f,m,h,$,b,w,y,v,x,L,S,_="en"===t[0]?"Select all":"Tout sélectionner",T="en"===t[0]?"Download":"Télécharger";function A(e,t){return e[3]?mt:ft}let M=A(t),V=M(t);function U(e,t){return e[3]?$t:ht}let z=U(t),F=z(t);function B(e,t){return e[2]?wt:bt}let D=B(t),H=D(t),J=t[3]&&yt(t);return{c(){n=R("div"),s=R("button"),r=O("svg"),V.c(),o=E(),F.c(),a=E(),c=R("button"),u=O("svg"),H.c(),d=E(),p=R("i"),g=E(),f=R("span"),m=P(_),h=E(),$=R("button"),b=R("i"),w=E(),y=P(T),v=E(),x=R("div"),J&&J.c(),j(r,"xmlns","http://www.w3.org/2000/svg"),j(r,"viewBox","0 0 384 512"),j(r,"class","pr-3 svelte-h0t5l9"),j(s,"class",l="button "+(t[3]?"is-success":"is-link")+" mr-3"),j(u,"xmlns","http://www.w3.org/2000/svg"),j(u,"viewBox","0 0 448 512"),j(u,"class","svelte-h0t5l9"),j(p,"class","fa-solid fa-square-check"),j(f,"id","all-selection"),j(c,"class","button is-link is-light mr-3"),j(b,"class","fa-solid fa-download"),j($,"class","button is-link is-light"),j(n,"class","is-left mb-3"),j(x,"class","edit-action is-left svelte-h0t5l9")},m(e,i){C(e,n,i),k(n,s),k(s,r),V.m(r,null),k(s,o),F.m(s,null),k(n,a),k(n,c),k(c,u),H.m(u,null),k(c,d),k(c,p),k(c,g),k(c,f),k(f,m),k(n,h),k(n,$),k($,b),k($,w),k($,y),C(e,v,i),C(e,x,i),J&&J.m(x,null),L||(S=[N(s,"click",t[17]),N(c,"click",t[9]),N($,"click",t[10])],L=!0)},p(e,[t]){M!==(M=A(e))&&(V.d(1),V=M(e),V&&(V.c(),V.m(r,null))),z===(z=U(e))&&F?F.p(e,t):(F.d(1),F=z(e),F&&(F.c(),F.m(s,null))),8&t&&l!==(l="button "+(e[3]?"is-success":"is-link")+" mr-3")&&j(s,"class",l),D!==(D=B(e))&&(H.d(1),H=D(e),H&&(H.c(),H.m(u,null))),1&t&&_!==(_="en"===e[0]?"Select all":"Tout sélectionner")&&q(m,_),1&t&&T!==(T="en"===e[0]?"Download":"Télécharger")&&q(y,T),e[3]?J?J.p(e,t):(J=yt(e),J.c(),J.m(x,null)):J&&(J.d(1),J=null)},i:e,o:e,d(e){e&&I(n),V.d(),F.d(),H.d(),e&&I(v),e&&I(x),J&&J.d(),L=!1,i(S)}}}async function kt(e){const t=SAS_APP_URL.replace("https","http"),n=`${SAS_APP_URL}/annotation/destroy?uri=${t}/annotation/${e}`,s=await fetch(n,{method:"DELETE"});if(204!==s.status)throw new Error(`Failed to delete ${n} due to ${s.status}: '${s.statusText}'`)}function xt(e,t,n){let s,i,r,o,l,a,c;const{selected:u,nbSelected:p}=Ne;d(e,u,(e=>n(14,l=e))),d(e,p,(e=>n(16,c=e)));const{allRegions:g}=Te;d(e,g,(e=>n(15,a=e)));let{appLang:f}=t,{manifest:m}=t,{isValidated:h}=t,{regionsType:$}=t;function b(){n(3,i=!i)}return e.$$set=e=>{"appLang"in e&&n(0,f=e.appLang),"manifest"in e&&n(1,m=e.manifest),"isValidated"in e&&n(11,h=e.isValidated),"regionsType"in e&&n(12,$=e.regionsType)},e.$$.update=()=>{65536&e.$$.dirty&&n(13,s=c(!0)),2048&e.$$.dirty&&n(3,i=!h),16384&e.$$.dirty&&(r=l(!0)),40960&e.$$.dirty&&n(2,o=s>=Object.keys(a).length)},[f,m,o,i,u,p,g,b,async function(){if(await Ee("en"===f?"Are you sure you want to delete regions?":"Voulez-vous vraiment supprimer les régions?","en"===f?"Confirm deletion":"Confirmer la suppression",!0))for(const e of Object.keys(r))try{if(!a.hasOwnProperty(e))continue;await kt(e),Te.remove(e),Ne.remove(e,$)}catch(t){await Ee(`Failed to delete region ${e}: ${t.message}`,"Error")}},function(){o?Ne.removeAll(Object.keys(a),$):Ne.addAll(Object.values(a))},async function(){const e=Object.values(l(!0)).map((e=>e.ref)),t=await Re((()=>fetch(`${window.location.origin}/regions/export`,{method:"POST",headers:{"X-CSRFToken":CSRF_TOKEN},body:JSON.stringify({regionsRef:e})})));!function(e,t){const n=window.URL.createObjectURL(e),s=document.createElement("a");s.href=n,s.download=`${t}`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(n),document.body.removeChild(s)}(await t.blob(),"regions.zip")},h,$,s,l,a,c,()=>b(),()=>location.reload()]}class Lt extends xe{constructor(e){super(),ke(this,e,xt,vt,o,{appLang:0,manifest:1,isValidated:11,regionsType:12})}}const Ct=function(){const e=`${window.location.origin}${window.location.pathname}`,t=Ce(1),n=Ce({}),s=Ce([]),i=Ce([]),r=Ce({}),o=Ce(JSON.parse(localStorage.getItem("selectedRegions"))||{}),l=(async()=>{const t=await fetch(`${e}similar-regions`).then((e=>e.json())).then((e=>(n.set(e),e))).catch((e=>console.error("Error:",e))),i=await fetch(`${e}query-images`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":CSRF_TOKEN},body:JSON.stringify({regionsRefs:Object.keys(t)})}).then((e=>e.json())).then((e=>0!==e.length&&e?(s.set(e),e):null)).catch((e=>console.error("Error:",e)));return g(a()),i})(),a=()=>{if("undefined"!=typeof window){const e=parseInt(new URLSearchParams(window.location.search).get("sp"));if(!isNaN(e))return t.set(e),e}return t.set(1),1},c=Ie(t,(e=>(async()=>function(e){const t=50*(e-1),n=t+50,r=u(s).slice(t,n);return i.set(r),r}(e))())),d=Ie(o,(e=>(async()=>await p(e))())),p=async t=>{const n=await fetch(`${e}similarity-page`,{method:"POST",body:JSON.stringify({regionsIds:Object.values(t).map((e=>e.id)),pageImgs:u(i)}),headers:{"Content-Type":"application/json","X-CSRFToken":CSRF_TOKEN}}),s=await n.json();return r.set(s),s};function g(e){if(t.set(e),"undefined"!=typeof window){const t=new URL(window.location.href);t.searchParams.set("sp",e),window.history.pushState({},"",t)}}function f(e){localStorage.setItem("selectedRegions",JSON.stringify(e))}const m=Ie(o,(e=>t=>e.hasOwnProperty(t)));return{currentPage:t,comparedRegions:n,qImgs:s,pageQImgs:i,pageSImgs:r,selectedRegions:o,fetchSimilarity:l,setPageQImgs:c,setPageSImgs:d,getSimilarImgs:function(e){const t=u(r);return t.hasOwnProperty(e)?t[e]:[]},getRegionsInfo:function(e){const t=u(n),s=Object.keys(t).filter((t=>t.startsWith(e)));return 1!==s.length?{title:"Error"}:t[s[0]]},handlePageUpdate:g,unselect:function(e){o.update((t=>{const n={...t};return delete n[e],f(n),n}))},select:function(e){o.update((t=>{const n={...t,[e.ref]:e};return f(n),n}))},isSelected:m}}();function It(e){let t,n,s;const i=e[1].default,r=p(i,e,e[0],null);return{c(){t=R("table"),n=R("tbody"),r&&r.c(),j(t,"class","table is-fullwidth")},m(e,i){C(e,t,i),k(t,n),r&&r.m(n,null),s=!0},p(e,[t]){r&&r.p&&(!s||1&t)&&m(r,i,e,e[0],s?f(i,e[0],t,null):h(e[0]),null)},i(e){s||(ue(r,e),s=!0)},o(e){de(r,e),s=!1},d(e){e&&I(t),r&&r.d(e)}}}function St(e,t,n){let{$$slots:s={},$$scope:i}=t;return e.$$set=e=>{"$$scope"in e&&n(0,i=e.$$scope)},[i,s]}class Rt extends xe{constructor(e){super(),ke(this,e,St,It,o,{})}}function Ot(e){let t,n,s,i,r,o,l=e[1]-1>1&&Pt(e);return{c(){t=R("li"),n=R("a"),n.textContent="1",s=E(),l&&l.c(),i=_(),j(n,"class","pagination-link"),j(n,"href",null)},m(a,c){C(a,t,c),k(t,n),C(a,s,c),l&&l.m(a,c),C(a,i,c),r||(o=N(n,"click",T(e[6])),r=!0)},p(e,t){e[1]-1>1?l?l.p(e,t):(l=Pt(e),l.c(),l.m(i.parentNode,i)):l&&(l.d(1),l=null)},d(e){e&&I(t),e&&I(s),l&&l.d(e),e&&I(i),r=!1,o()}}}function Pt(e){let t,n,s,i,r,o,l,a=e[1]-1+"";return{c(){t=R("li"),t.innerHTML='<span class="pagination-ellipsis">…</span>',n=E(),s=R("li"),i=R("a"),r=P(a),j(i,"class","pagination-link"),j(i,"href",null)},m(a,c){C(a,t,c),C(a,n,c),C(a,s,c),k(s,i),k(i,r),o||(l=N(i,"click",T(e[7])),o=!0)},p(e,t){2&t&&a!==(a=e[1]-1+"")&&q(r,a)},d(e){e&&I(t),e&&I(n),e&&I(s),o=!1,l()}}}function Et(e){let t,n,s,i,r,o=e[1]+1<e[3]&&_t(e);return{c(){o&&o.c(),t=E(),n=R("li"),s=R("a"),s.textContent=`${e[3]}`,j(s,"class","pagination-link"),j(s,"href",null)},m(l,a){o&&o.m(l,a),C(l,t,a),C(l,n,a),k(n,s),i||(r=N(s,"click",T(e[10])),i=!0)},p(e,n){e[1]+1<e[3]?o?o.p(e,n):(o=_t(e),o.c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null)},d(e){o&&o.d(e),e&&I(t),e&&I(n),i=!1,r()}}}function _t(e){let t,n,s,i,r,o,l,a=e[1]+1+"";return{c(){t=R("li"),n=R("a"),s=P(a),i=E(),r=R("li"),r.innerHTML='<span class="pagination-ellipsis">…</span>',j(n,"class","pagination-link"),j(n,"href",null)},m(a,c){C(a,t,c),k(t,n),k(n,s),C(a,i,c),C(a,r,c),o||(l=N(n,"click",T(e[9])),o=!0)},p(e,t){2&t&&a!==(a=e[1]+1+"")&&q(s,a)},d(e){e&&I(t),e&&I(i),e&&I(r),o=!1,l()}}}function Nt(t){let n,s=t[3]>1&&function(e){let t,n,s,i,r,o,l,a,c,u=e[1]>1&&Ot(e),d=e[1]<e[3]&&Et(e);return{c(){t=R("nav"),n=R("ul"),u&&u.c(),s=E(),i=R("li"),r=R("a"),o=P(e[1]),l=E(),d&&d.c(),j(r,"class","pagination-link is-current"),j(r,"href",null),j(n,"class","pagination-list"),j(t,"class","pagination is-centered"),j(t,"aria-label","pagination")},m(p,g){C(p,t,g),k(t,n),u&&u.m(n,null),k(n,s),k(n,i),k(i,r),k(r,o),k(n,l),d&&d.m(n,null),a||(c=N(r,"click",T(e[8])),a=!0)},p(e,t){e[1]>1?u?u.p(e,t):(u=Ot(e),u.c(),u.m(n,s)):u&&(u.d(1),u=null),2&t&&q(o,e[1]),e[1]<e[3]?d?d.p(e,t):(d=Et(e),d.c(),d.m(n,null)):d&&(d.d(1),d=null)},d(e){e&&I(t),u&&u.d(),d&&d.d(),a=!1,c()}}}(t);return{c(){s&&s.c(),n=_()},m(e,t){s&&s.m(e,t),C(e,n,t)},p(e,[t]){e[3]>1&&s.p(e,t)},i:e,o:e,d(e){s&&s.d(e),e&&I(n)}}}function Tt(e,t,n){let s,{store:i}=t;const{currentPage:r}=i;d(e,r,(e=>n(1,s=e)));let{nbOfItems:o}=t,{pageLength:l=50}=t;const a=Math.ceil(o/l);return e.$$set=e=>{"store"in e&&n(0,i=e.store),"nbOfItems"in e&&n(4,o=e.nbOfItems),"pageLength"in e&&n(5,l=e.pageLength)},[i,s,r,a,o,l,()=>i.handlePageUpdate(1),()=>i.handlePageUpdate(s-1),()=>i.handlePageUpdate(s),()=>i.handlePageUpdate(s+1),()=>i.handlePageUpdate(a)]}class jt extends xe{constructor(e){super(),ke(this,e,Tt,Nt,o,{store:0,nbOfItems:4,pageLength:5})}}function qt(e){let t,n,s,i,r,o,l,c,u,d,g,$,b,w,y,v,x=parseInt(e[2])+"";const L=e[4].default,S=p(L,e,e[3],null);return{c(){t=R("tr"),n=R("th"),s=R("div"),i=R("img"),o=E(),l=R("a"),c=R("i"),u=P("\n                Page "),d=P(x),$=E(),b=R("td"),w=R("div"),y=R("div"),S&&S.c(),a(i.src,r=Oe(e[0],"full","250,"))||j(i,"src",r),j(i,"alt","Query region"),j(i,"class","mb-3 card"),j(c,"class","fa-solid fa-pen-to-square"),j(l,"class","tag px-2 py-1 is-rounded is-hoverable"),j(l,"href",g=Pe(e[1],parseInt(e[2]))),j(l,"target","_blank"),j(s,"class","content-wrapper py-5"),j(n,"class","is-3 center-flex is-narrow"),A(n,"width","260px"),j(y,"class","grid is-gap-2"),j(w,"class","fixed-grid has-5-cols"),j(b,"class","p-5 is-fullwidth")},m(e,r){C(e,t,r),k(t,n),k(n,s),k(s,i),k(s,o),k(s,l),k(l,c),k(l,u),k(l,d),k(t,$),k(t,b),k(b,w),k(w,y),S&&S.m(y,null),v=!0},p(e,[t]){(!v||1&t&&!a(i.src,r=Oe(e[0],"full","250,")))&&j(i,"src",r),(!v||2&t&&g!==(g=Pe(e[1],parseInt(e[2]))))&&j(l,"href",g),S&&S.p&&(!v||8&t)&&m(S,L,e,e[3],v?f(L,e[3],t,null):h(e[3]),null)},i(e){v||(ue(S,e),v=!0)},o(e){de(S,e),v=!1},d(e){e&&I(t),S&&S.d(e)}}}function At(e,t,n){let{$$slots:s={},$$scope:i}=t,{qImg:r}=t;const[o,l,a,c]=r.split(".")[0].split("_");let{manifest:u=""}=t;return e.$$set=e=>{"qImg"in e&&n(0,r=e.qImg),"manifest"in e&&n(1,u=e.manifest),"$$scope"in e&&n(3,i=e.$$scope)},[r,u,a,i,s]}class Mt extends xe{constructor(e){super(),ke(this,e,At,qt,o,{qImg:0,manifest:1})}}APP_LANG;const Vt=USER_ID;function Ut(e){let t,n,s,r,o,l,c,u,d,p,g,f,m,h,$,b,w,y,v,x,L,S,_,T,A,V,U,z,F,B,D,H,J,K,X,Q,G,Z,W,ee,te,ne,se,ie,re,oe,le,ae,ce,ue,de,pe,fe,me,he,$e,be,we,ye,ve,ke,xe,Le,Ce,Ie=Ct.getRegionsInfo(`${e[4]}_${e[5]}`).title+"",Se=parseInt(e[6])+"";return{c(){t=R("div"),n=R("figure"),s=R("img"),o=E(),l=R("div"),c=R("span"),u=P(Ie),d=E(),p=R("br"),g=P("\n                Page "),f=P(Se),m=E(),h=R("br"),$=E(),b=R("b"),w=P("Score: "),y=P(e[1]),v=E(),x=R("div"),L=R("span"),S=O("svg"),_=O("rect"),T=O("rect"),A=O("rect"),U=E(),z=R("span"),F=O("svg"),B=O("rect"),D=O("rect"),H=O("path"),J=O("path"),K=O("path"),X=O("path"),Q=O("path"),G=O("path"),Z=O("path"),W=O("path"),ee=O("path"),ne=E(),se=R("span"),ie=O("svg"),re=O("rect"),oe=O("rect"),ae=E(),ce=R("span"),ue=O("svg"),de=O("rect"),pe=O("path"),fe=O("path"),he=E(),$e=R("span"),be=O("svg"),we=O("rect"),ye=O("path"),a(s.src,r=Oe(e[8],e[7],",256"))||j(s,"src",r),j(s,"alt","Similar region"),j(s,"class","svelte-py4ibq"),j(c,"class","overlay-desc"),j(l,"class","overlay is-center svelte-py4ibq"),j(n,"class","image region-image card svelte-py4ibq"),j(n,"tabindex","-1"),j(_,"x","30"),j(_,"y","30.62"),j(_,"width","55.71"),j(_,"height","55.71"),j(_,"rx","5.01"),j(_,"ry","5.01"),j(_,"fill","none"),j(_,"stroke","currentColor"),j(_,"stroke-width","3"),j(T,"x","21"),j(T,"y","21"),j(T,"width","55.71"),j(T,"height","55.71"),j(T,"rx","5.01"),j(T,"ry","5.01"),j(T,"fill","none"),j(T,"stroke","currentColor"),j(T,"stroke-width","3"),j(A,"x","30"),j(A,"y","30.62"),j(A,"width","46"),j(A,"height","45.71"),j(A,"rx","4.11"),j(A,"ry","4.11"),j(A,"fill","currentColor"),j(A,"stroke","none"),j(S,"xmlns","http://www.w3.org/2000/svg"),j(S,"viewBox","0 0 54 54.5"),j(S,"class","svelte-py4ibq"),j(L,"class","tag is-hoverable pl-5 pr-4 py-4"),j(L,"title",V="en"===e[0]?"Exact match":"Correspondance exacte"),M(L,"is-link",1===e[3]),j(B,"x","32"),j(B,"y","32.43"),j(B,"width","55.71"),j(B,"height","55.71"),j(B,"rx","5.01"),j(B,"ry","5.01"),j(B,"fill","none"),j(B,"stroke","currentColor"),j(B,"stroke-width","3"),j(B,"pointer-events","all"),j(D,"x","21"),j(D,"y","20.81"),j(D,"width","55.71"),j(D,"height","55.71"),j(D,"rx","5.01"),j(D,"ry","5.01"),j(D,"fill","none"),j(D,"stroke","currentColor"),j(D,"stroke-width","3"),j(D,"pointer-events","all"),j(H,"d","M 32 41.43 L 41 32.43"),j(H,"fill","none"),j(H,"stroke","currentColor"),j(H,"stroke-width","3"),j(H,"stroke-miterlimit","10"),j(J,"d","M 32 50 L 50 32.43"),j(J,"fill","none"),j(J,"stroke","currentColor"),j(J,"stroke-width","3"),j(J,"stroke-miterlimit","10"),j(K,"d","M 60 76 L 77 58"),j(K,"fill","none"),j(K,"stroke","currentColor"),j(K,"stroke-width","3"),j(K,"stroke-miterlimit","10"),j(X,"d","M 68.3 76.29 L 77 67"),j(X,"fill","none"),j(X,"stroke","currentColor"),j(X,"stroke-width","3"),j(X,"stroke-miterlimit","10"),j(Q,"d","M 32 59 L 59 32"),j(Q,"fill","none"),j(Q,"stroke","currentColor"),j(Q,"stroke-width","3"),j(Q,"stroke-miterlimit","10"),j(G,"d","M 32 68 L 68 32"),j(G,"fill","none"),j(G,"stroke","currentColor"),j(G,"stroke-width","3"),j(G,"stroke-miterlimit","10"),j(Z,"d","M 33 76 L 77 32"),j(Z,"fill","none"),j(Z,"stroke","currentColor"),j(Z,"stroke-width","3"),j(Z,"stroke-miterlimit","10"),j(W,"d","M 51 76 L 77 49"),j(W,"fill","none"),j(W,"stroke","currentColor"),j(W,"stroke-width","3"),j(W,"stroke-miterlimit","10"),j(ee,"d","M 41 77 L 77 41"),j(ee,"fill","none"),j(ee,"stroke","currentColor"),j(ee,"stroke-width","3"),j(ee,"stroke-miterlimit","10"),j(F,"xmlns","http://www.w3.org/2000/svg"),j(F,"viewBox","0 0 55 55.5"),j(F,"class","svelte-py4ibq"),j(z,"class","tag is-hoverable p-4"),j(z,"title",te="en"===e[0]?"Partial match":"Correspondance partielle"),M(z,"is-link",2===e[3]),j(re,"x","34"),j(re,"y","34.43"),j(re,"width","55.71"),j(re,"height","55.71"),j(re,"rx","5.01"),j(re,"ry","5.01"),j(re,"fill","none"),j(re,"stroke","currentColor"),j(re,"stroke-width","3"),j(re,"stroke-dasharray","9 9"),j(oe,"x","21"),j(oe,"y","20.81"),j(oe,"width","55.71"),j(oe,"height","55.71"),j(oe,"rx","5.01"),j(oe,"ry","5.01"),j(oe,"fill","none"),j(oe,"stroke","currentColor"),j(oe,"stroke-width","3"),j(ie,"xmlns","http://www.w3.org/2000/svg"),j(ie,"viewBox","0 0 56 56.5"),j(ie,"class","svelte-py4ibq"),j(se,"class","tag is-hoverable p-4"),j(se,"title",le="en"===e[0]?"Semantic match":"Correspondance sémantique"),M(se,"is-link",3===e[3]),j(de,"x","21"),j(de,"y","20.62"),j(de,"width","55.71"),j(de,"height","55.71"),j(de,"rx","5.01"),j(de,"ry","5.01"),j(de,"fill","none"),j(de,"stroke","currentColor"),j(de,"stroke-width","3"),j(pe,"d","M 22.67 74.55 L 75 22"),j(pe,"fill","none"),j(pe,"stroke","currentColor"),j(pe,"stroke-width","3"),j(pe,"stroke-miterlimit","10"),j(fe,"d","M 74.37 74.05 L 22.72 22.24"),j(fe,"fill","none"),j(fe,"stroke","currentColor"),j(fe,"stroke-width","3"),j(fe,"stroke-miterlimit","10"),j(ue,"xmlns","http://www.w3.org/2000/svg"),j(ue,"viewBox","0 0 49.5 49.5"),j(ue,"class","svelte-py4ibq"),j(ce,"class","tag is-hoverable p-4"),j(ce,"title",me="en"===e[0]?"No match":"Aucune correspondance"),M(ce,"is-link",4===e[3]),j(we,"x","21"),j(we,"y","20.81"),j(we,"width","55.71"),j(we,"height","55.71"),j(we,"rx","5.01"),j(we,"ry","5.01"),j(we,"fill","none"),j(we,"stroke","currentColor"),j(we,"stroke-width","3"),j(ye,"d","M 28.69 75.28 C 29.25 64.15 38.08 55.28 48.86 55.28 C 52.5 55.28 56.07 56.3 59.18 58.25 C 64.96 61.85 68.66 68.3 69.02 75.28 Z M 37.85 41.48 C 37.85 35.37 42.79 30.39 48.86 30.39 C 54.92 30.39 59.86 35.37 59.86 41.48 C 59.86 47.59 54.92 52.56 48.86 52.56 C 42.79 52.56 37.85 47.59 37.85 41.48 Z M 60.37 56.34 C 58.43 55.13 56.32 54.25 54.13 53.7 C 58.82 51.64 62.1 46.94 62.1 41.48 C 62.1 34.13 56.16 28.15 48.86 28.15 C 41.55 28.15 35.61 34.13 35.61 41.48 C 35.61 46.95 38.9 51.66 43.6 53.71 C 33.76 56.18 26.41 65.4 26.41 76.4 C 26.41 77.02 26.92 77.52 27.54 77.52 L 70.17 77.52 C 70.79 77.52 71.3 77.02 71.3 76.4 C 71.3 68.23 67.11 60.54 60.37 56.34 Z"),j(ye,"fill","currentColor"),j(ye,"stroke","none"),j(be,"xmlns","http://www.w3.org/2000/svg"),j(be,"viewBox","0 0 49.5 49.5"),j(be,"class","svelte-py4ibq"),j($e,"class","tag is-hoverable pl-4 pr-5 py-4"),j($e,"title",ve="en"===e[0]?"User match":"Correspondance utilisateur"),M($e,"is-link",e[2]),j(x,"class","tags has-addons is-dark is-center"),j(t,"class","region is-center svelte-py4ibq")},m(i,r){C(i,t,r),k(t,n),k(n,s),k(n,o),k(n,l),k(l,c),k(c,u),k(c,d),k(c,p),k(c,g),k(c,f),k(c,m),k(c,h),k(c,$),k(c,b),k(b,w),k(b,y),k(t,v),k(t,x),k(x,L),k(L,S),k(S,_),k(S,T),k(S,A),k(x,U),k(x,z),k(z,F),k(F,B),k(F,D),k(F,H),k(F,J),k(F,K),k(F,X),k(F,Q),k(F,G),k(F,Z),k(F,W),k(F,ee),k(x,ne),k(x,se),k(se,ie),k(ie,re),k(ie,oe),k(x,ae),k(x,ce),k(ce,ue),k(ue,de),k(ue,pe),k(ue,fe),k(x,he),k(x,$e),k($e,be),k(be,we),k(be,ye),xe=!0,Le||(Ce=[N(L,"click",e[13]),N(L,"keyup",null),N(z,"click",e[14]),N(z,"keyup",null),N(se,"click",e[15]),N(se,"keyup",null),N(ce,"click",e[16]),N(ce,"keyup",null),N($e,"click",e[17]),N($e,"keyup",null)],Le=!0)},p(e,[t]){(!xe||2&t)&&q(y,e[1]),(!xe||1&t&&V!==(V="en"===e[0]?"Exact match":"Correspondance exacte"))&&j(L,"title",V),(!xe||8&t)&&M(L,"is-link",1===e[3]),(!xe||1&t&&te!==(te="en"===e[0]?"Partial match":"Correspondance partielle"))&&j(z,"title",te),(!xe||8&t)&&M(z,"is-link",2===e[3]),(!xe||1&t&&le!==(le="en"===e[0]?"Semantic match":"Correspondance sémantique"))&&j(se,"title",le),(!xe||8&t)&&M(se,"is-link",3===e[3]),(!xe||1&t&&me!==(me="en"===e[0]?"No match":"Aucune correspondance"))&&j(ce,"title",me),(!xe||8&t)&&M(ce,"is-link",4===e[3]),(!xe||1&t&&ve!==(ve="en"===e[0]?"User match":"Correspondance utilisateur"))&&j($e,"title",ve),(!xe||4&t)&&M($e,"is-link",e[2])},i(e){xe||(Y((()=>{xe&&(ke||(ke=ge(t,je,{duration:500},!0)),ke.run(1))})),xe=!0)},o(e){ke||(ke=ge(t,je,{duration:500},!1)),ke.run(0),xe=!1},d(e){e&&I(t),e&&ke&&ke.end(),Le=!1,i(Ce)}}}function zt(e,t,n){let s,i,{appLang:r="en"}=t,{qImg:o}=t,{sImg:l}=t,{score:a}=t;const c=window.location.origin,[u,d,p,g]=l.split(".")[0].split("_"),f=`${u}_${d}_${p}`;let{regionsCategory:m=null}=t;function h(e){5===e?n(2,i=!i):n(3,s=s===e?null:e)}async function $(e){const[t,n,r,a]=o.split(".")[0].split("_"),[u,d,p,g]=l.split(".")[0].split("_");h(e);try{(await fetch(`${c}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":CSRF_TOKEN},body:JSON.stringify({img_1:o,img_2:l,regions_ref_1:`${t}_${n}_${r}`,regions_ref_2:`${u}_${d}_${p}`,category:e<=4?s:null,category_x:5===e?i:null})})).ok||(console.error("Error: Network response was not ok"),h(e))}catch(t){console.error("Error:",t),h(e)}}return e.$$set=e=>{"appLang"in e&&n(0,r=e.appLang),"qImg"in e&&n(10,o=e.qImg),"sImg"in e&&n(11,l=e.sImg),"score"in e&&n(1,a=e.score),"regionsCategory"in e&&n(12,m=e.regionsCategory)},e.$$.update=()=>{4096&e.$$.dirty&&n(3,s=m?m.category:null),4096&e.$$.dirty&&n(2,i=m&&m.category_x?.includes(Number(Vt))||!1)},[r,a,i,s,u,d,p,g,f,$,o,l,m,()=>$(1),()=>$(2),()=>$(3),()=>$(4),()=>$(5)]}CSRF_TOKEN;class Ft extends xe{constructor(e){super(),ke(this,e,zt,Ut,o,{appLang:0,qImg:10,sImg:11,score:1,regionsCategory:12})}}function Bt(e){e[7]=e[9].similarImgs,e[8]=e[9].categories}function Dt(e,t,n){const s=e.slice();return s[10]=t[n][0],s[11]=t[n][1],s}function Ht(t){let n,s,i,r=t[14]+"";return{c(){n=R("div"),s=P("Error when retrieving similar regions: "),i=P(r),j(n,"class","faded is-center")},m(e,t){C(e,n,t),k(n,s),k(n,i)},p:e,i:e,o:e,d(e){e&&I(n)}}}function Jt(e){let t,n;Bt(e);let s=e[7],i=[];for(let t=0;t<s.length;t+=1)i[t]=Kt(Dt(e,s,t));const r=e=>de(i[e],1,1,(()=>{i[e]=null}));return{c(){for(let e=0;e<i.length;e+=1)i[e].c();t=_()},m(e,s){for(let t=0;t<i.length;t+=1)i[t]&&i[t].m(e,s);C(e,t,s),n=!0},p(e,n){if(Bt(e),11&n){let o;for(s=e[7],o=0;o<s.length;o+=1){const r=Dt(e,s,o);i[o]?(i[o].p(r,n),ue(i[o],1)):(i[o]=Kt(r),i[o].c(),ue(i[o],1),i[o].m(t.parentNode,t))}for(ae(),o=s.length;o<i.length;o+=1)r(o);ce()}},i(e){if(!n){for(let e=0;e<s.length;e+=1)ue(i[e]);n=!0}},o(e){i=i.filter(Boolean);for(let e=0;e<i.length;e+=1)de(i[e]);n=!1},d(e){S(i,e),e&&I(t)}}}function Kt(e){let t,n;return t=new Ft({props:{qImg:e[1],sImg:e[10],score:e[11],appLang:e[0],regionsCategory:e[8][`${e[1]}|${e[10]}`]}}),{c(){be(t.$$.fragment)},m(e,s){we(t,e,s),n=!0},p(e,n){const s={};2&n&&(s.qImg=e[1]),1&n&&(s.appLang=e[0]),2&n&&(s.regionsCategory=e[8][`${e[1]}|${e[10]}`]),t.$set(s)},i(e){n||(ue(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function Xt(t){let n,s,i="en"===t[0]?"Retrieving similar regions...":"Récupération des régions similaires...";return{c(){n=R("div"),s=P(i),j(n,"class","faded is-center")},m(e,t){C(e,n,t),k(n,s)},p(e,t){1&t&&i!==(i="en"===e[0]?"Retrieving similar regions...":"Récupération des régions similaires...")&&q(s,i)},i:e,o:e,d(e){e&&I(n)}}}function Qt(e){let t,n,s={ctx:e,current:null,token:null,hasCatch:!0,pending:Xt,then:Jt,catch:Ht,value:9,error:14,blocks:[,,,]};return fe(e[3],s),{c(){t=_(),s.block.c()},m(e,i){C(e,t,i),s.block.m(e,s.anchor=i),s.mount=()=>t.parentNode,s.anchor=t,n=!0},p(t,[n]){me(s,e=t,n)},i(e){n||(ue(s.block),n=!0)},o(e){for(let e=0;e<3;e+=1){de(s.blocks[e])}n=!1},d(e){e&&I(t),s.block.d(e),s.token=null,s=null}}}function Gt(e,t,n){let s;const{setPageSImgs:i}=Ct;d(e,i,(e=>n(4,s=e)));let{appLang:r="en"}=t,{qImg:o}=t;const l=window.location.origin;let a=async function(e){await s;const t=Ct.getSimilarImgs(e),n=t.map((([t,n])=>`${e}|${t}`)),i=await fetch(`${l}/get-categories`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":CSRF_TOKEN},body:JSON.stringify({img_pairs:n})});if(!i.ok)throw new Error("Failed to fetch categories");return{similarImgs:t,categories:await i.json()}}(o);return e.$$set=e=>{"appLang"in e&&n(0,r=e.appLang),"qImg"in e&&n(1,o=e.qImg)},[r,o,i,a]}class Zt extends xe{constructor(e){super(),ke(this,e,Gt,Qt,o,{appLang:0,qImg:1})}}function Wt(e,t,n){const s=e.slice();return s[9]=t[n],s}function Yt(t){let n,s,i,r=t[12]+"";return{c(){n=R("tr"),s=P("Error when retrieving similar regions: "),i=P(r)},m(e,t){C(e,n,t),k(n,s),k(n,i)},p(e,t){8&t&&r!==(r=e[12]+"")&&q(i,r)},i:e,o:e,d(e){e&&I(n)}}}function en(e){let t,n,s=[],i=new Map,r=e[4];const o=e=>e[9].id;for(let t=0;t<r.length;t+=1){let n=Wt(e,r,t),l=o(n);i.set(l,s[t]=sn(l,n))}let l=null;return r.length||(l=tn(e)),{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=_(),l&&l.c()},m(e,i){for(let t=0;t<s.length;t+=1)s[t]&&s[t].m(e,i);C(e,t,i),l&&l.m(e,i),n=!0},p(e,n){19&n&&(r=e[4],ae(),s=$e(s,n,o,1,e,r,i,t.parentNode,he,sn,t,Wt),ce(),!r.length&&l?l.p(e,n):r.length?l&&(l.d(1),l=null):(l=tn(e),l.c(),l.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<r.length;e+=1)ue(s[e]);n=!0}},o(e){for(let e=0;e<s.length;e+=1)de(s[e]);n=!1},d(e){for(let t=0;t<s.length;t+=1)s[t].d(e);e&&I(t),l&&l.d(e)}}}function tn(e){let t,n,s,i="en"===e[0]?"No similarity":"Pas de similarités";return{c(){t=R("tr"),n=P(i),s=E(),j(t,"class","faded is-center")},m(e,i){C(e,t,i),k(t,n),C(e,s,i)},p(e,t){1&t&&i!==(i="en"===e[0]?"No similarity":"Pas de similarités")&&q(n,i)},d(e){e&&I(t),e&&I(s)}}}function nn(e){let t,n,s;return t=new Zt({props:{qImg:e[9],appLang:e[0]}}),{c(){be(t.$$.fragment),n=E()},m(e,i){we(t,e,i),C(e,n,i),s=!0},p(e,n){const s={};16&n&&(s.qImg=e[9]),1&n&&(s.appLang=e[0]),t.$set(s)},i(e){s||(ue(t.$$.fragment,e),s=!0)},o(e){de(t.$$.fragment,e),s=!1},d(e){ye(t,e),e&&I(n)}}}function sn(e,t){let n,s,i;return s=new Mt({props:{qImg:t[9],appLang:t[0],manifest:t[1],$$slots:{default:[nn]},$$scope:{ctx:t}}}),{key:e,first:null,c(){n=_(),be(s.$$.fragment),this.first=n},m(e,t){C(e,n,t),we(s,e,t),i=!0},p(e,n){t=e;const i={};16&n&&(i.qImg=t[9]),1&n&&(i.appLang=t[0]),2&n&&(i.manifest=t[1]),8209&n&&(i.$$scope={dirty:n,ctx:t}),s.$set(i)},i(e){i||(ue(s.$$.fragment,e),i=!0)},o(e){de(s.$$.fragment,e),i=!1},d(e){e&&I(n),ye(s,e)}}}function rn(t){let n,s,i="en"===t[0]?"Retrieving similarity page...":"Récupération la page de similarité...";return{c(){n=R("tr"),s=P(i),j(n,"class","faded is-center")},m(e,t){C(e,n,t),k(n,s)},p(e,t){1&t&&i!==(i="en"===e[0]?"Retrieving similarity page...":"Récupération la page de similarité...")&&q(s,i)},i:e,o:e,d(e){e&&I(n)}}}function on(e){let t,n,s,i={ctx:e,current:null,token:null,hasCatch:!0,pending:rn,then:en,catch:Yt,value:8,error:12,blocks:[,,,]};return fe(n=e[3],i),{c(){t=_(),i.block.c()},m(e,n){C(e,t,n),i.block.m(e,i.anchor=n),i.mount=()=>t.parentNode,i.anchor=t,s=!0},p(t,s){e=t,i.ctx=e,8&s&&n!==(n=e[3])&&fe(n,i)||me(i,e,s)},i(e){s||(ue(i.block),s=!0)},o(e){for(let e=0;e<3;e+=1){de(i.blocks[e])}s=!1},d(e){e&&I(t),i.block.d(e),i.token=null,i=null}}}function ln(e){let t,n,s,i,r,o;return t=new jt({props:{store:Ct,nbOfItems:e[2].length}}),s=new Rt({props:{$$slots:{default:[on]},$$scope:{ctx:e}}}),r=new jt({props:{store:Ct,nbOfItems:e[2].length}}),{c(){be(t.$$.fragment),n=E(),be(s.$$.fragment),i=E(),be(r.$$.fragment)},m(e,l){we(t,e,l),C(e,n,l),we(s,e,l),C(e,i,l),we(r,e,l),o=!0},p(e,[n]){const i={};4&n&&(i.nbOfItems=e[2].length),t.$set(i);const o={};8219&n&&(o.$$scope={dirty:n,ctx:e}),s.$set(o);const l={};4&n&&(l.nbOfItems=e[2].length),r.$set(l)},i(e){o||(ue(t.$$.fragment,e),ue(s.$$.fragment,e),ue(r.$$.fragment,e),o=!0)},o(e){de(t.$$.fragment,e),de(s.$$.fragment,e),de(r.$$.fragment,e),o=!1},d(e){ye(t,e),e&&I(n),ye(s,e),e&&I(i),ye(r,e)}}}function an(e,t,n){let s,i,r;const{qImgs:o,pageQImgs:l,setPageQImgs:a}=Ct;d(e,o,(e=>n(2,s=e))),d(e,l,(e=>n(4,r=e))),d(e,a,(e=>n(3,i=e)));let{appLang:c="en"}=t,{manifest:u=""}=t;return e.$$set=e=>{"appLang"in e&&n(0,c=e.appLang),"manifest"in e&&n(1,u=e.manifest)},[c,u,s,i,r,o,l,a]}class cn extends xe{constructor(e){super(),ke(this,e,an,ln,o,{appLang:0,manifest:1})}}function un(e,t,n){const s=e.slice();return s[8]=t[n][0],s[9]=t[n][1],s}function dn(e){let t;return{c(){t=R("span"),t.textContent="current",j(t,"class","tag is-dark svelte-503e8j")},m(e,n){C(e,t,n)},d(e){e&&I(t)}}}function pn(e){let t,n,s,r,o,l,a,c,u=e[5](e[8]),d=e[9].title+"",p=u&&dn();function g(){return e[7](e[9])}return{c(){t=R("div"),p&&p.c(),n=E(),s=R("span"),r=P(d),l=E(),j(s,"class",o="tag is-small "+(e[0](e[8])?"is-link":"is-contrasted")+" svelte-503e8j"),j(t,"class","tags has-addons mb-0 is-hoverable")},m(e,i){C(e,t,i),p&&p.m(t,null),k(t,n),k(t,s),k(s,r),k(t,l),a||(c=[N(t,"click",g),N(t,"keyup",null)],a=!0)},p(i,l){e=i,2&l&&(u=e[5](e[8])),u?p||(p=dn(),p.c(),p.m(t,n)):p&&(p.d(1),p=null),2&l&&d!==(d=e[9].title+"")&&q(r,d),3&l&&o!==(o="tag is-small "+(e[0](e[8])?"is-link":"is-contrasted")+" svelte-503e8j")&&j(s,"class",o)},d(e){e&&I(t),p&&p.d(),a=!1,i(c)}}}function gn(t){let n,s=Object.entries(t[1]),i=[];for(let e=0;e<s.length;e+=1)i[e]=pn(un(t,s,e));return{c(){n=R("div");for(let e=0;e<i.length;e+=1)i[e].c();j(n,"class","field is-grouped is-grouped-multiline")},m(e,t){C(e,n,t);for(let e=0;e<i.length;e+=1)i[e]&&i[e].m(n,null)},p(e,[t]){if(51&t){let r;for(s=Object.entries(e[1]),r=0;r<s.length;r+=1){const o=un(e,s,r);i[r]?i[r].p(o,t):(i[r]=pn(o),i[r].c(),i[r].m(n,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=s.length}},i:e,o:e,d(e){e&&I(n),S(i,e)}}}function fn(e,t,n){let s,i;const{comparedRegions:r,isSelected:o}=Ct;d(e,r,(e=>n(1,i=e))),d(e,o,(e=>n(0,s=e)));let{imgPrefix:l=""}=t;function a(e){s(e.ref)?Ct.unselect(e.ref):Ct.select(e)}return e.$$set=e=>{"imgPrefix"in e&&n(6,l=e.imgPrefix)},[s,i,r,o,a,function(e){return e.startsWith(l)},l,e=>a(e)]}class mn extends xe{constructor(e){super(),ke(this,e,fn,gn,o,{imgPrefix:6})}}function hn(e){let t,n;return t=new Rt({props:{$$slots:{default:[$n]},$$scope:{ctx:e}}}),{c(){be(t.$$.fragment)},m(e,s){we(t,e,s),n=!0},p(e,n){const s={};64&n&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(ue(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function $n(t){let n,s,i,r=t[5]+"";return{c(){n=R("tr"),s=P("Error when retrieving similarities: "),i=P(r),j(n,"class","faded is-center")},m(e,t){C(e,n,t),k(n,s),k(n,i)},p:e,d(e){e&&I(n)}}}function bn(e){let t,n,s,i;return t=new mn({props:{appLang:e[0],imgPrefix:e[1]}}),s=new cn({props:{appLang:e[0],manifest:e[2]}}),{c(){be(t.$$.fragment),n=E(),be(s.$$.fragment)},m(e,r){we(t,e,r),C(e,n,r),we(s,e,r),i=!0},p(e,n){const i={};1&n&&(i.appLang=e[0]),2&n&&(i.imgPrefix=e[1]),t.$set(i);const r={};1&n&&(r.appLang=e[0]),4&n&&(r.manifest=e[2]),s.$set(r)},i(e){i||(ue(t.$$.fragment,e),ue(s.$$.fragment,e),i=!0)},o(e){de(t.$$.fragment,e),de(s.$$.fragment,e),i=!1},d(e){ye(t,e),e&&I(n),ye(s,e)}}}function wn(e){let t,n;return t=new Rt({props:{$$slots:{default:[yn]},$$scope:{ctx:e}}}),{c(){be(t.$$.fragment)},m(e,s){we(t,e,s),n=!0},p(e,n){const s={};65&n&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(ue(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function yn(e){let t,n,s="en"===e[0]?"Retrieving similarities...":"Récupération des similarités...";return{c(){t=R("tr"),n=P(s),j(t,"class","faded is-center")},m(e,s){C(e,t,s),k(t,n)},p(e,t){1&t&&s!==(s="en"===e[0]?"Retrieving similarities...":"Récupération des similarités...")&&q(n,s)},d(e){e&&I(t)}}}function vn(e){let t,n,s={ctx:e,current:null,token:null,hasCatch:!0,pending:wn,then:bn,catch:hn,value:4,error:5,blocks:[,,,]};return fe(e[3],s),{c(){t=_(),s.block.c()},m(e,i){C(e,t,i),s.block.m(e,s.anchor=i),s.mount=()=>t.parentNode,s.anchor=t,n=!0},p(t,[n]){me(s,e=t,n)},i(e){n||(ue(s.block),n=!0)},o(e){for(let e=0;e<3;e+=1){de(s.blocks[e])}n=!1},d(e){e&&I(t),s.block.d(e),s.token=null,s=null}}}function kn(e,t,n){const{fetchSimilarity:s}=Ct;let{appLang:i="en"}=t,{imgPrefix:r=""}=t,{manifest:o=""}=t;return e.$$set=e=>{"appLang"in e&&n(0,i=e.appLang),"imgPrefix"in e&&n(1,r=e.imgPrefix),"manifest"in e&&n(2,o=e.manifest)},[i,r,o,s]}class xn extends xe{constructor(e){super(),ke(this,e,kn,vn,o,{appLang:0,imgPrefix:1,manifest:2})}}function Ln(e){let t,n,s,i,r,o,l,c,u,d,g,$,b,w,y,v,x,L;const S=e[4].default,O=p(S,e,e[3],null);return{c(){t=R("tr"),n=R("th"),s=R("div"),i=R("img"),l=E(),c=R("div"),u=R("a"),d=R("i"),g=P("\n                    Page "),$=P(e[0]),w=E(),y=R("td"),v=R("div"),x=R("div"),O&&O.c(),a(i.src,r=Oe(e[1],"full","250,"))||j(i,"src",r),j(i,"alt",o="Canvas "+e[0]),j(i,"class","mb-3 card"),j(d,"class","fa-solid fa-pen-to-square"),j(u,"class","tag px-2 py-1 is-rounded is-hoverable"),j(u,"href",b=Pe(e[2],e[0])),j(u,"target","_blank"),j(c,"class","is-center mb-1"),j(s,"class","content-wrapper py-5"),j(n,"class","is-3 center-flex is-narrow"),A(n,"width","260px"),j(x,"class","grid is-gap-2"),j(v,"class","fixed-grid has-6-cols"),j(y,"class","p-5 is-fullwidth")},m(e,r){C(e,t,r),k(t,n),k(n,s),k(s,i),k(s,l),k(s,c),k(c,u),k(u,d),k(u,g),k(u,$),k(t,w),k(t,y),k(y,v),k(v,x),O&&O.m(x,null),L=!0},p(e,[t]){(!L||2&t&&!a(i.src,r=Oe(e[1],"full","250,")))&&j(i,"src",r),(!L||1&t&&o!==(o="Canvas "+e[0]))&&j(i,"alt",o),(!L||1&t)&&q($,e[0]),(!L||5&t&&b!==(b=Pe(e[2],e[0])))&&j(u,"href",b),O&&O.p&&(!L||8&t)&&m(O,S,e,e[3],L?f(S,e[3],t,null):h(e[3]),null)},i(e){L||(ue(O,e),L=!0)},o(e){de(O,e),L=!1},d(e){e&&I(t),O&&O.d(e)}}}function Cn(e,t,n){let{$$slots:s={},$$scope:i}=t,{canvasNb:r}=t,{canvasImg:o}=t,{manifest:l}=t;return e.$$set=e=>{"canvasNb"in e&&n(0,r=e.canvasNb),"canvasImg"in e&&n(1,o=e.canvasImg),"manifest"in e&&n(2,l=e.manifest),"$$scope"in e&&n(3,i=e.$$scope)},[r,o,l,i,s]}class In extends xe{constructor(e){super(),ke(this,e,Cn,Ln,o,{canvasNb:0,canvasImg:1,manifest:2})}}function Sn(e,t,n){const s=e.slice();return s[14]=t[n][0],s[15]=t[n][1],s}function Rn(e,t,n){const s=e.slice();return s[18]=t[n],s}function On(t){let n,s,i="en"===t[0]?`Error when retrieving paginated regions: ${t[21]}`:`Erreur de récupération des pages : ${t[21]}`;return{c(){n=R("tr"),s=P(i),j(n,"class","faded is-center")},m(e,t){C(e,n,t),k(n,s)},p(e,t){129&t&&i!==(i="en"===e[0]?`Error when retrieving paginated regions: ${e[21]}`:`Erreur de récupération des pages : ${e[21]}`)&&q(s,i)},i:e,o:e,d(e){e&&I(n)}}}function Pn(e){let t,n,s,i,r;const o=[_n,En],l=[];function a(e,n){return 256&n&&(t=null),null==t&&(t=!!(Object.values(e[8]).length>0)),t?0:1}return n=a(e,-1),s=l[n]=o[n](e),{c(){s.c(),i=_()},m(e,t){l[n].m(e,t),C(e,i,t),r=!0},p(e,t){let r=n;n=a(e,t),n===r?l[n].p(e,t):(ae(),de(l[r],1,1,(()=>{l[r]=null})),ce(),s=l[n],s?s.p(e,t):(s=l[n]=o[n](e),s.c()),ue(s,1),s.m(i.parentNode,i))},i(e){r||(ue(s),r=!0)},o(e){de(s),r=!1},d(e){l[n].d(e),e&&I(i)}}}function En(e){let t,n,s;return n=new ot({props:{appLang:e[0],modules:e[3],witness:e[4]}}),{c(){t=R("tr"),be(n.$$.fragment)},m(e,i){C(e,t,i),we(n,t,null),s=!0},p(e,t){const s={};1&t&&(s.appLang=e[0]),8&t&&(s.modules=e[3]),16&t&&(s.witness=e[4]),n.$set(s)},i(e){s||(ue(n.$$.fragment,e),s=!0)},o(e){de(n.$$.fragment,e),s=!1},d(e){e&&I(t),ye(n)}}}function _n(e){let t,n,s=Object.entries(e[8]),i=[];for(let t=0;t<s.length;t+=1)i[t]=jn(Sn(e,s,t));const r=e=>de(i[e],1,1,(()=>{i[e]=null}));return{c(){for(let e=0;e<i.length;e+=1)i[e].c();t=_()},m(e,s){for(let t=0;t<i.length;t+=1)i[t]&&i[t].m(e,s);C(e,t,s),n=!0},p(e,n){if(2403&n){let o;for(s=Object.entries(e[8]),o=0;o<s.length;o+=1){const r=Sn(e,s,o);i[o]?(i[o].p(r,n),ue(i[o],1)):(i[o]=jn(r),i[o].c(),ue(i[o],1),i[o].m(t.parentNode,t))}for(ae(),o=s.length;o<i.length;o+=1)r(o);ce()}},i(e){if(!n){for(let e=0;e<s.length;e+=1)ue(i[e]);n=!0}},o(e){i=i.filter(Boolean);for(let e=0;e<i.length;e+=1)de(i[e]);n=!1},d(e){S(i,e),e&&I(t)}}}function Nn(e,t){let n,s,i;return s=new Ke({props:{item:t[18],appLang:t[0],isSquare:!1,isCopied:t[5](t[18])}}),s.$on("copyRef",(function(){r(t[6])&&t[6].apply(this,arguments)})),{key:e,first:null,c(){n=_(),be(s.$$.fragment),this.first=n},m(e,t){C(e,n,t),we(s,e,t),i=!0},p(e,n){t=e;const i={};256&n&&(i.item=t[18]),1&n&&(i.appLang=t[0]),288&n&&(i.isCopied=t[5](t[18])),s.$set(i)},i(e){i||(ue(s.$$.fragment,e),i=!0)},o(e){de(s.$$.fragment,e),i=!1},d(e){e&&I(n),ye(s,e)}}}function Tn(e){let t,n,s=[],i=new Map,r=Object.values(e[15]);const o=e=>e[18].id;for(let t=0;t<r.length;t+=1){let n=Rn(e,r,t),l=o(n);i.set(l,s[t]=Nn(l,n))}return{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=E()},m(e,i){for(let t=0;t<s.length;t+=1)s[t]&&s[t].m(e,i);C(e,t,i),n=!0},p(e,n){353&n&&(r=Object.values(e[15]),ae(),s=$e(s,n,o,1,e,r,i,t.parentNode,he,Nn,t,Rn),ce())},i(e){if(!n){for(let e=0;e<r.length;e+=1)ue(s[e]);n=!0}},o(e){for(let e=0;e<s.length;e+=1)de(s[e]);n=!1},d(e){for(let t=0;t<s.length;t+=1)s[t].d(e);e&&I(t)}}}function jn(e){let t,n;return t=new In({props:{canvasImg:e[11](e[14]),canvasNb:e[14],manifest:e[1],$$slots:{default:[Tn]},$$scope:{ctx:e}}}),{c(){be(t.$$.fragment)},m(e,s){we(t,e,s),n=!0},p(e,n){const s={};256&n&&(s.canvasImg=e[11](e[14])),256&n&&(s.canvasNb=e[14]),2&n&&(s.manifest=e[1]),4194657&n&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(ue(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function qn(t){let n,s,i="en"===t[0]?"Retrieving paginated regions...":"Récupération des pages...";return{c(){n=R("tr"),s=P(i),j(n,"class","faded is-center")},m(e,t){C(e,n,t),k(n,s)},p(e,t){1&t&&i!==(i="en"===e[0]?"Retrieving paginated regions...":"Récupération des pages...")&&q(s,i)},i:e,o:e,d(e){e&&I(n)}}}function An(e){let t,n,s,i={ctx:e,current:null,token:null,hasCatch:!0,pending:qn,then:Pn,catch:On,value:13,error:21,blocks:[,,,]};return fe(n=e[7],i),{c(){t=_(),i.block.c()},m(e,n){C(e,t,n),i.block.m(e,i.anchor=n),i.mount=()=>t.parentNode,i.anchor=t,s=!0},p(t,s){e=t,i.ctx=e,128&s&&n!==(n=e[7])&&fe(n,i)||me(i,e,s)},i(e){s||(ue(i.block),s=!0)},o(e){for(let e=0;e<3;e+=1){de(i.blocks[e])}s=!1},d(e){e&&I(t),i.block.d(e),i.token=null,i=null}}}function Mn(e){let t,n,s,i,r,o;return t=new jt({props:{store:Te,nbOfItems:e[2]}}),s=new Rt({props:{$$slots:{default:[An]},$$scope:{ctx:e}}}),r=new jt({props:{store:Te,nbOfItems:e[2]}}),{c(){be(t.$$.fragment),n=E(),be(s.$$.fragment),i=E(),be(r.$$.fragment)},m(e,l){we(t,e,l),C(e,n,l),we(s,e,l),C(e,i,l),we(r,e,l),o=!0},p(e,[n]){const i={};4&n&&(i.nbOfItems=e[2]),t.$set(i);const o={};4194811&n&&(o.$$scope={dirty:n,ctx:e}),s.$set(o);const l={};4&n&&(l.nbOfItems=e[2]),r.$set(l)},i(e){o||(ue(t.$$.fragment,e),ue(s.$$.fragment,e),ue(r.$$.fragment,e),o=!0)},o(e){de(t.$$.fragment,e),de(s.$$.fragment,e),de(r.$$.fragment,e),o=!1},d(e){ye(t,e),e&&I(n),ye(s,e),e&&I(i),ye(r,e)}}}function Vn(e,t,n){let s,i;const{pageRegions:r,fetchPages:o}=Te;d(e,r,(e=>n(8,i=e))),d(e,o,(e=>n(7,s=e)));let{appLang:l="en"}=t,{manifest:a=""}=t,{nbOfPages:c=1}=t,{modules:u=[]}=t,{witness:p={}}=t,{isItemCopied:g}=t,{handleCopyRef:f}=t;return e.$$set=e=>{"appLang"in e&&n(0,l=e.appLang),"manifest"in e&&n(1,a=e.manifest),"nbOfPages"in e&&n(2,c=e.nbOfPages),"modules"in e&&n(3,u=e.modules),"witness"in e&&n(4,p=e.witness),"isItemCopied"in e&&n(5,g=e.isItemCopied),"handleCopyRef"in e&&n(6,f=e.handleCopyRef)},[l,a,c,u,p,g,f,s,i,r,o,function(e){return`${imgPrefix}_${t=e,n=String(c).length+1,t.toString().padStart(n,"0")}`;var t,n}]}class Un extends xe{constructor(e){super(),ke(this,e,Vn,Mn,o,{appLang:0,manifest:1,nbOfPages:2,modules:3,witness:4,isItemCopied:5,handleCopyRef:6})}}function zn(e,t,n){const s=e.slice();return s[29]=t[n][0],s[30]=t[n][1],s}function Fn(e,t,n){const s=e.slice();return s[34]=t[n],s}function Bn(e,t,n){const s=e.slice();return s[38]=t[n][0],s[30]=t[n][1],s}function Dn(e){let t,n,s,r,o,l,a=e[30].text+"";function c(){return e[25](e[38])}return{c(){t=R("li"),n=R("a"),s=P(a),r=E(),j(n,"href",null),M(t,"is-active",e[38]===e[12])},m(e,i){C(e,t,i),k(t,n),k(n,s),k(t,r),o||(l=[N(t,"click",c),N(t,"keyup",is)],o=!0)},p(n,i){e=n,1024&i[0]&&a!==(a=e[30].text+"")&&q(s,a),5120&i[0]&&M(t,"is-active",e[38]===e[12])},d(e){e&&I(t),o=!1,i(l)}}}function Hn(t){let n;return{c(){n=R("div"),n.textContent="tout doux"},m(e,t){C(e,n,t)},p:e,i:e,o:e,d(e){e&&I(n)}}}function Jn(e){let t,n;return t=new xn({props:{appLang:e[1],imgPrefix:e[4],manifest:e[2]}}),{c(){be(t.$$.fragment)},m(e,s){we(t,e,s),n=!0},p(e,n){const s={};2&n[0]&&(s.appLang=e[1]),16&n[0]&&(s.imgPrefix=e[4]),4&n[0]&&(s.manifest=e[2]),t.$set(s)},i(e){n||(ue(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function Kn(e){let t,n;return t=new Un({props:{appLang:e[1],manifest:e[2],nbOfPages:e[5],isItemCopied:e[11],handleCopyRef:e[22],modules:e[6],witness:e[7]}}),{c(){be(t.$$.fragment)},m(e,s){we(t,e,s),n=!0},p(e,n){const s={};2&n[0]&&(s.appLang=e[1]),4&n[0]&&(s.manifest=e[2]),32&n[0]&&(s.nbOfPages=e[5]),2048&n[0]&&(s.isItemCopied=e[11]),64&n[0]&&(s.modules=e[6]),128&n[0]&&(s.witness=e[7]),t.$set(s)},i(e){n||(ue(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function Xn(e){let t,n,s={ctx:e,current:null,token:null,hasCatch:!0,pending:Yn,then:Gn,catch:Qn,value:33,error:37,blocks:[,,,]};return fe(e[18],s),{c(){t=R("div"),s.block.c(),j(t,"class","grid is-gap-2")},m(e,i){C(e,t,i),s.block.m(t,s.anchor=null),s.mount=()=>t,s.anchor=null,n=!0},p(t,n){me(s,e=t,n)},i(e){n||(ue(s.block),n=!0)},o(e){for(let e=0;e<3;e+=1){de(s.blocks[e])}n=!1},d(e){e&&I(t),s.block.d(),s.token=null,s=null}}}function Qn(t){let n,s,i,r=t[37]+"";return{c(){n=R("div"),s=P("Error when retrieving regions: "),i=P(r)},m(e,t){C(e,n,t),k(n,s),k(n,i)},p:e,i:e,o:e,d(e){e&&I(n)}}}function Gn(e){let t,n,s=[],i=new Map,r=Object.values(e[15]);const o=e=>e[34].id;for(let t=0;t<r.length;t+=1){let n=Fn(e,r,t),l=o(n);i.set(l,s[t]=Wn(l,n))}let l=null;return r.length||(l=Zn(e)),{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=_(),l&&l.c()},m(e,i){for(let t=0;t<s.length;t+=1)s[t]&&s[t].m(e,i);C(e,t,i),l&&l.m(e,i),n=!0},p(e,n){5802178&n[0]&&(r=Object.values(e[15]),ae(),s=$e(s,n,o,1,e,r,i,t.parentNode,he,Wn,t,Fn),ce(),!r.length&&l?l.p(e,n):r.length?l&&(ae(),de(l,1,1,(()=>{l=null})),ce()):(l=Zn(e),l.c(),ue(l,1),l.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<r.length;e+=1)ue(s[e]);n=!0}},o(e){for(let e=0;e<s.length;e+=1)de(s[e]);n=!1},d(e){for(let t=0;t<s.length;t+=1)s[t].d(e);e&&I(t),l&&l.d(e)}}}function Zn(e){let t,n;return t=new ot({props:{appLang:e[1],modules:e[6],witness:e[7],currentRegionId:e[20],baseUrl:e[19]}}),{c(){be(t.$$.fragment)},m(e,s){we(t,e,s),n=!0},p(e,n){const s={};2&n[0]&&(s.appLang=e[1]),64&n[0]&&(s.modules=e[6]),128&n[0]&&(s.witness=e[7]),t.$set(s)},i(e){n||(ue(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function Wn(e,t){let n,s,i;return s=new Ke({props:{item:t[34],appLang:t[1],isCopied:t[11](t[34])}}),s.$on("copyRef",t[22]),{key:e,first:null,c(){n=_(),be(s.$$.fragment),this.first=n},m(e,t){C(e,n,t),we(s,e,t),i=!0},p(e,n){t=e;const i={};32768&n[0]&&(i.item=t[34]),2&n[0]&&(i.appLang=t[1]),34816&n[0]&&(i.isCopied=t[11](t[34])),s.$set(i)},i(e){i||(ue(s.$$.fragment,e),i=!0)},o(e){de(s.$$.fragment,e),i=!1},d(e){e&&I(n),ye(s,e)}}}function Yn(t){let n,s,i="en"===t[1]?"Retrieving regions...":"Récupération des régions...";return{c(){n=R("div"),s=P(i),j(n,"class","faded is-center")},m(e,t){C(e,n,t),k(n,s)},p(e,t){2&t[0]&&i!==(i="en"===e[1]?"Retrieving regions...":"Récupération des régions...")&&q(s,i)},i:e,o:e,d(e){e&&I(n)}}}function es(e){let t,n,s="en"===e[1]?"No regions in selection":"Aucune région sélectionnée";return{c(){t=R("div"),n=P(s)},m(e,s){C(e,t,s),k(t,n)},p(e,t){2&t[0]&&s!==(s="en"===e[1]?"No regions in selection":"Aucune région sélectionnée")&&q(n,s)},d(e){e&&I(t)}}}function ts(e){let t,n,s=Object.entries(e[9]),i=[];for(let t=0;t<s.length;t+=1)i[t]=ns(zn(e,s,t));return{c(){t=R("div"),n=R("div");for(let e=0;e<i.length;e+=1)i[e].c();j(n,"class","grid is-gap-2"),j(t,"class","fixed-grid has-6-cols")},m(e,s){C(e,t,s),k(t,n);for(let e=0;e<i.length;e+=1)i[e]&&i[e].m(n,null)},p(e,t){if(513&t[0]){let r;for(s=Object.entries(e[9]),r=0;r<s.length;r+=1){const o=zn(e,s,r);i[r]?i[r].p(o,t):(i[r]=ns(o),i[r].c(),i[r].m(n,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=s.length}},d(e){e&&I(t),S(i,e)}}}function ns(e){let t,n,s,i,r,o,l,c,u,d,p,g,f,m=e[30].title+"";function h(){return e[26](e[29])}return{c(){t=R("div"),n=R("figure"),s=R("img"),r=E(),o=R("div"),l=R("span"),c=P(m),u=E(),d=R("button"),p=E(),a(s.src,i=Oe(e[30].img,e[30].xyhw,"96,"))||j(s,"src",i),j(s,"alt","Extracted region"),j(l,"class","overlay-desc"),j(o,"class","overlay is-center svelte-403wty"),j(n,"class","image is-64x64 card"),j(d,"class","delete region-btn"),j(d,"aria-label","remove from selection"),j(t,"class","selection cell svelte-403wty")},m(e,i){C(e,t,i),k(t,n),k(n,s),k(n,r),k(n,o),k(o,l),k(l,c),k(t,u),k(t,d),k(t,p),g||(f=N(d,"click",h),g=!0)},p(t,n){e=t,512&n[0]&&!a(s.src,i=Oe(e[30].img,e[30].xyhw,"96,"))&&j(s,"src",i),512&n[0]&&m!==(m=e[30].title+"")&&q(c,m)},d(e){e&&I(t),g=!1,f()}}}function ss(e){let t,n,s,i,r,o,l,a,c,u,d,p,g,f,m,h,$,b,w,y,v,x,L,O,_,N,T,A,M,V,U,z,F,B,D,H,J,K,X,Q="en"===e[1]?"Selected regions":"Regions sélectionnées";t=new Ve({props:{visible:e[14]}}),s=new nt({props:{appLang:e[1]}}),r=new Ge({props:{selectionLength:e[8],appLang:e[1]}}),u=new gt({props:{appLang:e[1],witness:e[7],baseUrl:e[19],currentRegionId:e[20]}}),g=new Lt({props:{appLang:e[1],manifest:e[2],isValidated:e[3],regionsType:e[0]}});let G=Object.entries(e[10]),Z=[];for(let t=0;t<G.length;t+=1)Z[t]=Dn(Bn(e,G,t));const W=[Xn,Kn,Jn,Hn],Y=[];function ee(e,t){return"all"===e[12]?0:"page"===e[12]?1:"similarity"===e[12]?2:"vectorization"===e[12]?3:-1}function te(e,t){return e[13]?ts:es}~(b=ee(e))&&(w=Y[b]=W[b](e));let ne=te(e),se=ne(e);return K=new Ye({props:{appLang:e[1],isRegion:!0}}),{c(){be(t.$$.fragment),n=E(),be(s.$$.fragment),i=E(),be(r.$$.fragment),o=E(),l=R("div"),a=R("div"),c=R("div"),be(u.$$.fragment),d=E(),p=R("div"),be(g.$$.fragment),f=E(),m=R("div"),h=R("ul");for(let e=0;e<Z.length;e+=1)Z[e].c();$=E(),w&&w.c(),y=E(),v=R("div"),x=R("div"),L=E(),O=R("div"),_=R("div"),N=R("div"),T=R("i"),A=E(),M=P(Q),V=P("\n                ("),U=P(e[8]),z=P(")"),F=E(),B=R("button"),D=E(),H=R("section"),se.c(),J=E(),be(K.$$.fragment),j(c,"class","cell is-right is-middle"),j(p,"class","cell"),j(a,"class","actions grid"),j(h,"class","panel-tabs"),j(m,"class","tabs is-centered"),j(l,"id","nav-actions"),j(l,"class","mb-5 svelte-403wty"),j(x,"class","modal-background"),j(T,"class","fa-solid fa-book-bookmark"),j(N,"class","title is-4 mb-0 media-content"),j(B,"class","delete media-left"),j(B,"aria-label","close"),j(_,"class","modal-card-head media mb-0"),j(H,"class","modal-card-body"),j(O,"class","modal-content"),j(v,"id","selection-modal"),j(v,"class","modal fade"),j(v,"tabindex","-1"),j(v,"aria-labelledby","selection-modal-label"),j(v,"aria-hidden","true")},m(e,w){we(t,e,w),C(e,n,w),we(s,e,w),C(e,i,w),we(r,e,w),C(e,o,w),C(e,l,w),k(l,a),k(a,c),we(u,c,null),k(a,d),k(a,p),we(g,p,null),k(l,f),k(l,m),k(m,h);for(let e=0;e<Z.length;e+=1)Z[e]&&Z[e].m(h,null);C(e,$,w),~b&&Y[b].m(e,w),C(e,y,w),C(e,v,w),k(v,x),k(v,L),k(v,O),k(O,_),k(_,N),k(N,T),k(N,A),k(N,M),k(N,V),k(N,U),k(N,z),k(_,F),k(_,B),k(O,D),k(O,H),se.m(H,null),k(O,J),we(K,O,null),X=!0},p(e,n){const i={};16384&n[0]&&(i.visible=e[14]),t.$set(i);const o={};2&n[0]&&(o.appLang=e[1]),s.$set(o);const l={};256&n[0]&&(l.selectionLength=e[8]),2&n[0]&&(l.appLang=e[1]),r.$set(l);const a={};2&n[0]&&(a.appLang=e[1]),128&n[0]&&(a.witness=e[7]),u.$set(a);const c={};if(2&n[0]&&(c.appLang=e[1]),4&n[0]&&(c.manifest=e[2]),8&n[0]&&(c.isValidated=e[3]),g.$set(c),2102272&n[0]){let t;for(G=Object.entries(e[10]),t=0;t<G.length;t+=1){const s=Bn(e,G,t);Z[t]?Z[t].p(s,n):(Z[t]=Dn(s),Z[t].c(),Z[t].m(h,null))}for(;t<Z.length;t+=1)Z[t].d(1);Z.length=G.length}let d=b;b=ee(e),b===d?~b&&Y[b].p(e,n):(w&&(ae(),de(Y[d],1,1,(()=>{Y[d]=null})),ce()),~b?(w=Y[b],w?w.p(e,n):(w=Y[b]=W[b](e),w.c()),ue(w,1),w.m(y.parentNode,y)):w=null),(!X||2&n[0])&&Q!==(Q="en"===e[1]?"Selected regions":"Regions sélectionnées")&&q(M,Q),(!X||256&n[0])&&q(U,e[8]),ne===(ne=te(e))&&se?se.p(e,n):(se.d(1),se=ne(e),se&&(se.c(),se.m(H,null)));const p={};2&n[0]&&(p.appLang=e[1]),K.$set(p)},i(e){X||(ue(t.$$.fragment,e),ue(s.$$.fragment,e),ue(r.$$.fragment,e),ue(u.$$.fragment,e),ue(g.$$.fragment,e),ue(w),ue(K.$$.fragment,e),X=!0)},o(e){de(t.$$.fragment,e),de(s.$$.fragment,e),de(r.$$.fragment,e),de(u.$$.fragment,e),de(g.$$.fragment,e),de(w),de(K.$$.fragment,e),X=!1},d(e){ye(t,e),e&&I(n),ye(s,e),e&&I(i),ye(r,e),e&&I(o),e&&I(l),ye(u),ye(g),S(Z,e),e&&I($),~b&&Y[b].d(e),e&&I(y),e&&I(v),se.d(),ye(K)}}}const is=()=>null;function rs(e,t,n){let s,i,r,o,l,a,c,u,p;d(e,Se,(e=>n(14,u=e)));const{selected:g}=Ne;d(e,g,(e=>n(24,c=e)));const{allRegions:f,fetchAll:m,pageRegions:h,fetchPages:$}=Te;d(e,f,(e=>n(15,p=e)));const b="Regions";let{appLang:w="en"}=t,{manifest:y=""}=t,{isValidated:v=!1}=t,{imgPrefix:k=""}=t,{nbOfPages:x=1}=t,{modules:L=[]}=t,{witness:C={}}=t;const I=`${window.location.origin}${window.location.pathname}`,S=parseInt(I.split("regions/")[1].replace("/","")),R={all:{text:"en"===w?"All regions":"Toutes les régions"},page:{text:"en"===w?"Per page":"Par page"}};function O(e){n(12,o=e);const t=new URL(window.location);t.searchParams.set("tab",e),window.history.pushState({},"",t)}L.includes("similarity")&&(R.similarity={text:"en"===w?"Similarity":"Similarité"}),L.includes("vectorization")&&(R.vectorization={text:"en"===w?"Vectorization":"Vectorisation"});return e.$$set=e=>{"appLang"in e&&n(1,w=e.appLang),"manifest"in e&&n(2,y=e.manifest),"isValidated"in e&&n(3,v=e.isValidated),"imgPrefix"in e&&n(4,k=e.imgPrefix),"nbOfPages"in e&&n(5,x=e.nbOfPages),"modules"in e&&n(6,L=e.modules),"witness"in e&&n(7,C=e.witness)},e.$$.update=()=>{16777216&e.$$.dirty[0]&&n(9,s=c(!0)),512&e.$$.dirty[0]&&n(8,i=Object.keys(s).length),256&e.$$.dirty[0]&&n(13,r=i>0),8388608&e.$$.dirty[0]&&n(11,a=e=>l===e.ref)},n(12,o=new URLSearchParams(window.location.search).get("tab")??"all"),n(23,l=""),[b,w,y,v,k,x,L,C,i,s,R,a,o,r,u,p,g,f,m,I,S,O,function(e){const{item:t}=e.detail,s=a(t)?"":t.ref;navigator.clipboard.writeText(s),n(23,l=s)},l,c,e=>O(e),e=>Ne.remove(e,b)]}return new class extends xe{constructor(e){super(),ke(this,e,rs,ss,o,{regionsType:0,appLang:1,manifest:2,isValidated:3,imgPrefix:4,nbOfPages:5,modules:6,witness:7},null,[-1,-1])}get regionsType(){return this.$$.ctx[0]}}({target:document.getElementById("region-list"),props:{witness:witness,regionsType:"Regions",appLang:APP_LANG,modules:ADDITIONAL_MODULES,manifest:manifest,isValidated:isValidated,imgPrefix:imgPrefix,nbOfPages:nbOfPages}})}();
//# sourceMappingURL=regionList.js.map
