var regionList=function(){"use strict";function e(){}const t=e=>e;function n(e){return e()}function r(){return Object.create(null)}function o(e){e.forEach(n)}function s(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let l;function c(e,t){return l||(l=document.createElement("a")),l.href=t,e===l.href}function a(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function u(e){let t;return a(e,(e=>t=e))(),t}function d(e,t,n){e.$$.on_destroy.push(a(t,n))}function f(e,t,n,r){if(e){const o=g(e,t,n,r);return e[0](o)}}function g(e,t,n,r){return e[1]&&r?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}function m(e,t,n,r){if(e[2]&&r){const o=e[2](r(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|o[r];return e}return t.dirty|o}return t.dirty}function p(e,t,n,r,o,s){if(o){const i=g(t,n,r,s);e.p(i,o)}}function h(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function $(e){const t="string"==typeof e&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}const w="undefined"!=typeof window;let b=w?()=>window.performance.now():()=>Date.now(),v=w?e=>requestAnimationFrame(e):e;const y=new Set;function k(e){y.forEach((t=>{t.c(e)||(y.delete(t),t.f())})),0!==y.size&&v(k)}function x(e,t){e.appendChild(t)}function C(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function I(e){const t=L("style");return function(e,t){x(e.head||e,t),t.sheet}(C(e),t),t.sheet}function E(e,t,n){e.insertBefore(t,n||null)}function R(e){e.parentNode&&e.parentNode.removeChild(e)}function S(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function L(e){return document.createElement(e)}function O(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function P(e){return document.createTextNode(e)}function M(){return P(" ")}function _(){return P("")}function N(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function j(e){return function(t){return t.preventDefault(),e.call(this,t)}}function q(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function T(e,t){t=""+t,e.data!==t&&(e.data=t)}function A(e,t,n,r){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function U(e,t,n){e.classList[n?"add":"remove"](t)}function V(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(e,n,r,t),o}const z=new Map;let H,B=0;function D(e,t,n,r,o,s,i,l=0){const c=16.666/r;let a="{\n";for(let e=0;e<=1;e+=c){const r=t+(n-t)*s(e);a+=100*e+`%{${i(r,1-r)}}\n`}const u=a+`100% {${i(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${l}`,f=C(e),{stylesheet:g,rules:m}=z.get(f)||function(e,t){const n={stylesheet:I(t),rules:{}};return z.set(e,n),n}(f,e);m[d]||(m[d]=!0,g.insertRule(`@keyframes ${d} ${u}`,g.cssRules.length));const p=e.style.animation||"";return e.style.animation=`${p?`${p}, `:""}${d} ${r}ms linear ${o}ms 1 both`,B+=1,d}function F(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),o=n.length-r.length;o&&(e.style.animation=r.join(", "),B-=o,B||v((()=>{B||(z.forEach((e=>{const{ownerNode:t}=e.stylesheet;t&&R(t)})),z.clear())})))}function Z(e){H=e}function J(){if(!H)throw new Error("Function called outside component initialization");return H}function X(e,t){return J().$$.context.set(e,t),t}function Q(e){return J().$$.context.get(e)}const G=[],K=[];let W=[];const Y=[],ee=Promise.resolve();let te=!1;function ne(e){W.push(e)}const re=new Set;let oe,se=0;function ie(){if(0!==se)return;const e=H;do{try{for(;se<G.length;){const e=G[se];se++,Z(e),le(e.$$)}}catch(e){throw G.length=0,se=0,e}for(Z(null),G.length=0,se=0;K.length;)K.pop()();for(let e=0;e<W.length;e+=1){const t=W[e];re.has(t)||(re.add(t),t())}W.length=0}while(G.length);for(;Y.length;)Y.pop()();te=!1,re.clear(),Z(e)}function le(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ne)}}function ce(e,t,n){e.dispatchEvent(V(`${t?"intro":"outro"}${n}`))}const ae=new Set;let ue;function de(){ue={r:0,c:[],p:ue}}function fe(){ue.r||o(ue.c),ue=ue.p}function ge(e,t){e&&e.i&&(ae.delete(e),e.i(t))}function me(e,t,n,r){if(e&&e.o){if(ae.has(e))return;ae.add(e),ue.c.push((()=>{ae.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const pe={duration:0};function he(n,r,i,l){const c={direction:"both"};let a=r(n,i,c),u=l?0:1,d=null,f=null,g=null;function m(){g&&F(n,g)}function p(e,t){const n=e.b-u;return t*=Math.abs(n),{a:u,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function h(r){const{delay:s=0,duration:i=300,easing:l=t,tick:c=e,css:h}=a||pe,$={start:b()+s,b:r};r||($.group=ue,ue.r+=1),d||f?f=$:(h&&(m(),g=D(n,u,r,i,s,l,h)),r&&c(0,1),d=p($,i),ne((()=>ce(n,r,"start"))),function(e){let t;0===y.size&&v(k),new Promise((n=>{y.add(t={c:e,f:n})}))}((e=>{if(f&&e>f.start&&(d=p(f,i),f=null,ce(n,d.b,"start"),h&&(m(),g=D(n,u,d.b,d.duration,0,l,a.css))),d)if(e>=d.end)c(u=d.b,1-u),ce(n,d.b,"end"),f||(d.b?m():--d.group.r||o(d.group.c)),d=null;else if(e>=d.start){const t=e-d.start;u=d.a+d.d*l(t/d.duration),c(u,1-u)}return!(!d&&!f)})))}return{run(e){s(a)?(oe||(oe=Promise.resolve(),oe.then((()=>{oe=null}))),oe).then((()=>{a=a(c),h(e)})):h(e)},end(){m(),d=f=null}}}function $e(e,t){const n=t.token={};function r(e,r,o,s){if(t.token!==n)return;t.resolved=s;let i=t.ctx;void 0!==o&&(i=i.slice(),i[o]=s);const l=e&&(t.current=e)(i);let c=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==r&&e&&(de(),me(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),fe())})):t.block.d(1),l.c(),ge(l,1),l.m(t.mount(),t.anchor),c=!0),t.block=l,t.blocks&&(t.blocks[r]=l),c&&ie()}if(!(o=e)||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then){if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}else{const n=J();if(e.then((e=>{Z(n),r(t.then,1,t.value,e),Z(null)}),(e=>{if(Z(n),r(t.catch,2,t.error,e),Z(null),!t.hasCatch)throw e})),t.current!==t.pending)return r(t.pending,0),!0}var o}function we(e,t,n){const r=t.slice(),{resolved:o}=e;e.current===e.then&&(r[e.value]=o),e.current===e.catch&&(r[e.error]=o),e.block.p(r,n)}function be(e,t){me(e,1,1,(()=>{t.delete(e.key)}))}function ve(e,t,n,r,s,i,l,c,a,u,d,f){let g=e.length,m=i.length,p=g;const h={};for(;p--;)h[e[p].key]=p;const $=[],w=new Map,b=new Map,v=[];for(p=m;p--;){const e=f(s,i,p),o=n(e);let c=l.get(o);c?r&&v.push((()=>c.p(e,t))):(c=u(o,e),c.c()),w.set(o,$[p]=c),o in h&&b.set(o,Math.abs(p-h[o]))}const y=new Set,k=new Set;function x(e){ge(e,1),e.m(c,d),l.set(e.key,e),d=e.first,m--}for(;g&&m;){const t=$[m-1],n=e[g-1],r=t.key,o=n.key;t===n?(d=t.first,g--,m--):w.has(o)?!l.has(r)||y.has(r)?x(t):k.has(o)?g--:b.get(r)>b.get(o)?(k.add(r),x(t)):(y.add(o),g--):(a(n,l),g--)}for(;g--;){const t=e[g];w.has(t.key)||a(t,l)}for(;m;)x($[m-1]);return o(v),$}function ye(e){e&&e.c()}function ke(e,t,r,i){const{fragment:l,after_update:c}=e.$$;l&&l.m(t,r),i||ne((()=>{const t=e.$$.on_mount.map(n).filter(s);e.$$.on_destroy?e.$$.on_destroy.push(...t):o(t),e.$$.on_mount=[]})),c.forEach(ne)}function xe(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];W.forEach((r=>-1===e.indexOf(r)?t.push(r):n.push(r))),n.forEach((e=>e())),W=t}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ce(e,t){-1===e.$$.dirty[0]&&(G.push(e),te||(te=!0,ee.then(ie)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ie(t,n,s,i,l,c,a,u=[-1]){const d=H;Z(t);const f=t.$$={fragment:null,ctx:[],props:c,update:e,not_equal:l,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(d?d.$$.context:[])),callbacks:r(),dirty:u,skip_bound:!1,root:n.target||d.$$.root};a&&a(f.root);let g=!1;if(f.ctx=s?s(t,n.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return f.ctx&&l(f.ctx[e],f.ctx[e]=o)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](o),g&&Ce(t,e)),n})):[],f.update(),g=!0,o(f.before_update),f.fragment=!!i&&i(f.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);f.fragment&&f.fragment.l(e),e.forEach(R)}else f.fragment&&f.fragment.c();n.intro&&ge(t.$$.fragment),ke(t,n.target,n.anchor,n.customElement),ie()}Z(d)}class Ee{$destroy(){xe(this,1),this.$destroy=e}$on(t,n){if(!s(n))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const e=r.indexOf(n);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Re=[];function Se(t,n=e){let r;const o=new Set;function s(e){if(i(t,e)&&(t=e,r)){const e=!Re.length;for(const e of o)e[1](),Re.push(e,t);if(e){for(let e=0;e<Re.length;e+=2)Re[e][0](Re[e+1]);Re.length=0}}}return{set:s,update:function(e){s(e(t))},subscribe:function(i,l=e){const c=[i,l];return o.add(c),1===o.size&&(r=n(s)||e),i(t),()=>{o.delete(c),0===o.size&&r&&(r(),r=null)}}}}function Le(t,n,r){const i=!Array.isArray(t),l=i?[t]:t,c=n.length<2;return u=t=>{let r=!1;const u=[];let d=0,f=e;const g=()=>{if(d)return;f();const r=n(i?u[0]:u,t);c?t(r):f=s(r)?r:e},m=l.map(((e,t)=>a(e,(e=>{u[t]=e,d&=~(1<<t),r&&g()}),(()=>{d|=1<<t}))));return r=!0,g(),function(){o(m),f(),r=!1}},{subscribe:Se(r,u).subscribe};var u}const Oe=APP_LANG,Pe=USER_ID,Me=CSRF_TOKEN,_e=ADDITIONAL_MODULES,Ne="Regions",je=SAS_APP_URL,qe=CANTALOUPE_APP_URL,Te=Se(!1);async function Ae(e){Te.set(!0);try{return await e()}finally{Te.set(!1)}}function Ue(e=null,t="full",n="full"){if(!e)return"https://via.placeholder.com/96x96?text=No+Image";if((e=e.split("_")).length<3)return"https://via.placeholder.com/96x96?text=No+Image";const r=e[e.length-1].includes(",")?e.pop().replace(".jpg",""):t,o=e.join("_").replace(".jpg","");return`${qe??"http://localhost:8182"}/iiif/2/${o}.jpg/${r}/${n}/0/default.jpg`}function Ve(e=null,t=1){return`${je??"http://localhost:3000"}/index.html?iiif-content=${e}&canvas=${t}`}function ze(e,t=null,n=!1){return new Promise((r=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:r(void 0),t&&(document.getElementById("modal-title").textContent=t),document.getElementById("modal-body").textContent=e,document.getElementById("hidden-msg-btn").click();const o=document.getElementById("cancel-btn"),s=document.getElementById("ok-btn"),i=document.getElementById("modal-bkg"),l=()=>{o.removeEventListener("click",c),i.removeEventListener("click",c),s.removeEventListener("click",a),document.getElementById("modal-footer").hidden=!0},c=()=>{l(),r(!1)},a=()=>{l(),r(!0)};o.addEventListener("click",c),s.addEventListener("click",a)}else n?r(window.confirm(e)):(window.alert(e),r(void 0))}))}const He=function(){const e=Se(JSON.parse(localStorage.getItem("documentSet"))||{}),{subscribe:t,get:n,update:r}=e;function o(e){localStorage.setItem("documentSet",JSON.stringify(e))}function s(e,t=!0){return t?e[Ne]??{}:Object.entries(e).filter((([e,t])=>e!==Ne))}function i(e,t,n){if(e[n]){const{[t]:r,...o}=e[n];e={...e,[n]:o}}return o(e),e}function l(e,t){return e.hasOwnProperty(t.type)||(e[t.type]={}),e[t.type]={...e[t.type],[t.id]:t},o(e),e}return{subscribe:t,save:()=>r((e=>(console.log(e),e))),empty:e=>r((t=>(e?delete t[Ne]:Object.keys(t).forEach((e=>{e!==Ne&&delete t[e]})),o(t),t))),addAll:e=>r((t=>function(e,t){return t.forEach((t=>{e[t.type]||(e[t.type]={}),e[t.type][t.id]=t})),o(e),e}(t,e))),removeAll:(e,t)=>r((n=>function(e,t,n){return e[n]?(t.forEach((t=>{delete e[n][t]})),o(e),e):e}(n,e,t))),remove:(e,t)=>r((n=>i(n,e,t))),add:e=>r((t=>l(t,e))),toggle:e=>r((t=>t[e.type]?.[e.id]?i(t,e.id,e.type):l(t,e))),toggleAll:(e,t,n)=>r((e=>{})),isSelected:Le(e,(e=>t=>e[t.type]?.hasOwnProperty(t.id)||!1)),selected:Le(e,(e=>t=>s(e,t))),nbSelected:Le(e,(e=>t=>{const n=s(e,t);return t?Object.keys(n).length:n.reduce(((e,[t,n])=>e+Object.keys(n).length),0)}))}}();const Be=function(){const e=Se(1),t=Se({}),n=Se({}),r=`${window.location.origin}${window.location.pathname}`;if("undefined"!=typeof window){const t=new URLSearchParams(window.location.search).get("p");t&&e.set(parseInt(t))}const o=(async()=>{const e=await fetch(`${r}canvas`),n=await e.json();let o={};return Object.values(n).forEach((e=>{Object.entries(e).forEach((([e,t])=>{o[e]=t}))})),t.set(o),n})(),s=Le(e,(e=>(async()=>{const t=await fetch(`${r}canvas?p=${e}`),o=await t.json();return n.set(o),o})()));return{currentPage:e,pageRegions:n,allRegions:t,fetchPages:s,fetchAll:o,handlePageUpdate:function(t){if(e.set(t),"undefined"!=typeof window){const e=new URL(window.location.href);e.searchParams.set("p",t),window.history.pushState({},"",e)}},remove:function(e){t.update((t=>(delete t[e],{...t}))),n.update((t=>{for(const n in t)if(t[n][e]){const{[e]:r,...o}=t[n];return t[n]=o,t}return t}))}}}();function De(e){const t=e-1;return t*t*t+1}function Fe(e,{delay:n=0,duration:r=400,easing:o=t}={}){const s=+getComputedStyle(e).opacity;return{delay:n,duration:r,easing:o,css:e=>"opacity: "+e*s}}function Ze(e,{delay:t=0,duration:n=400,easing:r=De,x:o=0,y:s=0,opacity:i=0}={}){const l=getComputedStyle(e),c=+l.opacity,a="none"===l.transform?"":l.transform,u=c*(1-i),[d,f]=$(o),[g,m]=$(s);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${a} translate(${(1-e)*d}${f}, ${(1-e)*g}${m});\n\t\t\topacity: ${c-u*t}`}}function Je(e){let t,n,r;return{c(){t=L("div"),t.innerHTML='<div class="loader svelte-vizlcg"></div>',q(t,"class","bkg-shade svelte-vizlcg")},m(e,n){E(e,t,n),r=!0},i(e){r||(ne((()=>{r&&(n||(n=he(t,Fe,{duration:150},!0)),n.run(1))})),r=!0)},o(e){n||(n=he(t,Fe,{duration:150},!1)),n.run(0),r=!1},d(e){e&&R(t),e&&n&&n.end()}}}function Xe(e){let t,n,r=e[0]&&Je();return{c(){r&&r.c(),t=_()},m(e,o){r&&r.m(e,o),E(e,t,o),n=!0},p(e,[n]){e[0]?r?1&n&&ge(r,1):(r=Je(),r.c(),ge(r,1),r.m(t.parentNode,t)):r&&(de(),me(r,1,1,(()=>{r=null})),fe())},i(e){n||(ge(r),n=!0)},o(e){me(r),n=!1},d(e){r&&r.d(e),e&&R(t)}}}function Qe(e,t,n){let{visible:r=!1}=t;return e.$$set=e=>{"visible"in e&&n(0,r=e.visible)},[r]}class Ge extends Ee{constructor(e){super(),Ie(this,e,Qe,Xe,i,{visible:0})}}function Ke(e){let t;return{c(){t=O("path"),q(t,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),q(t,"class","svelte-es4wbs")},m(e,n){E(e,t,n)},d(e){e&&R(t)}}}function We(e){let t;return{c(){t=O("path"),q(t,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),q(t,"class","svelte-es4wbs")},m(e,n){E(e,t,n)},d(e){e&&R(t)}}}function Ye(t){let n,r="en"===Oe?"Copy ID":"Copier l'ID";return{c(){n=P(r)},m(e,t){E(e,n,t)},p:e,d(e){e&&R(n)}}}function et(t){let n,r="en"===Oe?"Copied!":"Copié !";return{c(){n=P(r)},m(e,t){E(e,n,t)},p:e,d(e){e&&R(n)}}}function tt(e){let t,n,r,s,i,l,a,u,d,f,g,m,p,h,$,w,b,v,y,k=e[0].title+"";function C(e,t){return e[1]?We:Ke}let I=C(e),S=I(e);function _(e,t){return e[1]?et:Ye}let j=_(e),A=j(e);return{c(){t=L("div"),n=L("figure"),r=L("img"),i=M(),l=L("div"),a=L("span"),u=P(k),f=M(),g=L("button"),m=O("svg"),S.c(),p=M(),h=L("span"),A.c(),c(r.src,s=Ue(e[0].img,e[0].xyhw,e[2]?"96,":"140,"))||q(r,"src",s),q(r,"alt","Extracted region"),q(a,"class","overlay-desc"),q(l,"class","overlay is-center svelte-es4wbs"),q(n,"class",d="image card "+(e[2]?"is-96x96":"")+" svelte-es4wbs"),q(n,"tabindex","-1"),q(m,"xmlns","http://www.w3.org/2000/svg"),q(m,"viewBox","0 0 384 512"),q(m,"class","svelte-es4wbs"),q(h,"class","tooltip svelte-es4wbs"),q(g,"class","button region-btn tag svelte-es4wbs"),q(t,"class",$="region image is-center "+(e[3](e[0])?"checked":"")+" svelte-es4wbs")},m(o,s){E(o,t,s),x(t,n),x(n,r),x(n,i),x(n,l),x(l,a),x(a,u),x(t,f),x(t,g),x(g,m),S.m(m,null),x(g,p),x(g,h),A.m(h,null),b=!0,v||(y=[N(n,"click",e[6]),N(n,"keyup",nt),N(g,"click",e[7])],v=!0)},p(e,[o]){(!b||5&o&&!c(r.src,s=Ue(e[0].img,e[0].xyhw,e[2]?"96,":"140,")))&&q(r,"src",s),(!b||1&o)&&k!==(k=e[0].title+"")&&T(u,k),(!b||4&o&&d!==(d="image card "+(e[2]?"is-96x96":"")+" svelte-es4wbs"))&&q(n,"class",d),I!==(I=C(e))&&(S.d(1),S=I(e),S&&(S.c(),S.m(m,null))),j===(j=_(e))&&A?A.p(e,o):(A.d(1),A=j(e),A&&(A.c(),A.m(h,null))),(!b||9&o&&$!==($="region image is-center "+(e[3](e[0])?"checked":"")+" svelte-es4wbs"))&&q(t,"class",$)},i(e){b||(ne((()=>{b&&(w||(w=he(t,Fe,{duration:500},!0)),w.run(1))})),b=!0)},o(e){w||(w=he(t,Fe,{duration:500},!1)),w.run(0),b=!1},d(e){e&&R(t),S.d(),A.d(),e&&w&&w.end(),v=!1,o(y)}}}const nt=()=>null;function rt(e,t,n){let r;const{isSelected:o}=He;d(e,o,(e=>n(3,r=e)));const s=function(){const e=J();return(t,n,{cancelable:r=!1}={})=>{const o=e.$$.callbacks[t];if(o){const s=V(t,n,{cancelable:r});return o.slice().forEach((t=>{t.call(e,s)})),!s.defaultPrevented}return!0}}();let{item:i}=t,{isCopied:l=!1}=t,{isSquare:c=!0}=t;function a(){s("copyRef",{item:i})}return e.$$set=e=>{"item"in e&&n(0,i=e.item),"isCopied"in e&&n(1,l=e.isCopied),"isSquare"in e&&n(2,c=e.isSquare)},[i,l,c,r,o,a,()=>He.toggle(i),()=>a()]}class ot extends Ee{constructor(e){super(),Ie(this,e,rt,tt,i,{item:0,isCopied:1,isSquare:2})}}function st(t){let n,r,o,s,i,l,c,a,u,d="en"===Oe?"Selection":"Sélection";return{c(){n=L("div"),r=L("button"),o=L("span"),s=L("i"),i=M(),l=P(d),c=P("\n            ("),a=P(t[0]),u=P(")"),q(s,"class","fa-solid fa-book-bookmark"),q(o,"id","btn-content"),q(r,"id","set-btn"),q(r,"class","button px-5 py-4 is-link js-modal-trigger svelte-hs48f9"),q(r,"data-target","selection-modal"),q(n,"class","set-container svelte-hs48f9")},m(e,t){E(e,n,t),x(n,r),x(r,o),x(o,s),x(o,i),x(o,l),x(o,c),x(o,a),x(o,u)},p(e,[t]){1&t&&T(a,e[0])},i:e,o:e,d(e){e&&R(n)}}}function it(e,t,n){let{selectionLength:r=0}=t,o=r;return e.$$set=e=>{"selectionLength"in e&&n(0,r=e.selectionLength)},e.$$.update=()=>{if(3&e.$$.dirty&&r!==o){const e=r>o;n(1,o=r);const t=document.getElementById("btn-content");t&&t.animate([{transform:e?"translateY(-7px)":"translateX(-5px)"},{transform:e?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[r,o]}class lt extends Ee{constructor(e){super(),Ie(this,e,it,st,i,{selectionLength:0})}}function ct(t){let n,r,s,i,l,c,a,u,d,f,g="en"===Oe?"Save selection":"Sauvegarder la sélection";return{c(){n=L("footer"),r=L("div"),s=L("button"),s.textContent=""+("en"===Oe?"Clear selection":"Vider la sélection"),i=M(),l=L("button"),c=L("i"),a=M(),u=P(g),q(s,"class","button is-link is-light"),q(c,"class","fa-solid fa-floppy-disk"),q(l,"class","button is-link"),q(r,"class","buttons"),q(n,"class","modal-card-foot is-center")},m(e,o){E(e,n,o),x(n,r),x(r,s),x(r,i),x(r,l),x(l,c),x(l,a),x(l,u),d||(f=[N(s,"click",t[1]),N(l,"click",t[2])],d=!0)},p:e,i:e,o:e,d(e){e&&R(n),d=!1,o(f)}}}function at(e,t,n){let{isRegion:r=!0}=t;return e.$$set=e=>{"isRegion"in e&&n(0,r=e.isRegion)},[r,()=>He.empty(r),()=>He.save()]}class ut extends Ee{constructor(e){super(),Ie(this,e,at,ct,i,{isRegion:0})}}function dt(t){let n,r,o,s,i,l,c,a,u,d,f,g,m,p,h;return{c(){n=L("button"),r=M(),o=L("div"),s=L("div"),i=M(),l=L("div"),c=L("div"),c.innerHTML='<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div> \n            <button class="delete media-left" aria-label="close"></button>',a=M(),u=L("section"),d=M(),f=L("footer"),g=L("div"),m=L("button"),m.textContent=""+("en"===Oe?"Cancel":"Annuler"),p=M(),h=L("button"),h.textContent="OK",q(n,"id","hidden-msg-btn"),q(n,"class","js-modal-trigger"),q(n,"data-target","msg-modal"),n.hidden=!0,q(s,"id","modal-bkg"),q(s,"class","modal-background"),q(c,"class","modal-card-head media mb-0"),q(u,"id","modal-body"),q(u,"class","modal-card-body"),q(m,"id","cancel-btn"),q(m,"class","button is-link is-light"),q(h,"id","ok-btn"),q(h,"class","button is-link"),q(g,"class","buttons"),q(f,"id","modal-footer"),q(f,"class","modal-card-foot is-center pt-3"),f.hidden=!0,q(l,"class","modal-content"),q(o,"id","msg-modal"),q(o,"class","modal fade"),q(o,"tabindex","-1"),q(o,"aria-labelledby","selection-modal-label"),q(o,"aria-hidden","true")},m(e,t){E(e,n,t),E(e,r,t),E(e,o,t),x(o,s),x(o,i),x(o,l),x(l,c),x(l,a),x(l,u),x(l,d),x(l,f),x(f,g),x(g,m),x(g,p),x(g,h)},p:e,i:e,o:e,d(e){e&&R(n),e&&R(r),e&&R(o)}}}class ft extends Ee{constructor(e){super(),Ie(this,e,null,dt,i,{})}}function gt(t){let n,r,o,s,i,l,c,a=_e.includes("regions"),u=a&&function(t){let n;return{c(){n=L("button"),n.textContent="en"===Oe?"Automatic region extraction":"Extraction automatique des régions",q(n,"class","button is-link is-inverted")},m(e,t){E(e,n,t)},p:e,d(e){e&&R(n)}}}();return{c(){n=L("div"),r=L("button"),r.textContent=""+("en"===Oe?"Manually annotate":"Annoter manuellement"),o=M(),s=L("button"),s.textContent=""+("en"===Oe?"Import regions file":"Importer un fichier de région"),i=M(),u&&u.c(),q(r,"class","button is-link"),q(s,"class","button is-link is-light"),q(n,"class","is-center buttons is-centered pt-5")},m(e,a){E(e,n,a),x(n,r),x(n,o),x(n,s),x(n,i),u&&u.m(n,null),l||(c=N(r,"click",t[0]),l=!0)},p(e,[t]){a&&u.p(e,t)},i:e,o:e,d(e){e&&R(n),u&&u.d(),l=!1,c()}}}function mt(e,t,n){const r=Q("witness");let{currentRegionId:o}=t,{baseUrl:s}=t;return e.$$set=e=>{"currentRegionId"in e&&n(1,o=e.currentRegionId),"baseUrl"in e&&n(2,s=e.baseUrl)},[async function(){const e=window.location.origin;let t=`${e}/witness/${r.id}/regions/add`;if(1===r.regions.length||o){const n=o||r.regions[0];t=`${e}/witness/${r.id}/regions/${n}/add`}const n=await Ae((()=>fetch(t,{method:"POST",headers:{"X-CSRFToken":Me}})));if(!n.ok)throw await ze(`Failed to create regions: '${n.statusText}'`,"Error"),new Error(`Failed to create regions: '${n.statusText}'`);let i;try{i=await n.json()}catch(e){throw await ze(`Failed to parse JSON response: '${e}'`,"Error"),new Error(`Failed to parse JSON response: '${e}'`)}console.log(i),i.hasOwnProperty("mirador_url")&&window.open(i.mirador_url),i.hasOwnProperty("regions_id")&&(window.location.href=`${s.split("regions/")[0]}regions/${i.regions_id}`)},o,s]}class pt extends Ee{constructor(e){super(),Ie(this,e,mt,gt,i,{currentRegionId:1,baseUrl:2})}}function ht(e,t,n){const r=e.slice();return r[4]=t[n],r}function $t(e){let t,n=e[2].regions,r=[];for(let t=0;t<n.length;t+=1)r[t]=bt(ht(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=_()},m(e,n){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,n);E(e,t,n)},p(e,o){if(5&o){let s;for(n=e[2].regions,s=0;s<n.length;s+=1){const i=ht(e,n,s);r[s]?r[s].p(i,o):(r[s]=bt(i),r[s].c(),r[s].m(t.parentNode,t))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(e){S(r,e),e&&R(t)}}}function wt(t){let n,r,o;return{c(){n=L("button"),n.textContent=""+("en"===Oe?"Delete regions record":"Supprimer l'intégralité des régions"),q(n,"class","tag is-danger")},m(e,s){E(e,n,s),r||(o=N(n,"click",t[3]),r=!0)},p:e,d(e){e&&R(n),r=!1,o()}}}function bt(e){let t,n,r,o,s=e[4]+"";return{c(){t=L("a"),n=P("Regions #"),r=P(s),q(t,"href",o=""+(e[0]+e[4])),q(t,"class","tag is-dark mr-3 is-rounded")},m(e,o){E(e,t,o),x(t,n),x(t,r)},p(e,n){1&n&&o!==(o=""+(e[0]+e[4]))&&q(t,"href",o)},d(e){e&&R(t)}}}function vt(t){let n;function r(e,t){return e[1]?wt:$t}let o=r(t),s=o(t);return{c(){n=L("div"),s.c(),q(n,"class","is-right")},m(e,t){E(e,n,t),s.m(n,null)},p(e,[t]){o===(o=r(e))&&s?s.p(e,t):(s.d(1),s=o(e),s&&(s.c(),s.m(n,null)))},i:e,o:e,d(e){e&&R(n),s.d()}}}function yt(e,t,n){const r=Q("witness");let{baseUrl:o=`${window.location.origin}${window.location.pathname}`}=t,{currentRegionId:s}=t;return e.$$set=e=>{"baseUrl"in e&&n(0,o=e.baseUrl),"currentRegionId"in e&&n(1,s=e.currentRegionId)},[o,s,r,async function(){if(!await ze("en"===Oe?"Are you sure you want to delete this record?":"Voulez-vous vraiment supprimer cet enregistrement?","en"===Oe?"Confirm deletion":"Confirmer la suppression",!0))return;if("number"!=typeof s)throw new Error("Invalid region ID");const e=`${window.location.origin}/regions/${s}/delete`;try{const t=await Ae((()=>fetch(e,{method:"DELETE",headers:{"X-CSRFToken":Me}})));if(204!==t.status)throw new Error(`Failed to delete regions: '${t.statusText}'`);window.location.href=`${o.split("regions/")[0]}regions/`}catch(e){console.error(e)}}]}class kt extends Ee{constructor(e){super(),Ie(this,e,yt,vt,i,{baseUrl:0,currentRegionId:1})}}function xt(e){let t;return{c(){t=O("path"),q(t,"d","M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"),q(t,"class","svelte-h0t5l9")},m(e,n){E(e,t,n)},d(e){e&&R(t)}}}function Ct(e){let t;return{c(){t=O("path"),q(t,"d","M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"),q(t,"class","svelte-h0t5l9")},m(e,n){E(e,t,n)},d(e){e&&R(t)}}}function It(t){let n,r="en"===Oe?"Edit":"Modifier";return{c(){n=P(r)},m(e,t){E(e,n,t)},p:e,d(e){e&&R(n)}}}function Et(t){let n,r="en"===Oe?"Validate":"Valider";return{c(){n=P(r)},m(e,t){E(e,n,t)},p:e,d(e){e&&R(n)}}}function Rt(e){let t;return{c(){t=O("path"),q(t,"d","m10.6 16.2l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21z"),q(t,"class","svelte-h0t5l9")},m(e,n){E(e,t,n)},d(e){e&&R(t)}}}function St(e){let t;return{c(){t=O("path"),q(t,"d","m10.6 16.2l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21zm0-2h14V5H5zM5 5v14z"),q(t,"class","svelte-h0t5l9")},m(e,n){E(e,t,n)},d(e){e&&R(t)}}}function Lt(t){let n,r,s,i,l,c,a,u,d,f,g,m,p,h,$,w,b="en"===Oe?"Reload":"Recharger",v="en"===Oe?"Go to editor":"Aller à l'éditeur",y="en"===Oe?"Delete selected regions":"Supprimer les régions sélectionnées";return{c(){n=L("button"),r=L("i"),s=M(),i=P(b),l=M(),c=L("a"),a=L("i"),u=M(),d=P(v),f=M(),g=L("button"),m=L("i"),p=M(),h=P(y),q(r,"class","fa-solid fa-rotate-right"),q(n,"class","tag is-link is-light is-rounded mr-3"),q(a,"class","fa-solid fa-edit"),q(c,"class","tag is-link is-rounded mr-3"),q(c,"href",Ve(t[5])),q(c,"target","_blank"),q(m,"class","fa-solid fa-trash"),q(g,"class","tag is-danger is-rounded")},m(e,o){E(e,n,o),x(n,r),x(n,s),x(n,i),E(e,l,o),E(e,c,o),x(c,a),x(c,u),x(c,d),E(e,f,o),E(e,g,o),x(g,m),x(g,p),x(g,h),$||(w=[N(n,"click",t[15]),N(g,"click",t[7])],$=!0)},p:e,d(e){e&&R(n),e&&R(l),e&&R(c),e&&R(f),e&&R(g),$=!1,o(w)}}}function Ot(t){let n,r,s,i,l,c,a,u,d,f,g,m,p,h,$,w,b,v,y,k,C,I="en"===Oe?"Download":"Télécharger";function S(e,t){return e[1]?Ct:xt}let _=S(t),j=_(t);function T(e,t){return e[1]?Et:It}let A=T(t),U=A(t);function V(e,t){return e[0]?St:Rt}let z=V(t),H=z(t),B=t[1]&&Lt(t);return{c(){n=L("div"),r=L("button"),s=O("svg"),j.c(),i=M(),U.c(),c=M(),a=L("button"),u=O("svg"),H.c(),d=M(),f=L("i"),g=M(),m=L("span"),m.textContent=""+("en"===Oe?"Select all":"Tout sélectionner"),p=M(),h=L("button"),$=L("i"),w=M(),b=P(I),v=M(),y=L("div"),B&&B.c(),q(s,"xmlns","http://www.w3.org/2000/svg"),q(s,"viewBox","0 0 384 512"),q(s,"class","pr-3 svelte-h0t5l9"),q(r,"class",l="button "+(t[1]?"is-success":"is-link")+" mr-3"),q(u,"xmlns","http://www.w3.org/2000/svg"),q(u,"viewBox","0 0 448 512"),q(u,"class","svelte-h0t5l9"),q(f,"class","fa-solid fa-square-check"),q(m,"id","all-selection"),q(a,"class","button is-link is-light mr-3"),q($,"class","fa-solid fa-download"),q(h,"class","button is-link is-light"),q(n,"class","is-left mb-3"),q(y,"class","edit-action is-left svelte-h0t5l9")},m(e,o){E(e,n,o),x(n,r),x(r,s),j.m(s,null),x(r,i),U.m(r,null),x(n,c),x(n,a),x(a,u),H.m(u,null),x(a,d),x(a,f),x(a,g),x(a,m),x(n,p),x(n,h),x(h,$),x(h,w),x(h,b),E(e,v,o),E(e,y,o),B&&B.m(y,null),k||(C=[N(r,"click",t[14]),N(a,"click",t[8]),N(h,"click",t[9])],k=!0)},p(e,[t]){_!==(_=S(e))&&(j.d(1),j=_(e),j&&(j.c(),j.m(s,null))),A===(A=T(e))&&U?U.p(e,t):(U.d(1),U=A(e),U&&(U.c(),U.m(r,null))),2&t&&l!==(l="button "+(e[1]?"is-success":"is-link")+" mr-3")&&q(r,"class",l),z!==(z=V(e))&&(H.d(1),H=z(e),H&&(H.c(),H.m(u,null))),e[1]?B?B.p(e,t):(B=Lt(e),B.c(),B.m(y,null)):B&&(B.d(1),B=null)},i:e,o:e,d(e){e&&R(n),j.d(),U.d(),H.d(),e&&R(v),e&&R(y),B&&B.d(),k=!1,o(C)}}}async function Pt(e){const t=SAS_APP_URL.replace("https","http"),n=`${SAS_APP_URL}/annotation/destroy?uri=${t}/annotation/${e}`,r=await fetch(n,{method:"DELETE"});if(204!==r.status)throw new Error(`Failed to delete ${n} due to ${r.status}: '${r.statusText}'`)}function Mt(e,t,n){let r,o,s,i,l,c,a;const{selected:u,nbSelected:f}=He;d(e,u,(e=>n(11,l=e))),d(e,f,(e=>n(13,a=e)));const{allRegions:g}=Be;d(e,g,(e=>n(12,c=e)));const m=Q("manifest"),p=Q("isValidated");function h(){n(1,o=!o)}return e.$$.update=()=>{8192&e.$$.dirty&&n(10,r=a(!0)),2048&e.$$.dirty&&(s=l(!0)),5120&e.$$.dirty&&n(0,i=r>=Object.keys(c).length)},n(1,o=!p),[i,o,u,f,g,m,h,async function(){if(await ze("en"===Oe?"Are you sure you want to delete regions?":"Voulez-vous vraiment supprimer les régions?","en"===Oe?"Confirm deletion":"Confirmer la suppression",!0))for(const e of Object.keys(s))try{if(!c.hasOwnProperty(e))continue;await Pt(e),Be.remove(e),He.remove(e,Ne)}catch(t){await ze(`Failed to delete region ${e}: ${t.message}`,"Error")}},function(){i?He.removeAll(Object.keys(c),Ne):He.addAll(Object.values(c))},async function(){const e=Object.values(l(!0)).map((e=>e.ref)),t=await Ae((()=>fetch(`${window.location.origin}/regions/export`,{method:"POST",headers:{"X-CSRFToken":Me},body:JSON.stringify({regionsRef:e})})));!function(e,t){const n=window.URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=`${t}`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(n),document.body.removeChild(r)}(await t.blob(),"regions.zip")},r,l,c,a,()=>h(),()=>location.reload()]}class _t extends Ee{constructor(e){super(),Ie(this,e,Mt,Ot,i,{})}}const Nt=function(){const e=`${window.location.origin}${window.location.pathname}`,t=Se(1),n=Se({}),r=Se(JSON.parse(localStorage.getItem("selectedRegions"))||{}),o=Se([]),s=Se([]),i=(async()=>{await fetch(`${e}compared-regions`).then((e=>e.json())).then((e=>(n.set(e),e))).catch((e=>console.error("Error:",e)));const t=await fetch(`${e}query-regions`).then((e=>e.json())).then((e=>0!==e.length&&e?(o.set(e),e):null)).catch((e=>console.error("Error:",e)));return a(l()),t})(),l=()=>{if("undefined"!=typeof window){const e=parseInt(new URLSearchParams(window.location.search).get("sp"));if(!isNaN(e))return t.set(e),e}return t.set(1),1},c=Le(t,(e=>(async()=>function(e){const t=50*(e-1),n=t+50,r=u(o).slice(t,n);return s.set(r),r}(e))()));function a(e){if(t.set(e),"undefined"!=typeof window){const t=new URL(window.location.href);t.searchParams.set("sp",e),window.history.pushState({},"",t)}}function d(e){localStorage.setItem("selectedRegions",JSON.stringify(e))}const f=Le(r,(e=>t=>e.hasOwnProperty(t)));return{currentPage:t,comparedRegions:n,qImgs:o,pageQImgs:s,selectedRegions:r,fetchSimilarity:i,setPageQImgs:c,getRegionsInfo:function(e){const t=u(n),r=Object.keys(t).filter((t=>t.startsWith(e)));return 1!==r.length?{title:"Error"}:t[r[0]]},handlePageUpdate:a,unselect:function(e){r.update((t=>{const n={...t};return delete n[e],d(n),n}))},select:function(e){r.update((t=>{const n={...t,[e.ref]:e};return d(n),n}))},isSelected:f}}();function jt(e){let t,n,r;const o=e[1].default,s=f(o,e,e[0],null);return{c(){t=L("table"),n=L("tbody"),s&&s.c(),q(t,"class","table is-fullwidth")},m(e,o){E(e,t,o),x(t,n),s&&s.m(n,null),r=!0},p(e,[t]){s&&s.p&&(!r||1&t)&&p(s,o,e,e[0],r?m(o,e[0],t,null):h(e[0]),null)},i(e){r||(ge(s,e),r=!0)},o(e){me(s,e),r=!1},d(e){e&&R(t),s&&s.d(e)}}}function qt(e,t,n){let{$$slots:r={},$$scope:o}=t;return e.$$set=e=>{"$$scope"in e&&n(0,o=e.$$scope)},[o,r]}class Tt extends Ee{constructor(e){super(),Ie(this,e,qt,jt,i,{})}}function At(e){let t,n,r,o,s,i,l=e[1]-1>1&&Ut(e);return{c(){t=L("li"),n=L("a"),n.textContent="1",r=M(),l&&l.c(),o=_(),q(n,"class","pagination-link"),q(n,"href",null)},m(c,a){E(c,t,a),x(t,n),E(c,r,a),l&&l.m(c,a),E(c,o,a),s||(i=N(n,"click",j(e[6])),s=!0)},p(e,t){e[1]-1>1?l?l.p(e,t):(l=Ut(e),l.c(),l.m(o.parentNode,o)):l&&(l.d(1),l=null)},d(e){e&&R(t),e&&R(r),l&&l.d(e),e&&R(o),s=!1,i()}}}function Ut(e){let t,n,r,o,s,i,l=e[1]-1+"",c=e[1]-1>2&&Vt();return{c(){c&&c.c(),t=M(),n=L("li"),r=L("a"),o=P(l),q(r,"class","pagination-link"),q(r,"href",null)},m(l,a){c&&c.m(l,a),E(l,t,a),E(l,n,a),x(n,r),x(r,o),s||(i=N(r,"click",j(e[7])),s=!0)},p(e,n){e[1]-1>2?c||(c=Vt(),c.c(),c.m(t.parentNode,t)):c&&(c.d(1),c=null),2&n&&l!==(l=e[1]-1+"")&&T(o,l)},d(e){c&&c.d(e),e&&R(t),e&&R(n),s=!1,i()}}}function Vt(e){let t;return{c(){t=L("li"),t.innerHTML='<span class="pagination-ellipsis">…</span>'},m(e,n){E(e,t,n)},d(e){e&&R(t)}}}function zt(e){let t,n,r,o,s,i=e[1]+1<e[3]&&Ht(e);return{c(){i&&i.c(),t=M(),n=L("li"),r=L("a"),r.textContent=`${e[3]}`,q(r,"class","pagination-link"),q(r,"href",null)},m(l,c){i&&i.m(l,c),E(l,t,c),E(l,n,c),x(n,r),o||(s=N(r,"click",j(e[10])),o=!0)},p(e,n){e[1]+1<e[3]?i?i.p(e,n):(i=Ht(e),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},d(e){i&&i.d(e),e&&R(t),e&&R(n),o=!1,s()}}}function Ht(e){let t,n,r,o,s,i,l,c=e[1]+1+"",a=e[1]+2<e[3]&&Bt();return{c(){t=L("li"),n=L("a"),r=P(c),o=M(),a&&a.c(),s=_(),q(n,"class","pagination-link"),q(n,"href",null)},m(c,u){E(c,t,u),x(t,n),x(n,r),E(c,o,u),a&&a.m(c,u),E(c,s,u),i||(l=N(n,"click",j(e[9])),i=!0)},p(e,t){2&t&&c!==(c=e[1]+1+"")&&T(r,c),e[1]+2<e[3]?a||(a=Bt(),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},d(e){e&&R(t),e&&R(o),a&&a.d(e),e&&R(s),i=!1,l()}}}function Bt(e){let t;return{c(){t=L("li"),t.innerHTML='<span class="pagination-ellipsis">…</span>'},m(e,n){E(e,t,n)},d(e){e&&R(t)}}}function Dt(t){let n,r=t[3]>1&&function(e){let t,n,r,o,s,i,l,c,a,u=e[1]>1&&At(e),d=e[1]<e[3]&&zt(e);return{c(){t=L("nav"),n=L("ul"),u&&u.c(),r=M(),o=L("li"),s=L("a"),i=P(e[1]),l=M(),d&&d.c(),q(s,"class","pagination-link is-current"),q(s,"href",null),q(n,"class","pagination-list"),q(t,"class","pagination is-centered"),q(t,"aria-label","pagination")},m(f,g){E(f,t,g),x(t,n),u&&u.m(n,null),x(n,r),x(n,o),x(o,s),x(s,i),x(n,l),d&&d.m(n,null),c||(a=N(s,"click",j(e[8])),c=!0)},p(e,t){e[1]>1?u?u.p(e,t):(u=At(e),u.c(),u.m(n,r)):u&&(u.d(1),u=null),2&t&&T(i,e[1]),e[1]<e[3]?d?d.p(e,t):(d=zt(e),d.c(),d.m(n,null)):d&&(d.d(1),d=null)},d(e){e&&R(t),u&&u.d(),d&&d.d(),c=!1,a()}}}(t);return{c(){r&&r.c(),n=_()},m(e,t){r&&r.m(e,t),E(e,n,t)},p(e,[t]){e[3]>1&&r.p(e,t)},i:e,o:e,d(e){r&&r.d(e),e&&R(n)}}}function Ft(e,t,n){let r,{store:o}=t;const{currentPage:s}=o;d(e,s,(e=>n(1,r=e)));let{nbOfItems:i}=t,{pageLength:l=50}=t;const c=Math.ceil(i/l);return e.$$set=e=>{"store"in e&&n(0,o=e.store),"nbOfItems"in e&&n(4,i=e.nbOfItems),"pageLength"in e&&n(5,l=e.pageLength)},[o,r,s,c,i,l,()=>o.handlePageUpdate(1),()=>o.handlePageUpdate(r-1),()=>o.handlePageUpdate(r),()=>o.handlePageUpdate(r+1),()=>o.handlePageUpdate(c)]}class Zt extends Ee{constructor(e){super(),Ie(this,e,Ft,Dt,i,{store:0,nbOfItems:4,pageLength:5})}}function Jt(e){let t,n,r,o,s,i,l,a,u,d,g,$,w,b,v,y=parseInt(e[1])+"";const k=e[4].default,C=f(k,e,e[3],null);return{c(){t=L("tr"),n=L("th"),r=L("div"),o=L("img"),i=M(),l=L("a"),a=L("i"),u=P("\n                Page "),d=P(y),g=M(),$=L("td"),w=L("div"),b=L("div"),C&&C.c(),c(o.src,s=Ue(e[0],"full","250,"))||q(o,"src",s),q(o,"alt","Query region"),q(o,"class","mb-3 card"),q(a,"class","fa-solid fa-pen-to-square"),q(l,"class","tag px-2 py-1 is-rounded is-hoverable"),q(l,"href",Ve(e[2],parseInt(e[1]))),q(l,"target","_blank"),q(r,"class","content-wrapper py-5"),q(n,"class","is-3 center-flex is-narrow"),A(n,"width","260px"),q(b,"class","grid is-gap-2"),q(w,"class","fixed-grid has-5-cols"),q($,"class","p-5 is-fullwidth")},m(e,s){E(e,t,s),x(t,n),x(n,r),x(r,o),x(r,i),x(r,l),x(l,a),x(l,u),x(l,d),x(t,g),x(t,$),x($,w),x(w,b),C&&C.m(b,null),v=!0},p(e,[t]){(!v||1&t&&!c(o.src,s=Ue(e[0],"full","250,")))&&q(o,"src",s),C&&C.p&&(!v||8&t)&&p(C,k,e,e[3],v?m(k,e[3],t,null):h(e[3]),null)},i(e){v||(ge(C,e),v=!0)},o(e){me(C,e),v=!1},d(e){e&&R(t),C&&C.d(e)}}}function Xt(e,t,n){let{$$slots:r={},$$scope:o}=t,{qImg:s}=t;const[i,l,c,a]=s.split(".")[0].split("_"),u=Q("manifest");return e.$$set=e=>{"qImg"in e&&n(0,s=e.qImg),"$$scope"in e&&n(3,o=e.$$scope)},[s,c,u,o,r]}class Qt extends Ee{constructor(e){super(),Ie(this,e,Xt,Jt,i,{qImg:0})}}const Gt='<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 54 54.5">\n                <rect x="30" y="30.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n                <rect x="21" y="21" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n                <rect x="30" y="30.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>\n            </svg>',Kt='<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 55 55.5">\n                <rect x="32" y="32.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" pointer-events="all"/>\n                <rect x="21" y="20.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" pointer-events="all"/>\n                <path d="M 32 41.43 L 41 32.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 32 50 L 50 32.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 60 76 L 77 58" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 68.3 76.29 L 77 67" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 32 59 L 59 32" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 32 68 L 68 32" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 33 76 L 77 32" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 51 76 L 77 49" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 41 77 L 77 41" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n            </svg>',Wt='<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 56 56.5">\n                <rect x="34" y="34.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>\n                <rect x="21" y="20.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n            </svg>',Yt='<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 49.5 49.5">\n                <rect x="21" y="20.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n                <path d="M 22.67 74.55 L 75 22" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 74.37 74.05 L 22.72 22.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n            </svg>',en='<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 49.5 49.5">\n                <rect x="21" y="20.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n                <path d="M 28.69 75.28 C 29.25 64.15 38.08 55.28 48.86 55.28 C 52.5 55.28 56.07 56.3 59.18 58.25 C 64.96 61.85 68.66 68.3 69.02 75.28 Z M 37.85 41.48 C 37.85 35.37 42.79 30.39 48.86 30.39 C 54.92 30.39 59.86 35.37 59.86 41.48 C 59.86 47.59 54.92 52.56 48.86 52.56 C 42.79 52.56 37.85 47.59 37.85 41.48 Z M 60.37 56.34 C 58.43 55.13 56.32 54.25 54.13 53.7 C 58.82 51.64 62.1 46.94 62.1 41.48 C 62.1 34.13 56.16 28.15 48.86 28.15 C 41.55 28.15 35.61 34.13 35.61 41.48 C 35.61 46.95 38.9 51.66 43.6 53.71 C 33.76 56.18 26.41 65.4 26.41 76.4 C 26.41 77.02 26.92 77.52 27.54 77.52 L 70.17 77.52 C 70.79 77.52 71.3 77.02 71.3 76.4 C 71.3 68.23 67.11 60.54 60.37 56.34 Z" fill="currentColor" stroke="none"/>\n            </svg>',tn="en"===Oe?"Overall visual match":"Correspondance visuelle globale",nn="en"===Oe?"Visual match on part of the image":"Correspondance visuelle sur une partie de l'image",rn="en"===Oe?"Semantic and non visual match":"Correspondance sémantique et non visuelle",on="en"===Oe?"None of the above":"Aucune de ces catégories",sn="en"===Oe?"User specific category":"Correspondance spécifique à l'utilisateur",ln="en"===Oe?"Show 'no match' regions":"Afficher les régions sans correspondance",cn="en"===Oe?"Hide 'no match' regions":"Cacher les régions sans correspondance";function an(t){let n,r="en"===Oe?"Manual similarity":"Correspondance manuelle";return{c(){n=P(r)},m(e,t){E(e,n,t)},p:e,d(e){e&&R(n)}}}function un(e){let t,n;return{c(){t=P("Score: "),n=P(e[0])},m(e,r){E(e,t,r),E(e,n,r)},p(e,t){1&t&&T(n,e[0])},d(e){e&&R(t),e&&R(n)}}}function dn(e){let t,n,r,s,i,l,a,u,d,f,g,m,p,h,$,w,b,v,y,k,C,I,S,O,_,j,T,A,V,z,H,B=Nt.getRegionsInfo(`${e[3]}_${e[4]}`).title+"",D=parseInt(e[5])+"";function F(e,t){return e[0]?un:an}let Z=F(e),J=Z(e);return{c(){t=L("div"),n=L("figure"),r=L("img"),i=M(),l=L("div"),a=L("span"),u=P(B),d=M(),f=L("br"),g=P("\n                Page "),m=P(D),p=M(),h=L("br"),$=M(),w=L("b"),J.c(),b=M(),v=L("div"),y=L("span"),k=M(),C=L("span"),I=M(),S=L("span"),O=M(),_=L("span"),j=M(),T=L("span"),c(r.src,s=Ue(e[7],e[6],",256"))||q(r,"src",s),q(r,"alt","Similar region"),q(r,"class","svelte-xyy17k"),q(a,"class","overlay-desc"),q(l,"class","overlay is-center svelte-xyy17k"),q(n,"class","image region-image card svelte-xyy17k"),q(n,"tabindex","-1"),q(y,"class","tag is-hoverable pl-5 pr-4 py-4"),q(y,"title","en"===Oe?"Exact match":"Correspondance exacte"),U(y,"is-link",1===e[2]),q(C,"class","tag is-hoverable p-4"),q(C,"title","en"===Oe?"Partial match":"Correspondance partielle"),U(C,"is-link",2===e[2]),q(S,"class","tag is-hoverable p-4"),q(S,"title","en"===Oe?"Semantic match":"Correspondance sémantique"),U(S,"is-link",3===e[2]),q(_,"class","tag is-hoverable p-4"),q(_,"title","en"===Oe?"No match":"Aucune correspondance"),U(_,"is-link",4===e[2]),q(T,"class","tag is-hoverable pl-4 pr-5 py-4"),q(T,"title","en"===Oe?"User match":"Correspondance utilisateur"),U(T,"is-link",e[1]),q(v,"class","tags has-addons is-dark is-center"),q(t,"class","region is-center svelte-xyy17k")},m(o,s){E(o,t,s),x(t,n),x(n,r),x(n,i),x(n,l),x(l,a),x(a,u),x(a,d),x(a,f),x(a,g),x(a,m),x(a,p),x(a,h),x(a,$),x(a,w),J.m(w,null),x(t,b),x(t,v),x(v,y),y.innerHTML=Gt,x(v,k),x(v,C),C.innerHTML=Kt,x(v,I),x(v,S),S.innerHTML=Wt,x(v,O),x(v,_),_.innerHTML=Yt,x(v,j),x(v,T),T.innerHTML=en,V=!0,z||(H=[N(y,"click",e[13]),N(y,"keyup",null),N(C,"click",e[14]),N(C,"keyup",null),N(S,"click",e[15]),N(S,"keyup",null),N(_,"click",e[16]),N(_,"keyup",null),N(T,"click",e[17]),N(T,"keyup",null)],z=!0)},p(e,[t]){Z===(Z=F(e))&&J?J.p(e,t):(J.d(1),J=Z(e),J&&(J.c(),J.m(w,null))),(!V||4&t)&&U(y,"is-link",1===e[2]),(!V||4&t)&&U(C,"is-link",2===e[2]),(!V||4&t)&&U(S,"is-link",3===e[2]),(!V||4&t)&&U(_,"is-link",4===e[2]),(!V||2&t)&&U(T,"is-link",e[1])},i(e){V||(ne((()=>{V&&(A||(A=he(t,Fe,{duration:500},!0)),A.run(1))})),V=!0)},o(e){A||(A=he(t,Fe,{duration:500},!1)),A.run(0),V=!1},d(e){e&&R(t),J.d(),e&&A&&A.end(),z=!1,o(H)}}}function fn(e,t,n){let r,o;const s=window.location.origin;let{qImg:i}=t,{sImg:l}=t,{score:c=0}=t,{category:a=null}=t,{users:u=[]}=t;const[d,f,g,m]=l.split(".")[0].split("_"),p=`${d}_${f}_${g}`;function h(e){5===e?n(1,o=!o):n(2,r=r===e?null:e)}async function $(e){h(e);try{(await fetch(`${s}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Me},body:JSON.stringify({img_1:i,img_2:l,category:r,user_selected:o})})).ok||(console.error("Error: Network response was not ok"),h(e))}catch(t){console.error("Error:",t),h(e)}}return e.$$set=e=>{"qImg"in e&&n(9,i=e.qImg),"sImg"in e&&n(10,l=e.sImg),"score"in e&&n(0,c=e.score),"category"in e&&n(11,a=e.category),"users"in e&&n(12,u=e.users)},e.$$.update=()=>{2048&e.$$.dirty&&n(2,r=a),4096&e.$$.dirty&&n(1,o=u.includes(Number(Pe))||!1)},[c,o,r,d,f,g,m,p,$,i,l,a,u,()=>$(1),()=>$(2),()=>$(3),()=>$(4),()=>$(5)]}class gn extends Ee{constructor(e){super(),Ie(this,e,fn,dn,i,{qImg:9,sImg:10,score:0,category:11,users:12})}}function mn(e,t,n){const r=e.slice();return r[7]=t[n][0],r[8]=t[n][1],r[9]=t[n][2],r[10]=t[n][3],r[11]=t[n][4],r[12]=t[n][5],r[13]=t[n][6],r[14]=t[n][7],r}function pn(t){let n,r,o="en"===Oe?`Error when retrieving similar regions: ${t[17]}`:`Erreur de recupération des régions similaires: ${t[17]}`;return{c(){n=L("div"),r=P(o),q(n,"class","faded is-center")},m(e,t){E(e,n,t),x(n,r)},p(e,t){2&t&&o!==(o="en"===Oe?`Error when retrieving similar regions: ${e[17]}`:`Erreur de recupération des régions similaires: ${e[17]}`)&&T(r,o)},i:e,o:e,d(e){e&&R(n)}}}function hn(e){let t,n,r=e[6],o=[];for(let t=0;t<r.length;t+=1)o[t]=$n(mn(e,r,t));const s=e=>me(o[e],1,1,(()=>{o[e]=null}));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=_()},m(e,r){for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,r);E(e,t,r),n=!0},p(e,n){if(3&n){let i;for(r=e[6],i=0;i<r.length;i+=1){const s=mn(e,r,i);o[i]?(o[i].p(s,n),ge(o[i],1)):(o[i]=$n(s),o[i].c(),ge(o[i],1),o[i].m(t.parentNode,t))}for(de(),i=r.length;i<o.length;i+=1)s(i);fe()}},i(e){if(!n){for(let e=0;e<r.length;e+=1)ge(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)me(o[e]);n=!1},d(e){S(o,e),e&&R(t)}}}function $n(e){let t,n;return t=new gn({props:{qImg:e[0],sImg:e[9],score:e[7],qRegions:e[10],sRegions:e[11],category:e[12],users:e[13],isManual:e[14]}}),{c(){ye(t.$$.fragment)},m(e,r){ke(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.qImg=e[0]),2&n&&(r.sImg=e[9]),2&n&&(r.score=e[7]),2&n&&(r.qRegions=e[10]),2&n&&(r.sRegions=e[11]),2&n&&(r.category=e[12]),2&n&&(r.users=e[13]),2&n&&(r.isManual=e[14]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function wn(t){let n;return{c(){n=L("div"),n.textContent=""+("en"===Oe?"Retrieving similar regions...":"Récupération des régions similaires..."),q(n,"class","faded is-center")},m(e,t){E(e,n,t)},p:e,i:e,o:e,d(e){e&&R(n)}}}function bn(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:wn,then:hn,catch:pn,value:6,error:17,blocks:[,,,]};return $e(n=e[1],o),{c(){t=_(),o.block.c()},m(e,n){E(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,[r]){e=t,o.ctx=e,2&r&&n!==(n=e[1])&&$e(n,o)||we(o,e,r)},i(e){r||(ge(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1){me(o.blocks[e])}r=!1},d(e){e&&R(t),o.block.d(e),o.token=null,o=null}}}function vn(e,t,n){let r,o;const{selectedRegions:s}=Nt;d(e,s,(e=>n(3,o=e)));let{qImg:i}=t;const l=`${window.location.origin}${window.location.pathname}`;return e.$$set=e=>{"qImg"in e&&n(0,i=e.qImg)},e.$$.update=()=>{9&e.$$.dirty&&n(1,r=async function(e,t){const n=await fetch(`${l}similar-regions`,{method:"POST",body:JSON.stringify({regionsIds:Object.values(t).map((e=>e.id)),qImg:e,topk:10,excludedCategories:[]}),headers:{"Content-Type":"application/json","X-CSRFToken":Me}});return await n.json()}(i,o))},[i,r,s,o]}class yn extends Ee{constructor(e){super(),Ie(this,e,vn,bn,i,{qImg:0})}}function kn(e,t,n){const r=e.slice();return r[7]=t[n],r}function xn(t){let n,r,o,s=t[10]+"";return{c(){n=L("tr"),r=P("Error when retrieving similar regions: "),o=P(s)},m(e,t){E(e,n,t),x(n,r),x(n,o)},p(e,t){2&t&&s!==(s=e[10]+"")&&T(o,s)},i:e,o:e,d(e){e&&R(n)}}}function Cn(e){let t,n,r=[],o=new Map,s=e[2];const i=e=>e[7].id;for(let t=0;t<s.length;t+=1){let n=kn(e,s,t),l=i(n);o.set(l,r[t]=Rn(l,n))}let l=null;return s.length||(l=In()),{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=_(),l&&l.c()},m(e,o){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,o);E(e,t,o),l&&l.m(e,o),n=!0},p(e,n){4&n&&(s=e[2],de(),r=ve(r,n,i,1,e,s,o,t.parentNode,be,Rn,t,kn),fe(),!s.length&&l?l.p(e,n):s.length?l&&(l.d(1),l=null):(l=In(),l.c(),l.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<s.length;e+=1)ge(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)me(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&R(t),l&&l.d(e)}}}function In(t){let n,r;return{c(){n=L("tr"),n.textContent=""+("en"===Oe?"No similarity":"Pas de similarités"),r=M(),q(n,"class","faded is-center")},m(e,t){E(e,n,t),E(e,r,t)},p:e,d(e){e&&R(n),e&&R(r)}}}function En(e){let t,n,r;return t=new yn({props:{qImg:e[7]}}),{c(){ye(t.$$.fragment),n=M()},m(e,o){ke(t,e,o),E(e,n,o),r=!0},p(e,n){const r={};4&n&&(r.qImg=e[7]),t.$set(r)},i(e){r||(ge(t.$$.fragment,e),r=!0)},o(e){me(t.$$.fragment,e),r=!1},d(e){xe(t,e),e&&R(n)}}}function Rn(e,t){let n,r,o;return r=new Qt({props:{qImg:t[7],$$slots:{default:[En]},$$scope:{ctx:t}}}),{key:e,first:null,c(){n=_(),ye(r.$$.fragment),this.first=n},m(e,t){E(e,n,t),ke(r,e,t),o=!0},p(e,n){t=e;const o={};4&n&&(o.qImg=t[7]),2052&n&&(o.$$scope={dirty:n,ctx:t}),r.$set(o)},i(e){o||(ge(r.$$.fragment,e),o=!0)},o(e){me(r.$$.fragment,e),o=!1},d(e){e&&R(n),xe(r,e)}}}function Sn(t){let n;return{c(){n=L("tr"),n.textContent=""+("en"===Oe?"Retrieving similarity page...":"Récupération la page de similarité..."),q(n,"class","faded is-center")},m(e,t){E(e,n,t)},p:e,i:e,o:e,d(e){e&&R(n)}}}function Ln(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:Sn,then:Cn,catch:xn,value:6,error:10,blocks:[,,,]};return $e(n=e[1],o),{c(){t=_(),o.block.c()},m(e,n){E(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,r){e=t,o.ctx=e,2&r&&n!==(n=e[1])&&$e(n,o)||we(o,e,r)},i(e){r||(ge(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1){me(o.blocks[e])}r=!1},d(e){e&&R(t),o.block.d(e),o.token=null,o=null}}}function On(e){let t,n,r,o,s,i;return t=new Zt({props:{store:Nt,nbOfItems:e[0].length}}),r=new Tt({props:{$$slots:{default:[Ln]},$$scope:{ctx:e}}}),s=new Zt({props:{store:Nt,nbOfItems:e[0].length}}),{c(){ye(t.$$.fragment),n=M(),ye(r.$$.fragment),o=M(),ye(s.$$.fragment)},m(e,l){ke(t,e,l),E(e,n,l),ke(r,e,l),E(e,o,l),ke(s,e,l),i=!0},p(e,[n]){const o={};1&n&&(o.nbOfItems=e[0].length),t.$set(o);const i={};2054&n&&(i.$$scope={dirty:n,ctx:e}),r.$set(i);const l={};1&n&&(l.nbOfItems=e[0].length),s.$set(l)},i(e){i||(ge(t.$$.fragment,e),ge(r.$$.fragment,e),ge(s.$$.fragment,e),i=!0)},o(e){me(t.$$.fragment,e),me(r.$$.fragment,e),me(s.$$.fragment,e),i=!1},d(e){xe(t,e),e&&R(n),xe(r,e),e&&R(o),xe(s,e)}}}function Pn(e,t,n){let r,o,s;const{qImgs:i,pageQImgs:l,setPageQImgs:c}=Nt;return d(e,i,(e=>n(0,r=e))),d(e,l,(e=>n(2,s=e))),d(e,c,(e=>n(1,o=e))),[r,o,s,i,l,c]}class Mn extends Ee{constructor(e){super(),Ie(this,e,Pn,On,i,{})}}function _n(e,t,n){const r=e.slice();return r[8]=t[n][0],r[9]=t[n][1],r}function Nn(e){let t;return{c(){t=L("span"),t.textContent="current",q(t,"class","tag is-dark svelte-503e8j")},m(e,n){E(e,t,n)},d(e){e&&R(t)}}}function jn(e){let t,n,r,s,i,l,c,a,u=e[5](e[8]),d=e[9].title+"",f=u&&Nn();function g(){return e[6](e[9])}return{c(){t=L("div"),f&&f.c(),n=M(),r=L("span"),s=P(d),l=M(),q(r,"class",i="tag is-small "+(e[0](e[8])?"is-link":"is-contrasted")+" svelte-503e8j"),q(t,"class","tags has-addons mb-0 is-hoverable")},m(e,o){E(e,t,o),f&&f.m(t,null),x(t,n),x(t,r),x(r,s),x(t,l),c||(a=[N(t,"click",g),N(t,"keyup",null)],c=!0)},p(o,l){e=o,2&l&&(u=e[5](e[8])),u?f||(f=Nn(),f.c(),f.m(t,n)):f&&(f.d(1),f=null),2&l&&d!==(d=e[9].title+"")&&T(s,d),3&l&&i!==(i="tag is-small "+(e[0](e[8])?"is-link":"is-contrasted")+" svelte-503e8j")&&q(r,"class",i)},d(e){e&&R(t),f&&f.d(),c=!1,o(a)}}}function qn(t){let n,r=Object.entries(t[1]),o=[];for(let e=0;e<r.length;e+=1)o[e]=jn(_n(t,r,e));return{c(){n=L("div");for(let e=0;e<o.length;e+=1)o[e].c();q(n,"class","field is-grouped is-grouped-multiline")},m(e,t){E(e,n,t);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(n,null)},p(e,[t]){if(51&t){let s;for(r=Object.entries(e[1]),s=0;s<r.length;s+=1){const i=_n(e,r,s);o[s]?o[s].p(i,t):(o[s]=jn(i),o[s].c(),o[s].m(n,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=r.length}},i:e,o:e,d(e){e&&R(n),S(o,e)}}}function Tn(e,t,n){let r,o;const{comparedRegions:s,isSelected:i}=Nt;d(e,s,(e=>n(1,o=e))),d(e,i,(e=>n(0,r=e)));const l=Q("imgPrefix");function c(e){r(e.ref)?Nt.unselect(e.ref):Nt.select(e)}return[r,o,s,i,c,function(e){return e.startsWith(l)},e=>c(e)]}class An extends Ee{constructor(e){super(),Ie(this,e,Tn,qn,i,{})}}function Un(e,t,n){const r=e.slice();return r[6]=t[n],r}function Vn(e){let t,n,r,o,s,i=e[6].title+"";return{c(){t=L("div"),n=L("span"),r=P(i),q(n,"class","label svelte-1y98sha"),q(t,"class","label-container px-2 py-1 svelte-1y98sha")},m(e,o){E(e,t,o),x(t,n),x(n,r),s=!0},p(e,t){(!s||2&t)&&i!==(i=e[6].title+"")&&T(r,i)},i(e){s||(ne((()=>{s&&(o||(o=he(t,Ze,{x:40,duration:300},!0)),o.run(1))})),s=!0)},o(e){o||(o=he(t,Ze,{x:40,duration:300},!1)),o.run(0),s=!1},d(e){e&&R(t),e&&o&&o.end()}}}function zn(e){let t,n,r,i,l,c,a,u=e[6].svg+"",d=e[0]===e[6].id&&Vn(e);function f(){return e[4](e[6])}return{c(){t=L("div"),n=L("span"),r=M(),d&&d.c(),i=M(),q(n,"class","tool-icon is-hoverable p-1 svelte-1y98sha"),q(t,"class","toolbar-item svelte-1y98sha"),A(t,"cursor",6===e[0]?"pointer":"help")},m(o,g){E(o,t,g),x(t,n),n.innerHTML=u,x(t,r),d&&d.m(t,null),x(t,i),l=!0,c||(a=[N(t,"mouseenter",f),N(t,"mouseleave",e[5]),N(t,"click",(function(){s(6===e[6].id?e[2]():null)&&(6===e[6].id?e[2]():null).apply(this,arguments)})),N(t,"keyup",null)],c=!0)},p(r,o){e=r,(!l||2&o)&&u!==(u=e[6].svg+"")&&(n.innerHTML=u),e[0]===e[6].id?d?(d.p(e,o),3&o&&ge(d,1)):(d=Vn(e),d.c(),ge(d,1),d.m(t,i)):d&&(de(),me(d,1,1,(()=>{d=null})),fe()),(!l||1&o)&&A(t,"cursor",6===e[0]?"pointer":"help")},i(e){l||(ge(d),l=!0)},o(e){me(d),l=!1},d(e){e&&R(t),d&&d.d(),c=!1,o(a)}}}function Hn(e){let t,n,r,o=e[1],s=[];for(let t=0;t<o.length;t+=1)s[t]=zn(Un(e,o,t));const i=e=>me(s[e],1,1,(()=>{s[e]=null}));return{c(){t=L("div");for(let e=0;e<s.length;e+=1)s[e].c();q(t,"class","toolbar is-contrasted pb-3 pl-3 pr-4 svelte-1y98sha")},m(e,n){E(e,t,n);for(let e=0;e<s.length;e+=1)s[e]&&s[e].m(t,null);r=!0},p(e,[n]){if(7&n){let r;for(o=e[1],r=0;r<o.length;r+=1){const i=Un(e,o,r);s[r]?(s[r].p(i,n),ge(s[r],1)):(s[r]=zn(i),s[r].c(),ge(s[r],1),s[r].m(t,null))}for(de(),r=o.length;r<s.length;r+=1)i(r);fe()}},i(e){if(!r){for(let e=0;e<o.length;e+=1)ge(s[e]);ne((()=>{r&&(n||(n=he(t,Fe,{duration:500},!0)),n.run(1))})),r=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)me(s[e]);n||(n=he(t,Fe,{duration:500},!1)),n.run(0),r=!1},d(e){e&&R(t),S(s,e),e&&n&&n.end()}}}function Bn(e,t,n){let r,o,s=null;return e.$$.update=()=>{8&e.$$.dirty&&n(1,o=[{id:1,title:tn,svg:Gt},{id:2,title:nn,svg:Kt},{id:3,title:rn,svg:Wt},{id:4,title:on,svg:Yt},{id:5,title:sn,svg:en},{id:6,title:r?cn:ln,svg:r?'<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 48 48">\n                <path d="M 74.03 46.4 C 68.2 37.48 58.41 32.15 47.86 32.15 C 37.3 32.15 27.51 37.48 21.68 46.4 L 21.38 46.86 L 21.68 47.32 C 27.51 56.24 37.3 61.57 47.86 61.57 C 58.41 61.57 68.2 56.24 74.03 47.31 L 74.33 46.86 L 74.03 46.4 Z M 24.57 46.86 C 28.87 40.84 35.18 36.8 42.25 35.37 C 41.07 35.98 39.97 36.77 39.01 37.74 C 36.61 40.17 35.28 43.4 35.28 46.82 C 35.28 50.26 36.61 53.49 39.01 55.91 C 40.04 56.94 41.2 57.76 42.46 58.38 C 35.3 57 28.92 52.93 24.57 46.86 Z M 47.99 54.79 C 43.66 54.79 40.13 51.23 40.13 46.85 C 40.13 44.74 40.95 42.75 42.43 41.25 C 43.91 39.75 45.89 38.92 47.99 38.92 C 50.09 38.92 52.06 39.75 53.55 41.25 C 55.03 42.75 55.85 44.74 55.85 46.85 C 55.85 48.97 55.03 50.97 53.55 52.47 C 52.06 53.96 50.08 54.79 47.99 54.79 Z M 53.76 58.29 C 54.95 57.68 56.04 56.89 57.01 55.92 C 59.41 53.49 60.73 50.26 60.73 46.83 C 60.73 41.9 57.97 37.62 53.93 35.47 C 60.81 36.96 66.93 40.98 71.13 46.86 C 66.9 52.79 60.71 56.82 53.76 58.29 Z" fill="currentColor" stroke="none"/>\n                <path d="M 45.26 47.3 C 46.69 47.3 47.86 46.13 47.86 44.68 C 47.86 43.23 46.69 42.05 45.26 42.05 C 43.83 42.05 42.67 43.23 42.67 44.68 C 42.67 46.13 43.83 47.3 45.26 47.3" fill="currentColor" stroke="none"/>\n                <ellipse cx="47.86" cy="46.86" rx="11.27" ry="11.27" fill="currentColor" stroke="none"/>\n                <path d="M 22.86 71.86 L 72.86 21.86" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 39 56 L 57 38" fill="none" stroke="#ffffff" stroke-width="3" stroke-miterlimit="10"/>\n            </svg>':'<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 48 48">\n                <path d="M 74.03 46.4 C 68.2 37.48 58.41 32.15 47.86 32.15 C 37.3 32.15 27.51 37.48 21.68 46.4 L 21.38 46.86 L 21.68 47.32 C 27.51 56.24 37.3 61.57 47.86 61.57 C 58.41 61.57 68.2 56.24 74.03 47.31 L 74.33 46.86 L 74.03 46.4 Z M 24.57 46.86 C 28.87 40.84 35.18 36.8 42.25 35.37 C 41.07 35.98 39.97 36.77 39.01 37.74 C 36.61 40.17 35.28 43.4 35.28 46.82 C 35.28 50.26 36.61 53.49 39.01 55.91 C 40.04 56.94 41.2 57.76 42.46 58.38 C 35.3 57 28.92 52.93 24.57 46.86 Z M 47.99 54.79 C 43.66 54.79 40.13 51.23 40.13 46.85 C 40.13 44.74 40.95 42.75 42.43 41.25 C 43.91 39.75 45.89 38.92 47.99 38.92 C 50.09 38.92 52.06 39.75 53.55 41.25 C 55.03 42.75 55.85 44.74 55.85 46.85 C 55.85 48.97 55.03 50.97 53.55 52.47 C 52.06 53.96 50.08 54.79 47.99 54.79 Z M 53.76 58.29 C 54.95 57.68 56.04 56.89 57.01 55.92 C 59.41 53.49 60.73 50.26 60.73 46.83 C 60.73 41.9 57.97 37.62 53.93 35.47 C 60.81 36.96 66.93 40.98 71.13 46.86 C 66.9 52.79 60.71 56.82 53.76 58.29 Z" fill="currentColor" stroke="none"/>\n                <path d="M 45.26 47.3 C 46.69 47.3 47.86 46.13 47.86 44.68 C 47.86 43.23 46.69 42.05 45.26 42.05 C 43.83 42.05 42.67 43.23 42.67 44.68 C 42.67 46.13 43.83 47.3 45.26 47.3" fill="currentColor" stroke="none"/>\n                <ellipse cx="47.86" cy="46.86" rx="11.27" ry="11.27" fill="currentColor" stroke="none"/>\n            </svg>'}])},n(3,r=!0),[s,o,function(){n(3,r=!r)},r,e=>n(0,s=e.id),()=>n(0,s=null)]}class Dn extends Ee{constructor(e){super(),Ie(this,e,Bn,Hn,i,{})}}function Fn(e){let t,n;return t=new Tt({props:{$$slots:{default:[Zn]},$$scope:{ctx:e}}}),{c(){ye(t.$$.fragment)},m(e,r){ke(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function Zn(t){let n,r,o,s=t[2]+"";return{c(){n=L("tr"),r=P("Error when retrieving similarities: "),o=P(s),q(n,"class","faded is-center")},m(e,t){E(e,n,t),x(n,r),x(n,o)},p:e,d(e){e&&R(n)}}}function Jn(t){let n,r,o,s;return n=new An({}),o=new Mn({}),{c(){ye(n.$$.fragment),r=M(),ye(o.$$.fragment)},m(e,t){ke(n,e,t),E(e,r,t),ke(o,e,t),s=!0},p:e,i(e){s||(ge(n.$$.fragment,e),ge(o.$$.fragment,e),s=!0)},o(e){me(n.$$.fragment,e),me(o.$$.fragment,e),s=!1},d(e){xe(n,e),e&&R(r),xe(o,e)}}}function Xn(e){let t,n;return t=new Tt({props:{$$slots:{default:[Qn]},$$scope:{ctx:e}}}),{c(){ye(t.$$.fragment)},m(e,r){ke(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function Qn(t){let n;return{c(){n=L("tr"),n.textContent=""+("en"===Oe?"Retrieving similarities...":"Récupération des similarités..."),q(n,"class","faded is-center")},m(e,t){E(e,n,t)},p:e,d(e){e&&R(n)}}}function Gn(e){let t,n,r,o;t=new Dn({});let s={ctx:e,current:null,token:null,hasCatch:!0,pending:Xn,then:Jn,catch:Fn,value:1,error:2,blocks:[,,,]};return $e(e[0],s),{c(){ye(t.$$.fragment),n=M(),r=_(),s.block.c()},m(e,i){ke(t,e,i),E(e,n,i),E(e,r,i),s.block.m(e,s.anchor=i),s.mount=()=>r.parentNode,s.anchor=r,o=!0},p(t,[n]){we(s,e=t,n)},i(e){o||(ge(t.$$.fragment,e),ge(s.block),o=!0)},o(e){me(t.$$.fragment,e);for(let e=0;e<3;e+=1){me(s.blocks[e])}o=!1},d(e){xe(t,e),e&&R(n),e&&R(r),s.block.d(e),s.token=null,s=null}}}function Kn(e){const{fetchSimilarity:t}=Nt;return[t]}class Wn extends Ee{constructor(e){super(),Ie(this,e,Kn,Gn,i,{})}}function Yn(e){let t,n,r,o,s,i,l,a,u,d,g,$,w,b,v,y,k,C;const I=e[4].default,S=f(I,e,e[3],null);return{c(){t=L("tr"),n=L("th"),r=L("div"),o=L("img"),l=M(),a=L("div"),u=L("a"),d=L("i"),g=P("\n                    Page "),$=P(e[0]),b=M(),v=L("td"),y=L("div"),k=L("div"),S&&S.c(),c(o.src,s=Ue(e[1],"full","250,"))||q(o,"src",s),q(o,"alt",i="Canvas "+e[0]),q(o,"class","mb-3 card"),q(d,"class","fa-solid fa-pen-to-square"),q(u,"class","tag px-2 py-1 is-rounded is-hoverable"),q(u,"href",w=Ve(e[2],e[0])),q(u,"target","_blank"),q(a,"class","is-center mb-1"),q(r,"class","content-wrapper py-5"),q(n,"class","is-3 center-flex is-narrow"),A(n,"width","260px"),q(k,"class","grid is-gap-2"),q(y,"class","fixed-grid has-6-cols"),q(v,"class","p-5 is-fullwidth")},m(e,s){E(e,t,s),x(t,n),x(n,r),x(r,o),x(r,l),x(r,a),x(a,u),x(u,d),x(u,g),x(u,$),x(t,b),x(t,v),x(v,y),x(y,k),S&&S.m(k,null),C=!0},p(e,[t]){(!C||2&t&&!c(o.src,s=Ue(e[1],"full","250,")))&&q(o,"src",s),(!C||1&t&&i!==(i="Canvas "+e[0]))&&q(o,"alt",i),(!C||1&t)&&T($,e[0]),(!C||1&t&&w!==(w=Ve(e[2],e[0])))&&q(u,"href",w),S&&S.p&&(!C||8&t)&&p(S,I,e,e[3],C?m(I,e[3],t,null):h(e[3]),null)},i(e){C||(ge(S,e),C=!0)},o(e){me(S,e),C=!1},d(e){e&&R(t),S&&S.d(e)}}}function er(e,t,n){let{$$slots:r={},$$scope:o}=t,{canvasNb:s}=t,{canvasImg:i}=t;const l=Q("manifest");return e.$$set=e=>{"canvasNb"in e&&n(0,s=e.canvasNb),"canvasImg"in e&&n(1,i=e.canvasImg),"$$scope"in e&&n(3,o=e.$$scope)},[s,i,l,o,r]}class tr extends Ee{constructor(e){super(),Ie(this,e,er,Yn,i,{canvasNb:0,canvasImg:1})}}function nr(e,t,n){const r=e.slice();return r[10]=t[n][0],r[11]=t[n][1],r}function rr(e,t,n){const r=e.slice();return r[14]=t[n],r}function or(t){let n,r,o="en"===Oe?`Error when retrieving paginated regions: ${t[17]}`:`Erreur de récupération des pages : ${t[17]}`;return{c(){n=L("tr"),r=P(o),q(n,"class","faded is-center")},m(e,t){E(e,n,t),x(n,r)},p(e,t){4&t&&o!==(o="en"===Oe?`Error when retrieving paginated regions: ${e[17]}`:`Erreur de récupération des pages : ${e[17]}`)&&T(r,o)},i:e,o:e,d(e){e&&R(n)}}}function sr(e){let t,n,r,o,s;const i=[lr,ir],l=[];function c(e,n){return 8&n&&(t=null),null==t&&(t=!!(Object.values(e[3]).length>0)),t?0:1}return n=c(e,-1),r=l[n]=i[n](e),{c(){r.c(),o=_()},m(e,t){l[n].m(e,t),E(e,o,t),s=!0},p(e,t){let s=n;n=c(e,t),n===s?l[n].p(e,t):(de(),me(l[s],1,1,(()=>{l[s]=null})),fe(),r=l[n],r?r.p(e,t):(r=l[n]=i[n](e),r.c()),ge(r,1),r.m(o.parentNode,o))},i(e){s||(ge(r),s=!0)},o(e){me(r),s=!1},d(e){l[n].d(e),e&&R(o)}}}function ir(t){let n,r,o;return r=new pt({}),{c(){n=L("tr"),ye(r.$$.fragment)},m(e,t){E(e,n,t),ke(r,n,null),o=!0},p:e,i(e){o||(ge(r.$$.fragment,e),o=!0)},o(e){me(r.$$.fragment,e),o=!1},d(e){e&&R(n),xe(r)}}}function lr(e){let t,n,r=Object.entries(e[3]),o=[];for(let t=0;t<r.length;t+=1)o[t]=ur(nr(e,r,t));const s=e=>me(o[e],1,1,(()=>{o[e]=null}));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=_()},m(e,r){for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,r);E(e,t,r),n=!0},p(e,n){if(139&n){let i;for(r=Object.entries(e[3]),i=0;i<r.length;i+=1){const s=nr(e,r,i);o[i]?(o[i].p(s,n),ge(o[i],1)):(o[i]=ur(s),o[i].c(),ge(o[i],1),o[i].m(t.parentNode,t))}for(de(),i=r.length;i<o.length;i+=1)s(i);fe()}},i(e){if(!n){for(let e=0;e<r.length;e+=1)ge(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)me(o[e]);n=!1},d(e){S(o,e),e&&R(t)}}}function cr(e,t){let n,r,o;return r=new ot({props:{item:t[14],isSquare:!1,isCopied:t[0](t[14])}}),r.$on("copyRef",(function(){s(t[1])&&t[1].apply(this,arguments)})),{key:e,first:null,c(){n=_(),ye(r.$$.fragment),this.first=n},m(e,t){E(e,n,t),ke(r,e,t),o=!0},p(e,n){t=e;const o={};8&n&&(o.item=t[14]),9&n&&(o.isCopied=t[0](t[14])),r.$set(o)},i(e){o||(ge(r.$$.fragment,e),o=!0)},o(e){me(r.$$.fragment,e),o=!1},d(e){e&&R(n),xe(r,e)}}}function ar(e){let t,n,r=[],o=new Map,s=Object.values(e[11]);const i=e=>e[14].id;for(let t=0;t<s.length;t+=1){let n=rr(e,s,t),l=i(n);o.set(l,r[t]=cr(l,n))}return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=M()},m(e,o){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,o);E(e,t,o),n=!0},p(e,n){11&n&&(s=Object.values(e[11]),de(),r=ve(r,n,i,1,e,s,o,t.parentNode,be,cr,t,rr),fe())},i(e){if(!n){for(let e=0;e<s.length;e+=1)ge(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)me(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&R(t)}}}function ur(e){let t,n;return t=new tr({props:{canvasImg:e[7](e[10]),canvasNb:e[10],$$slots:{default:[ar]},$$scope:{ctx:e}}}),{c(){ye(t.$$.fragment)},m(e,r){ke(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.canvasImg=e[7](e[10])),8&n&&(r.canvasNb=e[10]),262155&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function dr(t){let n;return{c(){n=L("tr"),n.textContent=""+("en"===Oe?"Retrieving paginated regions...":"Récupération des pages..."),q(n,"class","faded is-center")},m(e,t){E(e,n,t)},p:e,i:e,o:e,d(e){e&&R(n)}}}function fr(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:dr,then:sr,catch:or,value:9,error:17,blocks:[,,,]};return $e(n=e[2],o),{c(){t=_(),o.block.c()},m(e,n){E(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,r){e=t,o.ctx=e,4&r&&n!==(n=e[2])&&$e(n,o)||we(o,e,r)},i(e){r||(ge(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1){me(o.blocks[e])}r=!1},d(e){e&&R(t),o.block.d(e),o.token=null,o=null}}}function gr(e){let t,n,r,o,s,i;return t=new Zt({props:{store:Be,nbOfItems:e[6]}}),r=new Tt({props:{$$slots:{default:[fr]},$$scope:{ctx:e}}}),s=new Zt({props:{store:Be,nbOfItems:e[6]}}),{c(){ye(t.$$.fragment),n=M(),ye(r.$$.fragment),o=M(),ye(s.$$.fragment)},m(e,l){ke(t,e,l),E(e,n,l),ke(r,e,l),E(e,o,l),ke(s,e,l),i=!0},p(e,[t]){const n={};262159&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n)},i(e){i||(ge(t.$$.fragment,e),ge(r.$$.fragment,e),ge(s.$$.fragment,e),i=!0)},o(e){me(t.$$.fragment,e),me(r.$$.fragment,e),me(s.$$.fragment,e),i=!1},d(e){xe(t,e),e&&R(n),xe(r,e),e&&R(o),xe(s,e)}}}function mr(e,t,n){let r,o;const{pageRegions:s,fetchPages:i}=Be;d(e,s,(e=>n(3,o=e))),d(e,i,(e=>n(2,r=e)));let{isItemCopied:l}=t,{handleCopyRef:c}=t;const a=Q("nbOfPages");return e.$$set=e=>{"isItemCopied"in e&&n(0,l=e.isItemCopied),"handleCopyRef"in e&&n(1,c=e.handleCopyRef)},[l,c,r,o,s,i,a,function(e){return`${imgPrefix}_${t=e,n=String(a).length+1,t.toString().padStart(n,"0")}`;var t,n}]}class pr extends Ee{constructor(e){super(),Ie(this,e,mr,gr,i,{isItemCopied:0,handleCopyRef:1})}}function hr(e,t,n){const r=e.slice();return r[24]=t[n][0],r[25]=t[n][1],r}function $r(e,t,n){const r=e.slice();return r[29]=t[n],r}function wr(e,t,n){const r=e.slice();return r[33]=t[n][0],r[25]=t[n][1],r}function br(e){let t,n,r,s,i,l,c=e[25].text+"";function a(){return e[22](e[33])}return{c(){t=L("li"),n=L("a"),r=P(c),s=M(),q(n,"href",null),U(t,"is-active",e[33]===e[4])},m(e,o){E(e,t,o),x(t,n),x(n,r),x(t,s),i||(l=[N(t,"click",a),N(t,"keyup",_r)],i=!0)},p(n,o){e=n,4&o[0]&&c!==(c=e[25].text+"")&&T(r,c),20&o[0]&&U(t,"is-active",e[33]===e[4])},d(e){e&&R(t),i=!1,o(l)}}}function vr(t){let n;return{c(){n=L("div"),n.textContent="tout doux"},m(e,t){E(e,n,t)},p:e,i:e,o:e,d(e){e&&R(n)}}}function yr(t){let n,r;return n=new Wn({}),{c(){ye(n.$$.fragment)},m(e,t){ke(n,e,t),r=!0},p:e,i(e){r||(ge(n.$$.fragment,e),r=!0)},o(e){me(n.$$.fragment,e),r=!1},d(e){xe(n,e)}}}function kr(e){let t,n;return t=new pr({props:{isItemCopied:e[3],handleCopyRef:e[14]}}),{c(){ye(t.$$.fragment)},m(e,r){ke(t,e,r),n=!0},p(e,n){const r={};8&n[0]&&(r.isItemCopied=e[3]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function xr(e){let t,n,r={ctx:e,current:null,token:null,hasCatch:!0,pending:Sr,then:Ir,catch:Cr,value:28,error:32,blocks:[,,,]};return $e(e[10],r),{c(){t=L("div"),r.block.c(),q(t,"class","grid is-gap-2")},m(e,o){E(e,t,o),r.block.m(t,r.anchor=null),r.mount=()=>t,r.anchor=null,n=!0},p(t,n){we(r,e=t,n)},i(e){n||(ge(r.block),n=!0)},o(e){for(let e=0;e<3;e+=1){me(r.blocks[e])}n=!1},d(e){e&&R(t),r.block.d(),r.token=null,r=null}}}function Cr(t){let n,r,o,s=t[32]+"";return{c(){n=L("div"),r=P("Error when retrieving regions: "),o=P(s)},m(e,t){E(e,n,t),x(n,r),x(n,o)},p:e,i:e,o:e,d(e){e&&R(n)}}}function Ir(e){let t,n,r=[],o=new Map,s=Object.values(e[7]);const i=e=>e[29].id;for(let t=0;t<s.length;t+=1){let n=$r(e,s,t),l=i(n);o.set(l,r[t]=Rr(l,n))}let l=null;return s.length||(l=Er(e)),{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=_(),l&&l.c()},m(e,o){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,o);E(e,t,o),l&&l.m(e,o),n=!0},p(e,n){22664&n[0]&&(s=Object.values(e[7]),de(),r=ve(r,n,i,1,e,s,o,t.parentNode,be,Rr,t,$r),fe(),!s.length&&l?l.p(e,n):s.length?l&&(de(),me(l,1,1,(()=>{l=null})),fe()):(l=Er(e),l.c(),ge(l,1),l.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<s.length;e+=1)ge(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)me(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&R(t),l&&l.d(e)}}}function Er(t){let n,r;return n=new pt({props:{currentRegionId:t[12],baseUrl:t[11]}}),{c(){ye(n.$$.fragment)},m(e,t){ke(n,e,t),r=!0},p:e,i(e){r||(ge(n.$$.fragment,e),r=!0)},o(e){me(n.$$.fragment,e),r=!1},d(e){xe(n,e)}}}function Rr(e,t){let n,r,o;return r=new ot({props:{item:t[29],isCopied:t[3](t[29])}}),r.$on("copyRef",t[14]),{key:e,first:null,c(){n=_(),ye(r.$$.fragment),this.first=n},m(e,t){E(e,n,t),ke(r,e,t),o=!0},p(e,n){t=e;const o={};128&n[0]&&(o.item=t[29]),136&n[0]&&(o.isCopied=t[3](t[29])),r.$set(o)},i(e){o||(ge(r.$$.fragment,e),o=!0)},o(e){me(r.$$.fragment,e),o=!1},d(e){e&&R(n),xe(r,e)}}}function Sr(t){let n;return{c(){n=L("div"),n.textContent=""+("en"===Oe?"Retrieving regions...":"Récupération des régions..."),q(n,"class","faded is-center")},m(e,t){E(e,n,t)},p:e,i:e,o:e,d(e){e&&R(n)}}}function Lr(t){let n;return{c(){n=L("div"),n.textContent=""+("en"===Oe?"No regions in selection":"Aucune région sélectionnée")},m(e,t){E(e,n,t)},p:e,d(e){e&&R(n)}}}function Or(e){let t,n,r=Object.entries(e[1]),o=[];for(let t=0;t<r.length;t+=1)o[t]=Pr(hr(e,r,t));return{c(){t=L("div"),n=L("div");for(let e=0;e<o.length;e+=1)o[e].c();q(n,"class","grid is-gap-2"),q(t,"class","fixed-grid has-6-cols")},m(e,r){E(e,t,r),x(t,n);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(n,null)},p(e,t){if(2&t[0]){let s;for(r=Object.entries(e[1]),s=0;s<r.length;s+=1){const i=hr(e,r,s);o[s]?o[s].p(i,t):(o[s]=Pr(i),o[s].c(),o[s].m(n,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=r.length}},d(e){e&&R(t),S(o,e)}}}function Pr(e){let t,n,r,o,s,i,l,a,u,d,f,g,m,p=e[25].title+"";function h(){return e[23](e[24])}return{c(){t=L("div"),n=L("figure"),r=L("img"),s=M(),i=L("div"),l=L("span"),a=P(p),u=M(),d=L("button"),f=M(),c(r.src,o=Ue(e[25].img,e[25].xyhw,"96,"))||q(r,"src",o),q(r,"alt","Extracted region"),q(l,"class","overlay-desc"),q(i,"class","overlay is-center svelte-403wty"),q(n,"class","image is-64x64 card"),q(d,"class","delete region-btn"),q(d,"aria-label","remove from selection"),q(t,"class","selection cell svelte-403wty")},m(e,o){E(e,t,o),x(t,n),x(n,r),x(n,s),x(n,i),x(i,l),x(l,a),x(t,u),x(t,d),x(t,f),g||(m=N(d,"click",h),g=!0)},p(t,n){e=t,2&n[0]&&!c(r.src,o=Ue(e[25].img,e[25].xyhw,"96,"))&&q(r,"src",o),2&n[0]&&p!==(p=e[25].title+"")&&T(a,p)},d(e){e&&R(t),g=!1,m()}}}function Mr(e){let t,n,r,o,s,i,l,c,a,u,d,f,g,m,p,h,$,w,b,v,y,k,C,I,O,_,N,j,A,U,V,z,H,B,D,F,Z,J,X,Q="en"===Oe?"Selected regions":"Regions sélectionnées";t=new Ge({props:{visible:e[6]}}),r=new ft({}),s=new lt({props:{selectionLength:e[0]}}),u=new kt({props:{baseUrl:e[11],currentRegionId:e[12]}}),g=new _t({});let G=Object.entries(e[2]),K=[];for(let t=0;t<G.length;t+=1)K[t]=br(wr(e,G,t));const W=[xr,kr,yr,vr],Y=[];function ee(e,t){return"all"===e[4]?0:"page"===e[4]?1:"similarity"===e[4]?2:"vectorization"===e[4]?3:-1}function te(e,t){return e[5]?Or:Lr}~(w=ee(e))&&(b=Y[w]=W[w](e));let ne=te(e),re=ne(e);return J=new ut({props:{isRegion:!0}}),{c(){ye(t.$$.fragment),n=M(),ye(r.$$.fragment),o=M(),ye(s.$$.fragment),i=M(),l=L("div"),c=L("div"),a=L("div"),ye(u.$$.fragment),d=M(),f=L("div"),ye(g.$$.fragment),m=M(),p=L("div"),h=L("ul");for(let e=0;e<K.length;e+=1)K[e].c();$=M(),b&&b.c(),v=M(),y=L("div"),k=L("div"),C=M(),I=L("div"),O=L("div"),_=L("div"),N=L("i"),j=M(),A=P(Q),U=P("\n                ("),V=P(e[0]),z=P(")"),H=M(),B=L("button"),D=M(),F=L("section"),re.c(),Z=M(),ye(J.$$.fragment),q(a,"class","cell is-right is-middle"),q(f,"class","cell"),q(c,"class","actions grid"),q(h,"class","panel-tabs"),q(p,"class","tabs is-centered"),q(l,"id","nav-actions"),q(l,"class","mb-5 svelte-403wty"),q(k,"class","modal-background"),q(N,"class","fa-solid fa-book-bookmark"),q(_,"class","title is-4 mb-0 media-content"),q(B,"class","delete media-left"),q(B,"aria-label","close"),q(O,"class","modal-card-head media mb-0"),q(F,"class","modal-card-body"),q(I,"class","modal-content"),q(y,"id","selection-modal"),q(y,"class","modal fade"),q(y,"tabindex","-1"),q(y,"aria-labelledby","selection-modal-label"),q(y,"aria-hidden","true")},m(e,b){ke(t,e,b),E(e,n,b),ke(r,e,b),E(e,o,b),ke(s,e,b),E(e,i,b),E(e,l,b),x(l,c),x(c,a),ke(u,a,null),x(c,d),x(c,f),ke(g,f,null),x(l,m),x(l,p),x(p,h);for(let e=0;e<K.length;e+=1)K[e]&&K[e].m(h,null);E(e,$,b),~w&&Y[w].m(e,b),E(e,v,b),E(e,y,b),x(y,k),x(y,C),x(y,I),x(I,O),x(O,_),x(_,N),x(_,j),x(_,A),x(_,U),x(_,V),x(_,z),x(O,H),x(O,B),x(I,D),x(I,F),re.m(F,null),x(I,Z),ke(J,I,null),X=!0},p(e,n){const r={};64&n[0]&&(r.visible=e[6]),t.$set(r);const o={};if(1&n[0]&&(o.selectionLength=e[0]),s.$set(o),8212&n[0]){let t;for(G=Object.entries(e[2]),t=0;t<G.length;t+=1){const r=wr(e,G,t);K[t]?K[t].p(r,n):(K[t]=br(r),K[t].c(),K[t].m(h,null))}for(;t<K.length;t+=1)K[t].d(1);K.length=G.length}let i=w;w=ee(e),w===i?~w&&Y[w].p(e,n):(b&&(de(),me(Y[i],1,1,(()=>{Y[i]=null})),fe()),~w?(b=Y[w],b?b.p(e,n):(b=Y[w]=W[w](e),b.c()),ge(b,1),b.m(v.parentNode,v)):b=null),(!X||1&n[0])&&T(V,e[0]),ne===(ne=te(e))&&re?re.p(e,n):(re.d(1),re=ne(e),re&&(re.c(),re.m(F,null)))},i(e){X||(ge(t.$$.fragment,e),ge(r.$$.fragment,e),ge(s.$$.fragment,e),ge(u.$$.fragment,e),ge(g.$$.fragment,e),ge(b),ge(J.$$.fragment,e),X=!0)},o(e){me(t.$$.fragment,e),me(r.$$.fragment,e),me(s.$$.fragment,e),me(u.$$.fragment,e),me(g.$$.fragment,e),me(b),me(J.$$.fragment,e),X=!1},d(e){xe(t,e),e&&R(n),xe(r,e),e&&R(o),xe(s,e),e&&R(i),e&&R(l),xe(u),xe(g),S(K,e),e&&R($),~w&&Y[w].d(e),e&&R(v),e&&R(y),re.d(),xe(J)}}}const _r=()=>null;function Nr(e,t,n){let r,o,s,i,l,c,a,u,f;d(e,Te,(e=>n(6,u=e)));const{selected:g}=He;d(e,g,(e=>n(21,a=e)));const{allRegions:m,fetchAll:p}=Be;d(e,m,(e=>n(7,f=e)));let{manifest:h=""}=t,{isValidated:$=!1}=t,{imgPrefix:w=""}=t,{nbOfPages:b=1}=t,{witness:v={}}=t;X("witness",v),X("nbOfPages",b),X("imgPrefix",w),X("manifest",h),X("isValidated",$);const y=`${window.location.origin}${window.location.pathname}`,k=parseInt(y.split("regions/")[1].replace("/","")),x={all:{text:"en"===Oe?"All regions":"Toutes les régions"},page:{text:"en"===Oe?"Per page":"Par page"}};function C(e){n(4,i=e);const t=new URL(window.location);t.searchParams.set("tab",e),window.history.pushState({},"",t)}_e.includes("similarity")&&(x.similarity={text:"en"===Oe?"Similarity":"Similarité"}),_e.includes("vectorization")&&(x.vectorization={text:"en"===Oe?"Vectorization":"Vectorisation"});return e.$$set=e=>{"manifest"in e&&n(15,h=e.manifest),"isValidated"in e&&n(16,$=e.isValidated),"imgPrefix"in e&&n(17,w=e.imgPrefix),"nbOfPages"in e&&n(18,b=e.nbOfPages),"witness"in e&&n(19,v=e.witness)},e.$$.update=()=>{2097152&e.$$.dirty[0]&&n(1,r=a(!0)),2&e.$$.dirty[0]&&n(0,o=Object.keys(r).length),1&e.$$.dirty[0]&&n(5,s=o>0),1048576&e.$$.dirty[0]&&n(3,c=e=>l===e.ref)},n(4,i=new URLSearchParams(window.location.search).get("tab")??"all"),n(20,l=""),[o,r,x,c,i,s,u,f,g,m,p,y,k,C,function(e){const{item:t}=e.detail,r=c(t)?"":t.ref;navigator.clipboard.writeText(r),n(20,l=r)},h,$,w,b,v,l,a,e=>C(e),e=>He.remove(e,Ne)]}return new class extends Ee{constructor(e){super(),Ie(this,e,Nr,Mr,i,{manifest:15,isValidated:16,imgPrefix:17,nbOfPages:18,witness:19},null,[-1,-1])}}({target:document.getElementById("region-list"),props:{witness:witness,manifest:manifest,isValidated:isValidated,imgPrefix:imgPrefix,nbOfPages:nbOfPages}})}();
//# sourceMappingURL=regionList.js.map
