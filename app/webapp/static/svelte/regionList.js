var regionList=function(){"use strict";function t(){}const e=t=>t;function n(t){return t()}function r(){return Object.create(null)}function o(t){t.forEach(n)}function s(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let l;function c(t,e){return l||(l=document.createElement("a")),l.href=e,t===l.href}function a(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function u(t){let e;return a(t,(t=>e=t))(),e}function d(t,e,n){t.$$.on_destroy.push(a(e,n))}function f(t,e,n,r){if(t){const o=g(t,e,n,r);return t[0](o)}}function g(t,e,n,r){return t[1]&&r?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](r(e))):n.ctx}function m(t,e,n,r){if(t[2]&&r){const o=t[2](r(n));if(void 0===e.dirty)return o;if("object"==typeof o){const t=[],n=Math.max(e.dirty.length,o.length);for(let r=0;r<n;r+=1)t[r]=e.dirty[r]|o[r];return t}return e.dirty|o}return e.dirty}function p(t,e,n,r,o,s){if(o){const i=g(e,n,r,s);t.p(i,o)}}function h(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1}function $(t){const e="string"==typeof t&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[t,"px"]}const w="undefined"!=typeof window;let b=w?()=>window.performance.now():()=>Date.now(),v=w?t=>requestAnimationFrame(t):t;const y=new Set;function k(t){y.forEach((e=>{e.c(t)||(y.delete(e),e.f())})),0!==y.size&&v(k)}function x(t,e){t.appendChild(e)}function C(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function I(t){const e=R("style");return function(t,e){x(t.head||t,e),e.sheet}(C(t),e),e.sheet}function S(t,e,n){t.insertBefore(e,n||null)}function O(t){t.parentNode&&t.parentNode.removeChild(t)}function E(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function R(t){return document.createElement(t)}function L(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function P(t){return document.createTextNode(t)}function _(){return P(" ")}function M(){return P("")}function j(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function N(t){return function(e){return e.preventDefault(),t.call(this,e)}}function T(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function q(t,e){e=""+e,t.data!==e&&(t.data=e)}function A(t,e,n,r){null==n?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function U(t,e,n){t.classList[n?"add":"remove"](e)}function V(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(t,n,r,e),o}const z=new Map;let H,B=0;function F(t,e,n,r,o,s,i,l=0){const c=16.666/r;let a="{\n";for(let t=0;t<=1;t+=c){const r=e+(n-e)*s(t);a+=100*t+`%{${i(r,1-r)}}\n`}const u=a+`100% {${i(n,1-n)}}\n}`,d=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(u)}_${l}`,f=C(t),{stylesheet:g,rules:m}=z.get(f)||function(t,e){const n={stylesheet:I(e),rules:{}};return z.set(t,n),n}(f,t);m[d]||(m[d]=!0,g.insertRule(`@keyframes ${d} ${u}`,g.cssRules.length));const p=t.style.animation||"";return t.style.animation=`${p?`${p}, `:""}${d} ${r}ms linear ${o}ms 1 both`,B+=1,d}function D(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),o=n.length-r.length;o&&(t.style.animation=r.join(", "),B-=o,B||v((()=>{B||(z.forEach((t=>{const{ownerNode:e}=t.stylesheet;e&&O(e)})),z.clear())})))}function J(t){H=t}function Z(){if(!H)throw new Error("Function called outside component initialization");return H}function X(t,e){return Z().$$.context.set(t,e),e}function Q(t){return Z().$$.context.get(t)}const K=[],G=[];let W=[];const Y=[],tt=Promise.resolve();let et=!1;function nt(t){W.push(t)}const rt=new Set;let ot,st=0;function it(){if(0!==st)return;const t=H;do{try{for(;st<K.length;){const t=K[st];st++,J(t),lt(t.$$)}}catch(t){throw K.length=0,st=0,t}for(J(null),K.length=0,st=0;G.length;)G.pop()();for(let t=0;t<W.length;t+=1){const e=W[t];rt.has(e)||(rt.add(e),e())}W.length=0}while(K.length);for(;Y.length;)Y.pop()();et=!1,rt.clear(),J(t)}function lt(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(nt)}}function ct(t,e,n){t.dispatchEvent(V(`${e?"intro":"outro"}${n}`))}const at=new Set;let ut;function dt(){ut={r:0,c:[],p:ut}}function ft(){ut.r||o(ut.c),ut=ut.p}function gt(t,e){t&&t.i&&(at.delete(t),t.i(e))}function mt(t,e,n,r){if(t&&t.o){if(at.has(t))return;at.add(t),ut.c.push((()=>{at.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}else r&&r()}const pt={duration:0};function ht(n,r,i,l){const c={direction:"both"};let a=r(n,i,c),u=l?0:1,d=null,f=null,g=null;function m(){g&&D(n,g)}function p(t,e){const n=t.b-u;return e*=Math.abs(n),{a:u,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function h(r){const{delay:s=0,duration:i=300,easing:l=e,tick:c=t,css:h}=a||pt,$={start:b()+s,b:r};r||($.group=ut,ut.r+=1),d||f?f=$:(h&&(m(),g=F(n,u,r,i,s,l,h)),r&&c(0,1),d=p($,i),nt((()=>ct(n,r,"start"))),function(t){let e;0===y.size&&v(k),new Promise((n=>{y.add(e={c:t,f:n})}))}((t=>{if(f&&t>f.start&&(d=p(f,i),f=null,ct(n,d.b,"start"),h&&(m(),g=F(n,u,d.b,d.duration,0,l,a.css))),d)if(t>=d.end)c(u=d.b,1-u),ct(n,d.b,"end"),f||(d.b?m():--d.group.r||o(d.group.c)),d=null;else if(t>=d.start){const e=t-d.start;u=d.a+d.d*l(e/d.duration),c(u,1-u)}return!(!d&&!f)})))}return{run(t){s(a)?(ot||(ot=Promise.resolve(),ot.then((()=>{ot=null}))),ot).then((()=>{a=a(c),h(t)})):h(t)},end(){m(),d=f=null}}}function $t(t,e){const n=e.token={};function r(t,r,o,s){if(e.token!==n)return;e.resolved=s;let i=e.ctx;void 0!==o&&(i=i.slice(),i[o]=s);const l=t&&(e.current=t)(i);let c=!1;e.block&&(e.blocks?e.blocks.forEach(((t,n)=>{n!==r&&t&&(dt(),mt(t,1,1,(()=>{e.blocks[n]===t&&(e.blocks[n]=null)})),ft())})):e.block.d(1),l.c(),gt(l,1),l.m(e.mount(),e.anchor),c=!0),e.block=l,e.blocks&&(e.blocks[r]=l),c&&it()}if(!(o=t)||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then){if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}else{const n=Z();if(t.then((t=>{J(n),r(e.then,1,e.value,t),J(null)}),(t=>{if(J(n),r(e.catch,2,e.error,t),J(null),!e.hasCatch)throw t})),e.current!==e.pending)return r(e.pending,0),!0}var o}function wt(t,e,n){const r=e.slice(),{resolved:o}=t;t.current===t.then&&(r[t.value]=o),t.current===t.catch&&(r[t.error]=o),t.block.p(r,n)}function bt(t,e){mt(t,1,1,(()=>{e.delete(t.key)}))}function vt(t,e,n,r,s,i,l,c,a,u,d,f){let g=t.length,m=i.length,p=g;const h={};for(;p--;)h[t[p].key]=p;const $=[],w=new Map,b=new Map,v=[];for(p=m;p--;){const t=f(s,i,p),o=n(t);let c=l.get(o);c?r&&v.push((()=>c.p(t,e))):(c=u(o,t),c.c()),w.set(o,$[p]=c),o in h&&b.set(o,Math.abs(p-h[o]))}const y=new Set,k=new Set;function x(t){gt(t,1),t.m(c,d),l.set(t.key,t),d=t.first,m--}for(;g&&m;){const e=$[m-1],n=t[g-1],r=e.key,o=n.key;e===n?(d=e.first,g--,m--):w.has(o)?!l.has(r)||y.has(r)?x(e):k.has(o)?g--:b.get(r)>b.get(o)?(k.add(r),x(e)):(y.add(o),g--):(a(n,l),g--)}for(;g--;){const e=t[g];w.has(e.key)||a(e,l)}for(;m;)x($[m-1]);return o(v),$}function yt(t){t&&t.c()}function kt(t,e,r,i){const{fragment:l,after_update:c}=t.$$;l&&l.m(e,r),i||nt((()=>{const e=t.$$.on_mount.map(n).filter(s);t.$$.on_destroy?t.$$.on_destroy.push(...e):o(e),t.$$.on_mount=[]})),c.forEach(nt)}function xt(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];W.forEach((r=>-1===t.indexOf(r)?e.push(r):n.push(r))),n.forEach((t=>t())),W=e}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ct(t,e){-1===t.$$.dirty[0]&&(K.push(t),et||(et=!0,tt.then(it)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function It(e,n,s,i,l,c,a,u=[-1]){const d=H;J(e);const f=e.$$={fragment:null,ctx:[],props:c,update:t,not_equal:l,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(d?d.$$.context:[])),callbacks:r(),dirty:u,skip_bound:!1,root:n.target||d.$$.root};a&&a(f.root);let g=!1;if(f.ctx=s?s(e,n.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return f.ctx&&l(f.ctx[t],f.ctx[t]=o)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](o),g&&Ct(e,t)),n})):[],f.update(),g=!0,o(f.before_update),f.fragment=!!i&&i(f.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);f.fragment&&f.fragment.l(t),t.forEach(O)}else f.fragment&&f.fragment.c();n.intro&&gt(e.$$.fragment),kt(e,n.target,n.anchor,n.customElement),it()}J(d)}class St{$destroy(){xt(this,1),this.$destroy=t}$on(e,n){if(!s(n))return t;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const t=r.indexOf(n);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Ot=[];function Et(e,n=t){let r;const o=new Set;function s(t){if(i(e,t)&&(e=t,r)){const t=!Ot.length;for(const t of o)t[1](),Ot.push(t,e);if(t){for(let t=0;t<Ot.length;t+=2)Ot[t][0](Ot[t+1]);Ot.length=0}}}return{set:s,update:function(t){s(t(e))},subscribe:function(i,l=t){const c=[i,l];return o.add(c),1===o.size&&(r=n(s)||t),i(e),()=>{o.delete(c),0===o.size&&r&&(r(),r=null)}}}}function Rt(e,n,r){const i=!Array.isArray(e),l=i?[e]:e,c=n.length<2;return u=e=>{let r=!1;const u=[];let d=0,f=t;const g=()=>{if(d)return;f();const r=n(i?u[0]:u,e);c?e(r):f=s(r)?r:t},m=l.map(((t,e)=>a(t,(t=>{u[e]=t,d&=~(1<<e),r&&g()}),(()=>{d|=1<<e}))));return r=!0,g(),function(){o(m),f(),r=!1}},{subscribe:Et(r,u).subscribe};var u}const Lt=APP_LANG,Pt=USER_ID,_t=CSRF_TOKEN,Mt=ADDITIONAL_MODULES,jt="Regions",Nt=SAS_APP_URL,Tt=CANTALOUPE_APP_URL,qt=Et(!1);async function At(t){qt.set(!0);try{return await t()}finally{qt.set(!1)}}function Ut(t=null,e="full",n="full"){if(!t)return"https://via.placeholder.com/96x96?text=No+Image";if((t=t.split("_")).length<3)return"https://via.placeholder.com/96x96?text=No+Image";const r=t[t.length-1].includes(",")?t.pop().replace(".jpg",""):e,o=t.join("_").replace(".jpg","");return`${Tt??"http://localhost:8182"}/iiif/2/${o}.jpg/${r}/${n}/0/default.jpg`}function Vt(t=null,e=1){return`${Nt??"http://localhost:3000"}/index.html?iiif-content=${t}&canvas=${e}`}function zt(t,e=null,n=!1){return new Promise((r=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:r(void 0),e&&(document.getElementById("modal-title").textContent=e),document.getElementById("modal-body").textContent=t,document.getElementById("hidden-msg-btn").click();const o=document.getElementById("cancel-btn"),s=document.getElementById("ok-btn"),i=document.getElementById("modal-bkg"),l=()=>{o.removeEventListener("click",c),i.removeEventListener("click",c),s.removeEventListener("click",a),document.getElementById("modal-footer").hidden=!0},c=()=>{l(),r(!1)},a=()=>{l(),r(!0)};o.addEventListener("click",c),s.addEventListener("click",a)}else n?r(window.confirm(t)):(window.alert(t),r(void 0))}))}const Ht=function(){const t=Et(JSON.parse(localStorage.getItem("documentSet"))||{}),{subscribe:e,get:n,update:r}=t;function o(t){localStorage.setItem("documentSet",JSON.stringify(t))}function s(t,e=!0){return e?t[jt]??{}:Object.entries(t).filter((([t,e])=>t!==jt))}function i(t,e,n){if(t[n]){const{[e]:r,...o}=t[n];t={...t,[n]:o}}return o(t),t}function l(t,e){return t.hasOwnProperty(e.type)||(t[e.type]={}),t[e.type]={...t[e.type],[e.id]:e},o(t),t}return{subscribe:e,save:()=>r((t=>(console.log(t),t))),empty:t=>r((e=>(t?delete e[jt]:Object.keys(e).forEach((t=>{t!==jt&&delete e[t]})),o(e),e))),addAll:t=>r((e=>function(t,e){return e.forEach((e=>{t[e.type]||(t[e.type]={}),t[e.type][e.id]=e})),o(t),t}(e,t))),removeAll:(t,e)=>r((n=>function(t,e,n){return t[n]?(e.forEach((e=>{delete t[n][e]})),o(t),t):t}(n,t,e))),remove:(t,e)=>r((n=>i(n,t,e))),add:t=>r((e=>l(e,t))),toggle:t=>r((e=>e[t.type]?.[t.id]?i(e,t.id,t.type):l(e,t))),toggleAll:(t,e,n)=>r((t=>{})),isSelected:Rt(t,(t=>e=>t[e.type]?.hasOwnProperty(e.id)||!1)),selected:Rt(t,(t=>e=>s(t,e))),nbSelected:Rt(t,(t=>e=>{const n=s(t,e);return e?Object.keys(n).length:n.reduce(((t,[e,n])=>t+Object.keys(n).length),0)}))}}();const Bt=function(){const t=Et(1),e=Et({}),n=Et({}),r=`${window.location.origin}${window.location.pathname}`;if("undefined"!=typeof window){const e=new URLSearchParams(window.location.search).get("p");e&&t.set(parseInt(e))}const o=(async()=>{const t=await fetch(`${r}canvas`),n=await t.json();let o={};return Object.values(n).forEach((t=>{Object.entries(t).forEach((([t,e])=>{o[t]=e}))})),e.set(o),n})(),s=Rt(t,(t=>(async()=>{const e=await fetch(`${r}canvas?p=${t}`),o=await e.json();return n.set(o),o})()));return{currentPage:t,pageRegions:n,allRegions:e,fetchPages:s,fetchAll:o,handlePageUpdate:function(e){if(t.set(e),"undefined"!=typeof window){const t=new URL(window.location.href);t.searchParams.set("p",e),window.history.pushState({},"",t)}},remove:function(t){e.update((e=>(delete e[t],{...e}))),n.update((e=>{for(const n in e)if(e[n][t]){const{[t]:r,...o}=e[n];return e[n]=o,e}return e}))}}}();function Ft(t){const e=t-1;return e*e*e+1}function Dt(t,{delay:n=0,duration:r=400,easing:o=e}={}){const s=+getComputedStyle(t).opacity;return{delay:n,duration:r,easing:o,css:t=>"opacity: "+t*s}}function Jt(t,{delay:e=0,duration:n=400,easing:r=Ft,x:o=0,y:s=0,opacity:i=0}={}){const l=getComputedStyle(t),c=+l.opacity,a="none"===l.transform?"":l.transform,u=c*(1-i),[d,f]=$(o),[g,m]=$(s);return{delay:e,duration:n,easing:r,css:(t,e)=>`\n\t\t\ttransform: ${a} translate(${(1-t)*d}${f}, ${(1-t)*g}${m});\n\t\t\topacity: ${c-u*e}`}}function Zt(t){let e,n,r;return{c(){e=R("div"),e.innerHTML='<div class="loader svelte-vizlcg"></div>',T(e,"class","bkg-shade svelte-vizlcg")},m(t,n){S(t,e,n),r=!0},i(t){r||(nt((()=>{r&&(n||(n=ht(e,Dt,{duration:150},!0)),n.run(1))})),r=!0)},o(t){n||(n=ht(e,Dt,{duration:150},!1)),n.run(0),r=!1},d(t){t&&O(e),t&&n&&n.end()}}}function Xt(t){let e,n,r=t[0]&&Zt();return{c(){r&&r.c(),e=M()},m(t,o){r&&r.m(t,o),S(t,e,o),n=!0},p(t,[n]){t[0]?r?1&n&&gt(r,1):(r=Zt(),r.c(),gt(r,1),r.m(e.parentNode,e)):r&&(dt(),mt(r,1,1,(()=>{r=null})),ft())},i(t){n||(gt(r),n=!0)},o(t){mt(r),n=!1},d(t){r&&r.d(t),t&&O(e)}}}function Qt(t,e,n){let{visible:r=!1}=e;return t.$$set=t=>{"visible"in t&&n(0,r=t.visible)},[r]}class Kt extends St{constructor(t){super(),It(this,t,Qt,Xt,i,{visible:0})}}function Gt(t){let e;return{c(){e=L("path"),T(e,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),T(e,"class","svelte-es4wbs")},m(t,n){S(t,e,n)},d(t){t&&O(e)}}}function Wt(t){let e;return{c(){e=L("path"),T(e,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),T(e,"class","svelte-es4wbs")},m(t,n){S(t,e,n)},d(t){t&&O(e)}}}function Yt(e){let n,r="en"===Lt?"Copy ID":"Copier l'ID";return{c(){n=P(r)},m(t,e){S(t,n,e)},p:t,d(t){t&&O(n)}}}function te(e){let n,r="en"===Lt?"Copied!":"Copié !";return{c(){n=P(r)},m(t,e){S(t,n,e)},p:t,d(t){t&&O(n)}}}function ee(t){let e,n,r,s,i,l,a,u,d,f,g,m,p,h,$,w,b,v,y,k=t[0].title+"";function C(t,e){return t[1]?Wt:Gt}let I=C(t),E=I(t);function M(t,e){return t[1]?te:Yt}let N=M(t),A=N(t);return{c(){e=R("div"),n=R("figure"),r=R("img"),i=_(),l=R("div"),a=R("span"),u=P(k),f=_(),g=R("button"),m=L("svg"),E.c(),p=_(),h=R("span"),A.c(),c(r.src,s=Ut(t[0].img,t[0].xyhw,t[2]?"96,":"140,"))||T(r,"src",s),T(r,"alt","Extracted region"),T(a,"class","overlay-desc"),T(l,"class","overlay is-center svelte-es4wbs"),T(n,"class",d="image card "+(t[2]?"is-96x96":"")+" svelte-es4wbs"),T(n,"tabindex","-1"),T(m,"xmlns","http://www.w3.org/2000/svg"),T(m,"viewBox","0 0 384 512"),T(m,"class","svelte-es4wbs"),T(h,"class","tooltip svelte-es4wbs"),T(g,"class","button region-btn tag svelte-es4wbs"),T(e,"class",$="region image is-center "+(t[3](t[0])?"checked":"")+" svelte-es4wbs")},m(o,s){S(o,e,s),x(e,n),x(n,r),x(n,i),x(n,l),x(l,a),x(a,u),x(e,f),x(e,g),x(g,m),E.m(m,null),x(g,p),x(g,h),A.m(h,null),b=!0,v||(y=[j(n,"click",t[6]),j(n,"keyup",ne),j(g,"click",t[7])],v=!0)},p(t,[o]){(!b||5&o&&!c(r.src,s=Ut(t[0].img,t[0].xyhw,t[2]?"96,":"140,")))&&T(r,"src",s),(!b||1&o)&&k!==(k=t[0].title+"")&&q(u,k),(!b||4&o&&d!==(d="image card "+(t[2]?"is-96x96":"")+" svelte-es4wbs"))&&T(n,"class",d),I!==(I=C(t))&&(E.d(1),E=I(t),E&&(E.c(),E.m(m,null))),N===(N=M(t))&&A?A.p(t,o):(A.d(1),A=N(t),A&&(A.c(),A.m(h,null))),(!b||9&o&&$!==($="region image is-center "+(t[3](t[0])?"checked":"")+" svelte-es4wbs"))&&T(e,"class",$)},i(t){b||(nt((()=>{b&&(w||(w=ht(e,Dt,{duration:500},!0)),w.run(1))})),b=!0)},o(t){w||(w=ht(e,Dt,{duration:500},!1)),w.run(0),b=!1},d(t){t&&O(e),E.d(),A.d(),t&&w&&w.end(),v=!1,o(y)}}}const ne=()=>null;function re(t,e,n){let r;const{isSelected:o}=Ht;d(t,o,(t=>n(3,r=t)));const s=function(){const t=Z();return(e,n,{cancelable:r=!1}={})=>{const o=t.$$.callbacks[e];if(o){const s=V(e,n,{cancelable:r});return o.slice().forEach((e=>{e.call(t,s)})),!s.defaultPrevented}return!0}}();let{item:i}=e,{isCopied:l=!1}=e,{isSquare:c=!0}=e;function a(){s("copyRef",{item:i})}return t.$$set=t=>{"item"in t&&n(0,i=t.item),"isCopied"in t&&n(1,l=t.isCopied),"isSquare"in t&&n(2,c=t.isSquare)},[i,l,c,r,o,a,()=>Ht.toggle(i),()=>a()]}class oe extends St{constructor(t){super(),It(this,t,re,ee,i,{item:0,isCopied:1,isSquare:2})}}function se(e){let n,r,o,s,i,l,c,a,u,d="en"===Lt?"Selection":"Sélection";return{c(){n=R("div"),r=R("button"),o=R("span"),s=R("i"),i=_(),l=P(d),c=P("\n            ("),a=P(e[0]),u=P(")"),T(s,"class","fa-solid fa-book-bookmark"),T(o,"id","btn-content"),T(r,"id","set-btn"),T(r,"class","button px-5 py-4 is-link js-modal-trigger svelte-hs48f9"),T(r,"data-target","selection-modal"),T(n,"class","set-container svelte-hs48f9")},m(t,e){S(t,n,e),x(n,r),x(r,o),x(o,s),x(o,i),x(o,l),x(o,c),x(o,a),x(o,u)},p(t,[e]){1&e&&q(a,t[0])},i:t,o:t,d(t){t&&O(n)}}}function ie(t,e,n){let{selectionLength:r=0}=e,o=r;return t.$$set=t=>{"selectionLength"in t&&n(0,r=t.selectionLength)},t.$$.update=()=>{if(3&t.$$.dirty&&r!==o){const t=r>o;n(1,o=r);const e=document.getElementById("btn-content");e&&e.animate([{transform:t?"translateY(-7px)":"translateX(-5px)"},{transform:t?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[r,o]}class le extends St{constructor(t){super(),It(this,t,ie,se,i,{selectionLength:0})}}function ce(e){let n,r,s,i,l,c,a,u,d,f,g="en"===Lt?"Save selection":"Sauvegarder la sélection";return{c(){n=R("footer"),r=R("div"),s=R("button"),s.textContent=""+("en"===Lt?"Clear selection":"Vider la sélection"),i=_(),l=R("button"),c=R("i"),a=_(),u=P(g),T(s,"class","button is-link is-light"),T(c,"class","fa-solid fa-floppy-disk"),T(l,"class","button is-link"),T(r,"class","buttons"),T(n,"class","modal-card-foot is-center")},m(t,o){S(t,n,o),x(n,r),x(r,s),x(r,i),x(r,l),x(l,c),x(l,a),x(l,u),d||(f=[j(s,"click",e[1]),j(l,"click",e[2])],d=!0)},p:t,i:t,o:t,d(t){t&&O(n),d=!1,o(f)}}}function ae(t,e,n){let{isRegion:r=!0}=e;return t.$$set=t=>{"isRegion"in t&&n(0,r=t.isRegion)},[r,()=>Ht.empty(r),()=>Ht.save()]}class ue extends St{constructor(t){super(),It(this,t,ae,ce,i,{isRegion:0})}}function de(e){let n,r,o,s,i,l,c,a,u,d,f,g,m,p,h;return{c(){n=R("button"),r=_(),o=R("div"),s=R("div"),i=_(),l=R("div"),c=R("div"),c.innerHTML='<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div> \n            <button class="delete media-left" aria-label="close"></button>',a=_(),u=R("section"),d=_(),f=R("footer"),g=R("div"),m=R("button"),m.textContent=""+("en"===Lt?"Cancel":"Annuler"),p=_(),h=R("button"),h.textContent="OK",T(n,"id","hidden-msg-btn"),T(n,"class","js-modal-trigger"),T(n,"data-target","msg-modal"),n.hidden=!0,T(s,"id","modal-bkg"),T(s,"class","modal-background"),T(c,"class","modal-card-head media mb-0"),T(u,"id","modal-body"),T(u,"class","modal-card-body"),T(m,"id","cancel-btn"),T(m,"class","button is-link is-light"),T(h,"id","ok-btn"),T(h,"class","button is-link"),T(g,"class","buttons"),T(f,"id","modal-footer"),T(f,"class","modal-card-foot is-center pt-3"),f.hidden=!0,T(l,"class","modal-content"),T(o,"id","msg-modal"),T(o,"class","modal fade"),T(o,"tabindex","-1"),T(o,"aria-labelledby","selection-modal-label"),T(o,"aria-hidden","true")},m(t,e){S(t,n,e),S(t,r,e),S(t,o,e),x(o,s),x(o,i),x(o,l),x(l,c),x(l,a),x(l,u),x(l,d),x(l,f),x(f,g),x(g,m),x(g,p),x(g,h)},p:t,i:t,o:t,d(t){t&&O(n),t&&O(r),t&&O(o)}}}class fe extends St{constructor(t){super(),It(this,t,null,de,i,{})}}function ge(e){let n,r,o,s,i,l,c,a=Mt.includes("regions"),u=a&&function(e){let n;return{c(){n=R("button"),n.textContent="en"===Lt?"Automatic region extraction":"Extraction automatique des régions",T(n,"class","button is-link is-inverted")},m(t,e){S(t,n,e)},p:t,d(t){t&&O(n)}}}();return{c(){n=R("div"),r=R("button"),r.textContent=""+("en"===Lt?"Manually annotate":"Annoter manuellement"),o=_(),s=R("button"),s.textContent=""+("en"===Lt?"Import regions file":"Importer un fichier de région"),i=_(),u&&u.c(),T(r,"class","button is-link"),T(s,"class","button is-link is-light"),T(n,"class","is-center buttons is-centered pt-5")},m(t,a){S(t,n,a),x(n,r),x(n,o),x(n,s),x(n,i),u&&u.m(n,null),l||(c=j(r,"click",e[0]),l=!0)},p(t,[e]){a&&u.p(t,e)},i:t,o:t,d(t){t&&O(n),u&&u.d(),l=!1,c()}}}function me(t,e,n){const r=Q("witness");let{currentRegionId:o}=e,{baseUrl:s}=e;return t.$$set=t=>{"currentRegionId"in t&&n(1,o=t.currentRegionId),"baseUrl"in t&&n(2,s=t.baseUrl)},[async function(){const t=window.location.origin;let e=`${t}/witness/${r.id}/regions/add`;if(1===r.regions.length||o){const n=o||r.regions[0];e=`${t}/witness/${r.id}/regions/${n}/add`}const n=await At((()=>fetch(e,{method:"POST",headers:{"X-CSRFToken":_t}})));if(!n.ok)throw await zt(`Failed to create regions: '${n.statusText}'`,"Error"),new Error(`Failed to create regions: '${n.statusText}'`);let i;try{i=await n.json()}catch(t){throw await zt(`Failed to parse JSON response: '${t}'`,"Error"),new Error(`Failed to parse JSON response: '${t}'`)}console.log(i),i.hasOwnProperty("mirador_url")&&window.open(i.mirador_url),i.hasOwnProperty("regions_id")&&(window.location.href=`${s.split("regions/")[0]}regions/${i.regions_id}`)},o,s]}class pe extends St{constructor(t){super(),It(this,t,me,ge,i,{currentRegionId:1,baseUrl:2})}}function he(t,e,n){const r=t.slice();return r[4]=e[n],r}function $e(t){let e,n=t[2].regions,r=[];for(let e=0;e<n.length;e+=1)r[e]=be(he(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=M()},m(t,n){for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,n);S(t,e,n)},p(t,o){if(5&o){let s;for(n=t[2].regions,s=0;s<n.length;s+=1){const i=he(t,n,s);r[s]?r[s].p(i,o):(r[s]=be(i),r[s].c(),r[s].m(e.parentNode,e))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(t){E(r,t),t&&O(e)}}}function we(e){let n,r,o;return{c(){n=R("button"),n.textContent=""+("en"===Lt?"Delete regions record":"Supprimer l'intégralité des régions"),T(n,"class","tag is-danger")},m(t,s){S(t,n,s),r||(o=j(n,"click",e[3]),r=!0)},p:t,d(t){t&&O(n),r=!1,o()}}}function be(t){let e,n,r,o,s=t[4]+"";return{c(){e=R("a"),n=P("Regions #"),r=P(s),T(e,"href",o=""+(t[0]+t[4])),T(e,"class","tag is-dark mr-3 is-rounded")},m(t,o){S(t,e,o),x(e,n),x(e,r)},p(t,n){1&n&&o!==(o=""+(t[0]+t[4]))&&T(e,"href",o)},d(t){t&&O(e)}}}function ve(e){let n;function r(t,e){return t[1]?we:$e}let o=r(e),s=o(e);return{c(){n=R("div"),s.c(),T(n,"class","is-right")},m(t,e){S(t,n,e),s.m(n,null)},p(t,[e]){o===(o=r(t))&&s?s.p(t,e):(s.d(1),s=o(t),s&&(s.c(),s.m(n,null)))},i:t,o:t,d(t){t&&O(n),s.d()}}}function ye(t,e,n){const r=Q("witness");let{baseUrl:o=`${window.location.origin}${window.location.pathname}`}=e,{currentRegionId:s}=e;return t.$$set=t=>{"baseUrl"in t&&n(0,o=t.baseUrl),"currentRegionId"in t&&n(1,s=t.currentRegionId)},[o,s,r,async function(){if(!await zt("en"===Lt?"Are you sure you want to delete this record?":"Voulez-vous vraiment supprimer cet enregistrement?","en"===Lt?"Confirm deletion":"Confirmer la suppression",!0))return;if("number"!=typeof s)throw new Error("Invalid region ID");const t=`${window.location.origin}/regions/${s}/delete`;try{const e=await At((()=>fetch(t,{method:"DELETE",headers:{"X-CSRFToken":_t}})));if(204!==e.status)throw new Error(`Failed to delete regions: '${e.statusText}'`);window.location.href=`${o.split("regions/")[0]}regions/`}catch(t){console.error(t)}}]}class ke extends St{constructor(t){super(),It(this,t,ye,ve,i,{baseUrl:0,currentRegionId:1})}}function xe(t){let e;return{c(){e=L("path"),T(e,"d","M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"),T(e,"class","svelte-h0t5l9")},m(t,n){S(t,e,n)},d(t){t&&O(e)}}}function Ce(t){let e;return{c(){e=L("path"),T(e,"d","M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"),T(e,"class","svelte-h0t5l9")},m(t,n){S(t,e,n)},d(t){t&&O(e)}}}function Ie(e){let n,r="en"===Lt?"Edit":"Modifier";return{c(){n=P(r)},m(t,e){S(t,n,e)},p:t,d(t){t&&O(n)}}}function Se(e){let n,r="en"===Lt?"Validate":"Valider";return{c(){n=P(r)},m(t,e){S(t,n,e)},p:t,d(t){t&&O(n)}}}function Oe(t){let e;return{c(){e=L("path"),T(e,"d","m10.6 16.2l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21z"),T(e,"class","svelte-h0t5l9")},m(t,n){S(t,e,n)},d(t){t&&O(e)}}}function Ee(t){let e;return{c(){e=L("path"),T(e,"d","m10.6 16.2l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21zm0-2h14V5H5zM5 5v14z"),T(e,"class","svelte-h0t5l9")},m(t,n){S(t,e,n)},d(t){t&&O(e)}}}function Re(e){let n,r,s,i,l,c,a,u,d,f,g,m,p,h,$,w,b="en"===Lt?"Reload":"Recharger",v="en"===Lt?"Go to editor":"Aller à l'éditeur",y="en"===Lt?"Delete selected regions":"Supprimer les régions sélectionnées";return{c(){n=R("button"),r=R("i"),s=_(),i=P(b),l=_(),c=R("a"),a=R("i"),u=_(),d=P(v),f=_(),g=R("button"),m=R("i"),p=_(),h=P(y),T(r,"class","fa-solid fa-rotate-right"),T(n,"class","tag is-link is-light is-rounded mr-3"),T(a,"class","fa-solid fa-edit"),T(c,"class","tag is-link is-rounded mr-3"),T(c,"href",Vt(e[5])),T(c,"target","_blank"),T(m,"class","fa-solid fa-trash"),T(g,"class","tag is-danger is-rounded")},m(t,o){S(t,n,o),x(n,r),x(n,s),x(n,i),S(t,l,o),S(t,c,o),x(c,a),x(c,u),x(c,d),S(t,f,o),S(t,g,o),x(g,m),x(g,p),x(g,h),$||(w=[j(n,"click",e[15]),j(g,"click",e[7])],$=!0)},p:t,d(t){t&&O(n),t&&O(l),t&&O(c),t&&O(f),t&&O(g),$=!1,o(w)}}}function Le(e){let n,r,s,i,l,c,a,u,d,f,g,m,p,h,$,w,b,v,y,k,C,I="en"===Lt?"Download":"Télécharger";function E(t,e){return t[1]?Ce:xe}let M=E(e),N=M(e);function q(t,e){return t[1]?Se:Ie}let A=q(e),U=A(e);function V(t,e){return t[0]?Ee:Oe}let z=V(e),H=z(e),B=e[1]&&Re(e);return{c(){n=R("div"),r=R("button"),s=L("svg"),N.c(),i=_(),U.c(),c=_(),a=R("button"),u=L("svg"),H.c(),d=_(),f=R("i"),g=_(),m=R("span"),m.textContent=""+("en"===Lt?"Select all":"Tout sélectionner"),p=_(),h=R("button"),$=R("i"),w=_(),b=P(I),v=_(),y=R("div"),B&&B.c(),T(s,"xmlns","http://www.w3.org/2000/svg"),T(s,"viewBox","0 0 384 512"),T(s,"class","pr-3 svelte-h0t5l9"),T(r,"class",l="button "+(e[1]?"is-success":"is-link")+" mr-3"),T(u,"xmlns","http://www.w3.org/2000/svg"),T(u,"viewBox","0 0 448 512"),T(u,"class","svelte-h0t5l9"),T(f,"class","fa-solid fa-square-check"),T(m,"id","all-selection"),T(a,"class","button is-link is-light mr-3"),T($,"class","fa-solid fa-download"),T(h,"class","button is-link is-light"),T(n,"class","is-left mb-3"),T(y,"class","edit-action is-left svelte-h0t5l9")},m(t,o){S(t,n,o),x(n,r),x(r,s),N.m(s,null),x(r,i),U.m(r,null),x(n,c),x(n,a),x(a,u),H.m(u,null),x(a,d),x(a,f),x(a,g),x(a,m),x(n,p),x(n,h),x(h,$),x(h,w),x(h,b),S(t,v,o),S(t,y,o),B&&B.m(y,null),k||(C=[j(r,"click",e[14]),j(a,"click",e[8]),j(h,"click",e[9])],k=!0)},p(t,[e]){M!==(M=E(t))&&(N.d(1),N=M(t),N&&(N.c(),N.m(s,null))),A===(A=q(t))&&U?U.p(t,e):(U.d(1),U=A(t),U&&(U.c(),U.m(r,null))),2&e&&l!==(l="button "+(t[1]?"is-success":"is-link")+" mr-3")&&T(r,"class",l),z!==(z=V(t))&&(H.d(1),H=z(t),H&&(H.c(),H.m(u,null))),t[1]?B?B.p(t,e):(B=Re(t),B.c(),B.m(y,null)):B&&(B.d(1),B=null)},i:t,o:t,d(t){t&&O(n),N.d(),U.d(),H.d(),t&&O(v),t&&O(y),B&&B.d(),k=!1,o(C)}}}async function Pe(t){const e=SAS_APP_URL.replace("https","http"),n=`${SAS_APP_URL}/annotation/destroy?uri=${e}/annotation/${t}`,r=await fetch(n,{method:"DELETE"});if(204!==r.status)throw new Error(`Failed to delete ${n} due to ${r.status}: '${r.statusText}'`)}function _e(t,e,n){let r,o,s,i,l,c,a;const{selected:u,nbSelected:f}=Ht;d(t,u,(t=>n(11,l=t))),d(t,f,(t=>n(13,a=t)));const{allRegions:g}=Bt;d(t,g,(t=>n(12,c=t)));const m=Q("manifest"),p=Q("isValidated");function h(){n(1,o=!o)}return t.$$.update=()=>{8192&t.$$.dirty&&n(10,r=a(!0)),2048&t.$$.dirty&&(s=l(!0)),5120&t.$$.dirty&&n(0,i=r>=Object.keys(c).length)},n(1,o=!p),[i,o,u,f,g,m,h,async function(){if(await zt("en"===Lt?"Are you sure you want to delete regions?":"Voulez-vous vraiment supprimer les régions?","en"===Lt?"Confirm deletion":"Confirmer la suppression",!0))for(const t of Object.keys(s))try{if(!c.hasOwnProperty(t))continue;await Pe(t),Bt.remove(t),Ht.remove(t,jt)}catch(e){await zt(`Failed to delete region ${t}: ${e.message}`,"Error")}},function(){i?Ht.removeAll(Object.keys(c),jt):Ht.addAll(Object.values(c))},async function(){const t=Object.values(l(!0)).map((t=>t.ref)),e=await At((()=>fetch(`${window.location.origin}/regions/export`,{method:"POST",headers:{"X-CSRFToken":_t},body:JSON.stringify({regionsRef:t})})));!function(t,e){const n=window.URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`${e}`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(n),document.body.removeChild(r)}(await e.blob(),"regions.zip")},r,l,c,a,()=>h(),()=>location.reload()]}class Me extends St{constructor(t){super(),It(this,t,_e,Le,i,{})}}const je=function(){const t=`${window.location.origin}${window.location.pathname}`,e=Et(1),n=Et({}),r=Et(JSON.parse(localStorage.getItem("selectedRegions"))||{}),o=Et([]),s=Et([]),i=Et({}),l=(async()=>{const e=await fetch(`${t}similar-regions`).then((t=>t.json())).then((t=>(n.set(t),t))).catch((t=>console.error("Error:",t))),r=await fetch(`${t}query-images`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":_t},body:JSON.stringify({regionsRefs:Object.keys(e)})}).then((t=>t.json())).then((t=>0!==t.length&&t?(o.set(t),t):null)).catch((t=>console.error("Error:",t)));return g(c()),r})(),c=()=>{if("undefined"!=typeof window){const t=parseInt(new URLSearchParams(window.location.search).get("sp"));if(!isNaN(t))return e.set(t),t}return e.set(1),1},a=Rt(e,(t=>(async()=>function(t){const e=50*(t-1),n=e+50,r=u(o).slice(e,n);return s.set(r),r}(t))())),d=Rt(r,(t=>(async()=>await f(t))())),f=async e=>{const n=await fetch(`${t}similarity-page`,{method:"POST",body:JSON.stringify({regionsIds:Object.values(e).map((t=>t.id)),pageImgs:u(s)}),headers:{"Content-Type":"application/json","X-CSRFToken":_t}}),r=await n.json();return i.set(r),r};function g(t){if(e.set(t),"undefined"!=typeof window){const e=new URL(window.location.href);e.searchParams.set("sp",t),window.history.pushState({},"",e)}}function m(t){localStorage.setItem("selectedRegions",JSON.stringify(t))}const p=Rt(r,(t=>e=>t.hasOwnProperty(e)));return{currentPage:e,comparedRegions:n,qImgs:o,pageQImgs:s,pageSImgs:i,selectedRegions:r,fetchSimilarity:l,setPageQImgs:a,setPageSImgs:d,getSimilarImgs:function(t){const e=u(i);return e.hasOwnProperty(t)?e[t]:[]},getRegionsInfo:function(t){const e=u(n),r=Object.keys(e).filter((e=>e.startsWith(t)));return 1!==r.length?{title:"Error"}:e[r[0]]},handlePageUpdate:g,unselect:function(t){r.update((e=>{const n={...e};return delete n[t],m(n),n}))},select:function(t){r.update((e=>{const n={...e,[t.ref]:t};return m(n),n}))},isSelected:p}}();function Ne(t){let e,n,r;const o=t[1].default,s=f(o,t,t[0],null);return{c(){e=R("table"),n=R("tbody"),s&&s.c(),T(e,"class","table is-fullwidth")},m(t,o){S(t,e,o),x(e,n),s&&s.m(n,null),r=!0},p(t,[e]){s&&s.p&&(!r||1&e)&&p(s,o,t,t[0],r?m(o,t[0],e,null):h(t[0]),null)},i(t){r||(gt(s,t),r=!0)},o(t){mt(s,t),r=!1},d(t){t&&O(e),s&&s.d(t)}}}function Te(t,e,n){let{$$slots:r={},$$scope:o}=e;return t.$$set=t=>{"$$scope"in t&&n(0,o=t.$$scope)},[o,r]}class qe extends St{constructor(t){super(),It(this,t,Te,Ne,i,{})}}function Ae(t){let e,n,r,o,s,i,l=t[1]-1>1&&Ue(t);return{c(){e=R("li"),n=R("a"),n.textContent="1",r=_(),l&&l.c(),o=M(),T(n,"class","pagination-link"),T(n,"href",null)},m(c,a){S(c,e,a),x(e,n),S(c,r,a),l&&l.m(c,a),S(c,o,a),s||(i=j(n,"click",N(t[6])),s=!0)},p(t,e){t[1]-1>1?l?l.p(t,e):(l=Ue(t),l.c(),l.m(o.parentNode,o)):l&&(l.d(1),l=null)},d(t){t&&O(e),t&&O(r),l&&l.d(t),t&&O(o),s=!1,i()}}}function Ue(t){let e,n,r,o,s,i,l,c=t[1]-1+"";return{c(){e=R("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>',n=_(),r=R("li"),o=R("a"),s=P(c),T(o,"class","pagination-link"),T(o,"href",null)},m(c,a){S(c,e,a),S(c,n,a),S(c,r,a),x(r,o),x(o,s),i||(l=j(o,"click",N(t[7])),i=!0)},p(t,e){2&e&&c!==(c=t[1]-1+"")&&q(s,c)},d(t){t&&O(e),t&&O(n),t&&O(r),i=!1,l()}}}function Ve(t){let e,n,r,o,s,i=t[1]+1<t[3]&&ze(t);return{c(){i&&i.c(),e=_(),n=R("li"),r=R("a"),r.textContent=`${t[3]}`,T(r,"class","pagination-link"),T(r,"href",null)},m(l,c){i&&i.m(l,c),S(l,e,c),S(l,n,c),x(n,r),o||(s=j(r,"click",N(t[10])),o=!0)},p(t,n){t[1]+1<t[3]?i?i.p(t,n):(i=ze(t),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},d(t){i&&i.d(t),t&&O(e),t&&O(n),o=!1,s()}}}function ze(t){let e,n,r,o,s,i,l,c=t[1]+1+"";return{c(){e=R("li"),n=R("a"),r=P(c),o=_(),s=R("li"),s.innerHTML='<span class="pagination-ellipsis">…</span>',T(n,"class","pagination-link"),T(n,"href",null)},m(c,a){S(c,e,a),x(e,n),x(n,r),S(c,o,a),S(c,s,a),i||(l=j(n,"click",N(t[9])),i=!0)},p(t,e){2&e&&c!==(c=t[1]+1+"")&&q(r,c)},d(t){t&&O(e),t&&O(o),t&&O(s),i=!1,l()}}}function He(e){let n,r=e[3]>1&&function(t){let e,n,r,o,s,i,l,c,a,u=t[1]>1&&Ae(t),d=t[1]<t[3]&&Ve(t);return{c(){e=R("nav"),n=R("ul"),u&&u.c(),r=_(),o=R("li"),s=R("a"),i=P(t[1]),l=_(),d&&d.c(),T(s,"class","pagination-link is-current"),T(s,"href",null),T(n,"class","pagination-list"),T(e,"class","pagination is-centered"),T(e,"aria-label","pagination")},m(f,g){S(f,e,g),x(e,n),u&&u.m(n,null),x(n,r),x(n,o),x(o,s),x(s,i),x(n,l),d&&d.m(n,null),c||(a=j(s,"click",N(t[8])),c=!0)},p(t,e){t[1]>1?u?u.p(t,e):(u=Ae(t),u.c(),u.m(n,r)):u&&(u.d(1),u=null),2&e&&q(i,t[1]),t[1]<t[3]?d?d.p(t,e):(d=Ve(t),d.c(),d.m(n,null)):d&&(d.d(1),d=null)},d(t){t&&O(e),u&&u.d(),d&&d.d(),c=!1,a()}}}(e);return{c(){r&&r.c(),n=M()},m(t,e){r&&r.m(t,e),S(t,n,e)},p(t,[e]){t[3]>1&&r.p(t,e)},i:t,o:t,d(t){r&&r.d(t),t&&O(n)}}}function Be(t,e,n){let r,{store:o}=e;const{currentPage:s}=o;d(t,s,(t=>n(1,r=t)));let{nbOfItems:i}=e,{pageLength:l=50}=e;const c=Math.ceil(i/l);return t.$$set=t=>{"store"in t&&n(0,o=t.store),"nbOfItems"in t&&n(4,i=t.nbOfItems),"pageLength"in t&&n(5,l=t.pageLength)},[o,r,s,c,i,l,()=>o.handlePageUpdate(1),()=>o.handlePageUpdate(r-1),()=>o.handlePageUpdate(r),()=>o.handlePageUpdate(r+1),()=>o.handlePageUpdate(c)]}class Fe extends St{constructor(t){super(),It(this,t,Be,He,i,{store:0,nbOfItems:4,pageLength:5})}}function De(t){let e,n,r,o,s,i,l,a,u,d,g,$,w,b,v,y=parseInt(t[1])+"";const k=t[4].default,C=f(k,t,t[3],null);return{c(){e=R("tr"),n=R("th"),r=R("div"),o=R("img"),i=_(),l=R("a"),a=R("i"),u=P("\n                Page "),d=P(y),g=_(),$=R("td"),w=R("div"),b=R("div"),C&&C.c(),c(o.src,s=Ut(t[0],"full","250,"))||T(o,"src",s),T(o,"alt","Query region"),T(o,"class","mb-3 card"),T(a,"class","fa-solid fa-pen-to-square"),T(l,"class","tag px-2 py-1 is-rounded is-hoverable"),T(l,"href",Vt(t[2],parseInt(t[1]))),T(l,"target","_blank"),T(r,"class","content-wrapper py-5"),T(n,"class","is-3 center-flex is-narrow"),A(n,"width","260px"),T(b,"class","grid is-gap-2"),T(w,"class","fixed-grid has-5-cols"),T($,"class","p-5 is-fullwidth")},m(t,s){S(t,e,s),x(e,n),x(n,r),x(r,o),x(r,i),x(r,l),x(l,a),x(l,u),x(l,d),x(e,g),x(e,$),x($,w),x(w,b),C&&C.m(b,null),v=!0},p(t,[e]){(!v||1&e&&!c(o.src,s=Ut(t[0],"full","250,")))&&T(o,"src",s),C&&C.p&&(!v||8&e)&&p(C,k,t,t[3],v?m(k,t[3],e,null):h(t[3]),null)},i(t){v||(gt(C,t),v=!0)},o(t){mt(C,t),v=!1},d(t){t&&O(e),C&&C.d(t)}}}function Je(t,e,n){let{$$slots:r={},$$scope:o}=e,{qImg:s}=e;const[i,l,c,a]=s.split(".")[0].split("_"),u=Q("manifest");return t.$$set=t=>{"qImg"in t&&n(0,s=t.qImg),"$$scope"in t&&n(3,o=t.$$scope)},[s,c,u,o,r]}class Ze extends St{constructor(t){super(),It(this,t,Je,De,i,{qImg:0})}}const Xe='<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 54 54.5">\n                <rect x="30" y="30.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n                <rect x="21" y="21" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n                <rect x="30" y="30.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>\n            </svg>',Qe='<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 55 55.5">\n                <rect x="32" y="32.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" pointer-events="all"/>\n                <rect x="21" y="20.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" pointer-events="all"/>\n                <path d="M 32 41.43 L 41 32.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 32 50 L 50 32.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 60 76 L 77 58" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 68.3 76.29 L 77 67" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 32 59 L 59 32" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 32 68 L 68 32" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 33 76 L 77 32" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 51 76 L 77 49" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 41 77 L 77 41" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n            </svg>',Ke='<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 56 56.5">\n                <rect x="34" y="34.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>\n                <rect x="21" y="20.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n            </svg>',Ge='<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 49.5 49.5">\n                <rect x="21" y="20.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n                <path d="M 22.67 74.55 L 75 22" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 74.37 74.05 L 22.72 22.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n            </svg>',We='<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 49.5 49.5">\n                <rect x="21" y="20.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n                <path d="M 28.69 75.28 C 29.25 64.15 38.08 55.28 48.86 55.28 C 52.5 55.28 56.07 56.3 59.18 58.25 C 64.96 61.85 68.66 68.3 69.02 75.28 Z M 37.85 41.48 C 37.85 35.37 42.79 30.39 48.86 30.39 C 54.92 30.39 59.86 35.37 59.86 41.48 C 59.86 47.59 54.92 52.56 48.86 52.56 C 42.79 52.56 37.85 47.59 37.85 41.48 Z M 60.37 56.34 C 58.43 55.13 56.32 54.25 54.13 53.7 C 58.82 51.64 62.1 46.94 62.1 41.48 C 62.1 34.13 56.16 28.15 48.86 28.15 C 41.55 28.15 35.61 34.13 35.61 41.48 C 35.61 46.95 38.9 51.66 43.6 53.71 C 33.76 56.18 26.41 65.4 26.41 76.4 C 26.41 77.02 26.92 77.52 27.54 77.52 L 70.17 77.52 C 70.79 77.52 71.3 77.02 71.3 76.4 C 71.3 68.23 67.11 60.54 60.37 56.34 Z" fill="currentColor" stroke="none"/>\n            </svg>',Ye="en"===Lt?"Overall visual match":"Correspondance visuelle globale",tn="en"===Lt?"Visual match on part of the image":"Correspondance visuelle sur une partie de l'image",en="en"===Lt?"Semantic and non visual match":"Correspondance sémantique et non visuelle",nn="en"===Lt?"None of the above":"Aucune de ces catégories",rn="en"===Lt?"User specific category":"Correspondance spécifique à l'utilisateur",on="en"===Lt?"Show 'no match' regions":"Afficher les régions sans correspondance",sn="en"===Lt?"Hide 'no match' regions":"Cacher les régions sans correspondance";function ln(t){let e,n,r,s,i,l,a,u,d,f,g,m,p,h,$,w,b,v,y,k,C,I,E,L,M,N,A,V,z,H,B,F,D,J=je.getRegionsInfo(`${t[3]}_${t[4]}`).title+"",Z=parseInt(t[5])+"";return{c(){e=R("div"),n=R("figure"),r=R("img"),i=_(),l=R("div"),a=R("span"),u=P(J),d=_(),f=R("br"),g=P("\n                Page "),m=P(Z),p=_(),h=R("br"),$=_(),w=R("b"),b=P("Score: "),v=P(t[0]),y=_(),k=R("div"),C=R("span"),I=_(),E=R("span"),L=_(),M=R("span"),N=_(),A=R("span"),V=_(),z=R("span"),c(r.src,s=Ut(t[7],t[6],",256"))||T(r,"src",s),T(r,"alt","Similar region"),T(r,"class","svelte-xyy17k"),T(a,"class","overlay-desc"),T(l,"class","overlay is-center svelte-xyy17k"),T(n,"class","image region-image card svelte-xyy17k"),T(n,"tabindex","-1"),T(C,"class","tag is-hoverable pl-5 pr-4 py-4"),T(C,"title","en"===Lt?"Exact match":"Correspondance exacte"),U(C,"is-link",1===t[2]),T(E,"class","tag is-hoverable p-4"),T(E,"title","en"===Lt?"Partial match":"Correspondance partielle"),U(E,"is-link",2===t[2]),T(M,"class","tag is-hoverable p-4"),T(M,"title","en"===Lt?"Semantic match":"Correspondance sémantique"),U(M,"is-link",3===t[2]),T(A,"class","tag is-hoverable p-4"),T(A,"title","en"===Lt?"No match":"Aucune correspondance"),U(A,"is-link",4===t[2]),T(z,"class","tag is-hoverable pl-4 pr-5 py-4"),T(z,"title","en"===Lt?"User match":"Correspondance utilisateur"),U(z,"is-link",t[1]),T(k,"class","tags has-addons is-dark is-center"),T(e,"class","region is-center svelte-xyy17k")},m(o,s){S(o,e,s),x(e,n),x(n,r),x(n,i),x(n,l),x(l,a),x(a,u),x(a,d),x(a,f),x(a,g),x(a,m),x(a,p),x(a,h),x(a,$),x(a,w),x(w,b),x(w,v),x(e,y),x(e,k),x(k,C),C.innerHTML=Xe,x(k,I),x(k,E),E.innerHTML=Qe,x(k,L),x(k,M),M.innerHTML=Ke,x(k,N),x(k,A),A.innerHTML=Ge,x(k,V),x(k,z),z.innerHTML=We,B=!0,F||(D=[j(C,"click",t[12]),j(C,"keyup",null),j(E,"click",t[13]),j(E,"keyup",null),j(M,"click",t[14]),j(M,"keyup",null),j(A,"click",t[15]),j(A,"keyup",null),j(z,"click",t[16]),j(z,"keyup",null)],F=!0)},p(t,[e]){(!B||1&e)&&q(v,t[0]),(!B||4&e)&&U(C,"is-link",1===t[2]),(!B||4&e)&&U(E,"is-link",2===t[2]),(!B||4&e)&&U(M,"is-link",3===t[2]),(!B||4&e)&&U(A,"is-link",4===t[2]),(!B||2&e)&&U(z,"is-link",t[1])},i(t){B||(nt((()=>{B&&(H||(H=ht(e,Dt,{duration:500},!0)),H.run(1))})),B=!0)},o(t){H||(H=ht(e,Dt,{duration:500},!1)),H.run(0),B=!1},d(t){t&&O(e),t&&H&&H.end(),F=!1,o(D)}}}function cn(t,e,n){let r,o;const s=window.location.origin;let{qImg:i}=e,{sImg:l}=e,{score:c=0}=e,{regionsCategory:a=null}=e;const[u,d,f,g]=l.split(".")[0].split("_"),m=`${u}_${d}_${f}`;function p(t){5===t?n(1,o=!o):n(2,r=r===t?null:t)}async function h(t){const[e,n,c,a]=i.split(".")[0].split("_"),[u,d,f,g]=l.split(".")[0].split("_");p(t);try{(await fetch(`${s}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":_t},body:JSON.stringify({img_1:i,img_2:l,regions_ref_1:`${e}_${n}_${c}`,regions_ref_2:`${u}_${d}_${f}`,category:t<=4?r:null,category_x:5===t?o:null})})).ok||(console.error("Error: Network response was not ok"),p(t))}catch(e){console.error("Error:",e),p(t)}}return t.$$set=t=>{"qImg"in t&&n(9,i=t.qImg),"sImg"in t&&n(10,l=t.sImg),"score"in t&&n(0,c=t.score),"regionsCategory"in t&&n(11,a=t.regionsCategory)},t.$$.update=()=>{2048&t.$$.dirty&&n(2,r=a?a.category:null),2048&t.$$.dirty&&n(1,o=a&&a.category_x?.includes(Number(Pt))||!1)},[c,o,r,u,d,f,g,m,h,i,l,a,()=>h(1),()=>h(2),()=>h(3),()=>h(4),()=>h(5)]}class an extends St{constructor(t){super(),It(this,t,cn,ln,i,{qImg:9,sImg:10,score:0,regionsCategory:11})}}function un(t){t[6]=t[8].similarImgs,t[7]=t[8].categories}function dn(t,e,n){const r=t.slice();return r[9]=e[n][0],r[10]=e[n][1],r}function fn(e){let n,r,o,s=e[13]+"";return{c(){n=R("div"),r=P("Error when retrieving similar regions: "),o=P(s),T(n,"class","faded is-center")},m(t,e){S(t,n,e),x(n,r),x(n,o)},p:t,i:t,o:t,d(t){t&&O(n)}}}function gn(t){let e,n;un(t);let r=t[6],o=[];for(let e=0;e<r.length;e+=1)o[e]=mn(dn(t,r,e));const s=t=>mt(o[t],1,1,(()=>{o[t]=null}));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=M()},m(t,r){for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,r);S(t,e,r),n=!0},p(t,n){if(un(t),5&n){let i;for(r=t[6],i=0;i<r.length;i+=1){const s=dn(t,r,i);o[i]?(o[i].p(s,n),gt(o[i],1)):(o[i]=mn(s),o[i].c(),gt(o[i],1),o[i].m(e.parentNode,e))}for(dt(),i=r.length;i<o.length;i+=1)s(i);ft()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)gt(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)mt(o[t]);n=!1},d(t){E(o,t),t&&O(e)}}}function mn(t){let e,n;return e=new an({props:{qImg:t[0],sImg:t[9],score:t[10],regionsCategory:t[7][`${t[0]}|${t[9]}`]}}),{c(){yt(e.$$.fragment)},m(t,r){kt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.qImg=t[0]),1&n&&(r.regionsCategory=t[7][`${t[0]}|${t[9]}`]),e.$set(r)},i(t){n||(gt(e.$$.fragment,t),n=!0)},o(t){mt(e.$$.fragment,t),n=!1},d(t){xt(e,t)}}}function pn(e){let n;return{c(){n=R("div"),n.textContent=""+("en"===Lt?"Retrieving similar regions...":"Récupération des régions similaires..."),T(n,"class","faded is-center")},m(t,e){S(t,n,e)},p:t,i:t,o:t,d(t){t&&O(n)}}}function hn(t){let e,n,r={ctx:t,current:null,token:null,hasCatch:!0,pending:pn,then:gn,catch:fn,value:8,error:13,blocks:[,,,]};return $t(t[2],r),{c(){e=M(),r.block.c()},m(t,o){S(t,e,o),r.block.m(t,r.anchor=o),r.mount=()=>e.parentNode,r.anchor=e,n=!0},p(e,[n]){wt(r,t=e,n)},i(t){n||(gt(r.block),n=!0)},o(t){for(let t=0;t<3;t+=1){mt(r.blocks[t])}n=!1},d(t){t&&O(e),r.block.d(t),r.token=null,r=null}}}function $n(t,e,n){let r;const{setPageSImgs:o}=je;d(t,o,(t=>n(3,r=t)));let{qImg:s}=e;const i=window.location.origin;let l=async function(t){await r;const e=je.getSimilarImgs(t),n=e.map((([e,n])=>`${t}|${e}`)),o=await fetch(`${i}/get-categories`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":CSRF_TOKEN},body:JSON.stringify({img_pairs:n})});if(!o.ok)throw new Error("Failed to fetch categories");return{similarImgs:e,categories:await o.json()}}(s);return t.$$set=t=>{"qImg"in t&&n(0,s=t.qImg)},[s,o,l]}class wn extends St{constructor(t){super(),It(this,t,$n,hn,i,{qImg:0})}}function bn(t,e,n){const r=t.slice();return r[7]=e[n],r}function vn(e){let n,r,o,s=e[10]+"";return{c(){n=R("tr"),r=P("Error when retrieving similar regions: "),o=P(s)},m(t,e){S(t,n,e),x(n,r),x(n,o)},p(t,e){2&e&&s!==(s=t[10]+"")&&q(o,s)},i:t,o:t,d(t){t&&O(n)}}}function yn(t){let e,n,r=[],o=new Map,s=t[2];const i=t=>t[7].id;for(let e=0;e<s.length;e+=1){let n=bn(t,s,e),l=i(n);o.set(l,r[e]=Cn(l,n))}let l=null;return s.length||(l=kn()),{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=M(),l&&l.c()},m(t,o){for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,o);S(t,e,o),l&&l.m(t,o),n=!0},p(t,n){4&n&&(s=t[2],dt(),r=vt(r,n,i,1,t,s,o,e.parentNode,bt,Cn,e,bn),ft(),!s.length&&l?l.p(t,n):s.length?l&&(l.d(1),l=null):(l=kn(),l.c(),l.m(e.parentNode,e)))},i(t){if(!n){for(let t=0;t<s.length;t+=1)gt(r[t]);n=!0}},o(t){for(let t=0;t<r.length;t+=1)mt(r[t]);n=!1},d(t){for(let e=0;e<r.length;e+=1)r[e].d(t);t&&O(e),l&&l.d(t)}}}function kn(e){let n,r;return{c(){n=R("tr"),n.textContent=""+("en"===Lt?"No similarity":"Pas de similarités"),r=_(),T(n,"class","faded is-center")},m(t,e){S(t,n,e),S(t,r,e)},p:t,d(t){t&&O(n),t&&O(r)}}}function xn(t){let e,n,r;return e=new wn({props:{qImg:t[7]}}),{c(){yt(e.$$.fragment),n=_()},m(t,o){kt(e,t,o),S(t,n,o),r=!0},p(t,n){const r={};4&n&&(r.qImg=t[7]),e.$set(r)},i(t){r||(gt(e.$$.fragment,t),r=!0)},o(t){mt(e.$$.fragment,t),r=!1},d(t){xt(e,t),t&&O(n)}}}function Cn(t,e){let n,r,o;return r=new Ze({props:{qImg:e[7],$$slots:{default:[xn]},$$scope:{ctx:e}}}),{key:t,first:null,c(){n=M(),yt(r.$$.fragment),this.first=n},m(t,e){S(t,n,e),kt(r,t,e),o=!0},p(t,n){e=t;const o={};4&n&&(o.qImg=e[7]),2052&n&&(o.$$scope={dirty:n,ctx:e}),r.$set(o)},i(t){o||(gt(r.$$.fragment,t),o=!0)},o(t){mt(r.$$.fragment,t),o=!1},d(t){t&&O(n),xt(r,t)}}}function In(e){let n;return{c(){n=R("tr"),n.textContent=""+("en"===Lt?"Retrieving similarity page...":"Récupération la page de similarité..."),T(n,"class","faded is-center")},m(t,e){S(t,n,e)},p:t,i:t,o:t,d(t){t&&O(n)}}}function Sn(t){let e,n,r,o={ctx:t,current:null,token:null,hasCatch:!0,pending:In,then:yn,catch:vn,value:6,error:10,blocks:[,,,]};return $t(n=t[1],o),{c(){e=M(),o.block.c()},m(t,n){S(t,e,n),o.block.m(t,o.anchor=n),o.mount=()=>e.parentNode,o.anchor=e,r=!0},p(e,r){t=e,o.ctx=t,2&r&&n!==(n=t[1])&&$t(n,o)||wt(o,t,r)},i(t){r||(gt(o.block),r=!0)},o(t){for(let t=0;t<3;t+=1){mt(o.blocks[t])}r=!1},d(t){t&&O(e),o.block.d(t),o.token=null,o=null}}}function On(t){let e,n,r,o,s,i;return e=new Fe({props:{store:je,nbOfItems:t[0].length}}),r=new qe({props:{$$slots:{default:[Sn]},$$scope:{ctx:t}}}),s=new Fe({props:{store:je,nbOfItems:t[0].length}}),{c(){yt(e.$$.fragment),n=_(),yt(r.$$.fragment),o=_(),yt(s.$$.fragment)},m(t,l){kt(e,t,l),S(t,n,l),kt(r,t,l),S(t,o,l),kt(s,t,l),i=!0},p(t,[n]){const o={};1&n&&(o.nbOfItems=t[0].length),e.$set(o);const i={};2054&n&&(i.$$scope={dirty:n,ctx:t}),r.$set(i);const l={};1&n&&(l.nbOfItems=t[0].length),s.$set(l)},i(t){i||(gt(e.$$.fragment,t),gt(r.$$.fragment,t),gt(s.$$.fragment,t),i=!0)},o(t){mt(e.$$.fragment,t),mt(r.$$.fragment,t),mt(s.$$.fragment,t),i=!1},d(t){xt(e,t),t&&O(n),xt(r,t),t&&O(o),xt(s,t)}}}function En(t,e,n){let r,o,s;const{qImgs:i,pageQImgs:l,setPageQImgs:c}=je;return d(t,i,(t=>n(0,r=t))),d(t,l,(t=>n(2,s=t))),d(t,c,(t=>n(1,o=t))),[r,o,s,i,l,c]}class Rn extends St{constructor(t){super(),It(this,t,En,On,i,{})}}function Ln(t,e,n){const r=t.slice();return r[8]=e[n][0],r[9]=e[n][1],r}function Pn(t){let e;return{c(){e=R("span"),e.textContent="current",T(e,"class","tag is-dark svelte-503e8j")},m(t,n){S(t,e,n)},d(t){t&&O(e)}}}function _n(t){let e,n,r,s,i,l,c,a,u=t[5](t[8]),d=t[9].title+"",f=u&&Pn();function g(){return t[6](t[9])}return{c(){e=R("div"),f&&f.c(),n=_(),r=R("span"),s=P(d),l=_(),T(r,"class",i="tag is-small "+(t[0](t[8])?"is-link":"is-contrasted")+" svelte-503e8j"),T(e,"class","tags has-addons mb-0 is-hoverable")},m(t,o){S(t,e,o),f&&f.m(e,null),x(e,n),x(e,r),x(r,s),x(e,l),c||(a=[j(e,"click",g),j(e,"keyup",null)],c=!0)},p(o,l){t=o,2&l&&(u=t[5](t[8])),u?f||(f=Pn(),f.c(),f.m(e,n)):f&&(f.d(1),f=null),2&l&&d!==(d=t[9].title+"")&&q(s,d),3&l&&i!==(i="tag is-small "+(t[0](t[8])?"is-link":"is-contrasted")+" svelte-503e8j")&&T(r,"class",i)},d(t){t&&O(e),f&&f.d(),c=!1,o(a)}}}function Mn(e){let n,r=Object.entries(e[1]),o=[];for(let t=0;t<r.length;t+=1)o[t]=_n(Ln(e,r,t));return{c(){n=R("div");for(let t=0;t<o.length;t+=1)o[t].c();T(n,"class","field is-grouped is-grouped-multiline")},m(t,e){S(t,n,e);for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(n,null)},p(t,[e]){if(51&e){let s;for(r=Object.entries(t[1]),s=0;s<r.length;s+=1){const i=Ln(t,r,s);o[s]?o[s].p(i,e):(o[s]=_n(i),o[s].c(),o[s].m(n,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=r.length}},i:t,o:t,d(t){t&&O(n),E(o,t)}}}function jn(t,e,n){let r,o;const{comparedRegions:s,isSelected:i}=je;d(t,s,(t=>n(1,o=t))),d(t,i,(t=>n(0,r=t)));const l=Q("imgPrefix");function c(t){r(t.ref)?je.unselect(t.ref):je.select(t)}return[r,o,s,i,c,function(t){return t.startsWith(l)},t=>c(t)]}class Nn extends St{constructor(t){super(),It(this,t,jn,Mn,i,{})}}function Tn(t,e,n){const r=t.slice();return r[6]=e[n],r}function qn(t){let e,n,r,o,s,i=t[6].title+"";return{c(){e=R("div"),n=R("span"),r=P(i),T(n,"class","label svelte-32vx2e"),T(e,"class","label-container px-2 py-1 svelte-32vx2e")},m(t,o){S(t,e,o),x(e,n),x(n,r),s=!0},p(t,e){(!s||2&e)&&i!==(i=t[6].title+"")&&q(r,i)},i(t){s||(nt((()=>{s&&(o||(o=ht(e,Jt,{x:40,duration:300},!0)),o.run(1))})),s=!0)},o(t){o||(o=ht(e,Jt,{x:40,duration:300},!1)),o.run(0),s=!1},d(t){t&&O(e),t&&o&&o.end()}}}function An(t){let e,n,r,i,l,c,a,u=t[6].svg+"",d=t[0]===t[6].id&&qn(t);function f(){return t[4](t[6])}return{c(){e=R("div"),n=R("span"),r=_(),d&&d.c(),i=_(),T(n,"class","tool-icon is-hoverable p-1 svelte-32vx2e"),T(e,"class","toolbar-item svelte-32vx2e")},m(o,g){S(o,e,g),x(e,n),n.innerHTML=u,x(e,r),d&&d.m(e,null),x(e,i),l=!0,c||(a=[j(e,"mouseenter",f),j(e,"mouseleave",t[5]),j(e,"click",(function(){s(6===t[6].id?t[2]():null)&&(6===t[6].id?t[2]():null).apply(this,arguments)})),j(e,"keyup",null)],c=!0)},p(r,o){t=r,(!l||2&o)&&u!==(u=t[6].svg+"")&&(n.innerHTML=u),t[0]===t[6].id?d?(d.p(t,o),3&o&&gt(d,1)):(d=qn(t),d.c(),gt(d,1),d.m(e,i)):d&&(dt(),mt(d,1,1,(()=>{d=null})),ft())},i(t){l||(gt(d),l=!0)},o(t){mt(d),l=!1},d(t){t&&O(e),d&&d.d(),c=!1,o(a)}}}function Un(t){let e,n,r=t[1],o=[];for(let e=0;e<r.length;e+=1)o[e]=An(Tn(t,r,e));const s=t=>mt(o[t],1,1,(()=>{o[t]=null}));return{c(){e=R("div");for(let t=0;t<o.length;t+=1)o[t].c();T(e,"class","toolbar is-contrasted pb-3 pl-3 pr-4 svelte-32vx2e")},m(t,r){S(t,e,r);for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,null);n=!0},p(t,[n]){if(7&n){let i;for(r=t[1],i=0;i<r.length;i+=1){const s=Tn(t,r,i);o[i]?(o[i].p(s,n),gt(o[i],1)):(o[i]=An(s),o[i].c(),gt(o[i],1),o[i].m(e,null))}for(dt(),i=r.length;i<o.length;i+=1)s(i);ft()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)gt(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)mt(o[t]);n=!1},d(t){t&&O(e),E(o,t)}}}function Vn(t,e,n){let r,o,s=null;return t.$$.update=()=>{8&t.$$.dirty&&n(1,o=[{id:1,title:Ye,svg:Xe},{id:2,title:tn,svg:Qe},{id:3,title:en,svg:Ke},{id:4,title:nn,svg:Ge},{id:5,title:rn,svg:We},{id:6,title:r?sn:on,svg:r?'<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 48 48">\n                <path d="M 74.03 46.4 C 68.2 37.48 58.41 32.15 47.86 32.15 C 37.3 32.15 27.51 37.48 21.68 46.4 L 21.38 46.86 L 21.68 47.32 C 27.51 56.24 37.3 61.57 47.86 61.57 C 58.41 61.57 68.2 56.24 74.03 47.31 L 74.33 46.86 L 74.03 46.4 Z M 24.57 46.86 C 28.87 40.84 35.18 36.8 42.25 35.37 C 41.07 35.98 39.97 36.77 39.01 37.74 C 36.61 40.17 35.28 43.4 35.28 46.82 C 35.28 50.26 36.61 53.49 39.01 55.91 C 40.04 56.94 41.2 57.76 42.46 58.38 C 35.3 57 28.92 52.93 24.57 46.86 Z M 47.99 54.79 C 43.66 54.79 40.13 51.23 40.13 46.85 C 40.13 44.74 40.95 42.75 42.43 41.25 C 43.91 39.75 45.89 38.92 47.99 38.92 C 50.09 38.92 52.06 39.75 53.55 41.25 C 55.03 42.75 55.85 44.74 55.85 46.85 C 55.85 48.97 55.03 50.97 53.55 52.47 C 52.06 53.96 50.08 54.79 47.99 54.79 Z M 53.76 58.29 C 54.95 57.68 56.04 56.89 57.01 55.92 C 59.41 53.49 60.73 50.26 60.73 46.83 C 60.73 41.9 57.97 37.62 53.93 35.47 C 60.81 36.96 66.93 40.98 71.13 46.86 C 66.9 52.79 60.71 56.82 53.76 58.29 Z" fill="currentColor" stroke="none"/>\n                <path d="M 45.26 47.3 C 46.69 47.3 47.86 46.13 47.86 44.68 C 47.86 43.23 46.69 42.05 45.26 42.05 C 43.83 42.05 42.67 43.23 42.67 44.68 C 42.67 46.13 43.83 47.3 45.26 47.3" fill="currentColor" stroke="none"/>\n                <ellipse cx="47.86" cy="46.86" rx="11.27" ry="11.27" fill="currentColor" stroke="none"/>\n                <path d="M 22.86 71.86 L 72.86 21.86" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n                <path d="M 39 56 L 57 38" fill="none" stroke="#ffffff" stroke-width="3" stroke-miterlimit="10"/>\n            </svg>':'<svg xmlns="http://www.w3.org/2000/svg" style="margin: -10px 0 0 -10px;" viewBox="0 0 48 48">\n                <path d="M 74.03 46.4 C 68.2 37.48 58.41 32.15 47.86 32.15 C 37.3 32.15 27.51 37.48 21.68 46.4 L 21.38 46.86 L 21.68 47.32 C 27.51 56.24 37.3 61.57 47.86 61.57 C 58.41 61.57 68.2 56.24 74.03 47.31 L 74.33 46.86 L 74.03 46.4 Z M 24.57 46.86 C 28.87 40.84 35.18 36.8 42.25 35.37 C 41.07 35.98 39.97 36.77 39.01 37.74 C 36.61 40.17 35.28 43.4 35.28 46.82 C 35.28 50.26 36.61 53.49 39.01 55.91 C 40.04 56.94 41.2 57.76 42.46 58.38 C 35.3 57 28.92 52.93 24.57 46.86 Z M 47.99 54.79 C 43.66 54.79 40.13 51.23 40.13 46.85 C 40.13 44.74 40.95 42.75 42.43 41.25 C 43.91 39.75 45.89 38.92 47.99 38.92 C 50.09 38.92 52.06 39.75 53.55 41.25 C 55.03 42.75 55.85 44.74 55.85 46.85 C 55.85 48.97 55.03 50.97 53.55 52.47 C 52.06 53.96 50.08 54.79 47.99 54.79 Z M 53.76 58.29 C 54.95 57.68 56.04 56.89 57.01 55.92 C 59.41 53.49 60.73 50.26 60.73 46.83 C 60.73 41.9 57.97 37.62 53.93 35.47 C 60.81 36.96 66.93 40.98 71.13 46.86 C 66.9 52.79 60.71 56.82 53.76 58.29 Z" fill="currentColor" stroke="none"/>\n                <path d="M 45.26 47.3 C 46.69 47.3 47.86 46.13 47.86 44.68 C 47.86 43.23 46.69 42.05 45.26 42.05 C 43.83 42.05 42.67 43.23 42.67 44.68 C 42.67 46.13 43.83 47.3 45.26 47.3" fill="currentColor" stroke="none"/>\n                <ellipse cx="47.86" cy="46.86" rx="11.27" ry="11.27" fill="currentColor" stroke="none"/>\n            </svg>'}])},n(3,r=!0),[s,o,function(){n(3,r=!r)},r,t=>n(0,s=t.id),()=>n(0,s=null)]}class zn extends St{constructor(t){super(),It(this,t,Vn,Un,i,{})}}function Hn(t){let e,n;return e=new qe({props:{$$slots:{default:[Bn]},$$scope:{ctx:t}}}),{c(){yt(e.$$.fragment)},m(t,r){kt(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(gt(e.$$.fragment,t),n=!0)},o(t){mt(e.$$.fragment,t),n=!1},d(t){xt(e,t)}}}function Bn(e){let n,r,o,s=e[2]+"";return{c(){n=R("tr"),r=P("Error when retrieving similarities: "),o=P(s),T(n,"class","faded is-center")},m(t,e){S(t,n,e),x(n,r),x(n,o)},p:t,d(t){t&&O(n)}}}function Fn(e){let n,r,o,s;return n=new Nn({}),o=new Rn({}),{c(){yt(n.$$.fragment),r=_(),yt(o.$$.fragment)},m(t,e){kt(n,t,e),S(t,r,e),kt(o,t,e),s=!0},p:t,i(t){s||(gt(n.$$.fragment,t),gt(o.$$.fragment,t),s=!0)},o(t){mt(n.$$.fragment,t),mt(o.$$.fragment,t),s=!1},d(t){xt(n,t),t&&O(r),xt(o,t)}}}function Dn(t){let e,n;return e=new qe({props:{$$slots:{default:[Jn]},$$scope:{ctx:t}}}),{c(){yt(e.$$.fragment)},m(t,r){kt(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(gt(e.$$.fragment,t),n=!0)},o(t){mt(e.$$.fragment,t),n=!1},d(t){xt(e,t)}}}function Jn(e){let n;return{c(){n=R("tr"),n.textContent=""+("en"===Lt?"Retrieving similarities...":"Récupération des similarités..."),T(n,"class","faded is-center")},m(t,e){S(t,n,e)},p:t,d(t){t&&O(n)}}}function Zn(t){let e,n,r,o;e=new zn({});let s={ctx:t,current:null,token:null,hasCatch:!0,pending:Dn,then:Fn,catch:Hn,value:1,error:2,blocks:[,,,]};return $t(t[0],s),{c(){yt(e.$$.fragment),n=_(),r=M(),s.block.c()},m(t,i){kt(e,t,i),S(t,n,i),S(t,r,i),s.block.m(t,s.anchor=i),s.mount=()=>r.parentNode,s.anchor=r,o=!0},p(e,[n]){wt(s,t=e,n)},i(t){o||(gt(e.$$.fragment,t),gt(s.block),o=!0)},o(t){mt(e.$$.fragment,t);for(let t=0;t<3;t+=1){mt(s.blocks[t])}o=!1},d(t){xt(e,t),t&&O(n),t&&O(r),s.block.d(t),s.token=null,s=null}}}function Xn(t){const{fetchSimilarity:e}=je;return[e]}class Qn extends St{constructor(t){super(),It(this,t,Xn,Zn,i,{})}}function Kn(t){let e,n,r,o,s,i,l,a,u,d,g,$,w,b,v,y,k,C;const I=t[4].default,E=f(I,t,t[3],null);return{c(){e=R("tr"),n=R("th"),r=R("div"),o=R("img"),l=_(),a=R("div"),u=R("a"),d=R("i"),g=P("\n                    Page "),$=P(t[0]),b=_(),v=R("td"),y=R("div"),k=R("div"),E&&E.c(),c(o.src,s=Ut(t[1],"full","250,"))||T(o,"src",s),T(o,"alt",i="Canvas "+t[0]),T(o,"class","mb-3 card"),T(d,"class","fa-solid fa-pen-to-square"),T(u,"class","tag px-2 py-1 is-rounded is-hoverable"),T(u,"href",w=Vt(t[2],t[0])),T(u,"target","_blank"),T(a,"class","is-center mb-1"),T(r,"class","content-wrapper py-5"),T(n,"class","is-3 center-flex is-narrow"),A(n,"width","260px"),T(k,"class","grid is-gap-2"),T(y,"class","fixed-grid has-6-cols"),T(v,"class","p-5 is-fullwidth")},m(t,s){S(t,e,s),x(e,n),x(n,r),x(r,o),x(r,l),x(r,a),x(a,u),x(u,d),x(u,g),x(u,$),x(e,b),x(e,v),x(v,y),x(y,k),E&&E.m(k,null),C=!0},p(t,[e]){(!C||2&e&&!c(o.src,s=Ut(t[1],"full","250,")))&&T(o,"src",s),(!C||1&e&&i!==(i="Canvas "+t[0]))&&T(o,"alt",i),(!C||1&e)&&q($,t[0]),(!C||1&e&&w!==(w=Vt(t[2],t[0])))&&T(u,"href",w),E&&E.p&&(!C||8&e)&&p(E,I,t,t[3],C?m(I,t[3],e,null):h(t[3]),null)},i(t){C||(gt(E,t),C=!0)},o(t){mt(E,t),C=!1},d(t){t&&O(e),E&&E.d(t)}}}function Gn(t,e,n){let{$$slots:r={},$$scope:o}=e,{canvasNb:s}=e,{canvasImg:i}=e;const l=Q("manifest");return t.$$set=t=>{"canvasNb"in t&&n(0,s=t.canvasNb),"canvasImg"in t&&n(1,i=t.canvasImg),"$$scope"in t&&n(3,o=t.$$scope)},[s,i,l,o,r]}class Wn extends St{constructor(t){super(),It(this,t,Gn,Kn,i,{canvasNb:0,canvasImg:1})}}function Yn(t,e,n){const r=t.slice();return r[10]=e[n][0],r[11]=e[n][1],r}function tr(t,e,n){const r=t.slice();return r[14]=e[n],r}function er(e){let n,r,o="en"===Lt?`Error when retrieving paginated regions: ${e[17]}`:`Erreur de récupération des pages : ${e[17]}`;return{c(){n=R("tr"),r=P(o),T(n,"class","faded is-center")},m(t,e){S(t,n,e),x(n,r)},p(t,e){4&e&&o!==(o="en"===Lt?`Error when retrieving paginated regions: ${t[17]}`:`Erreur de récupération des pages : ${t[17]}`)&&q(r,o)},i:t,o:t,d(t){t&&O(n)}}}function nr(t){let e,n,r,o,s;const i=[or,rr],l=[];function c(t,n){return 8&n&&(e=null),null==e&&(e=!!(Object.values(t[3]).length>0)),e?0:1}return n=c(t,-1),r=l[n]=i[n](t),{c(){r.c(),o=M()},m(t,e){l[n].m(t,e),S(t,o,e),s=!0},p(t,e){let s=n;n=c(t,e),n===s?l[n].p(t,e):(dt(),mt(l[s],1,1,(()=>{l[s]=null})),ft(),r=l[n],r?r.p(t,e):(r=l[n]=i[n](t),r.c()),gt(r,1),r.m(o.parentNode,o))},i(t){s||(gt(r),s=!0)},o(t){mt(r),s=!1},d(t){l[n].d(t),t&&O(o)}}}function rr(e){let n,r,o;return r=new pe({}),{c(){n=R("tr"),yt(r.$$.fragment)},m(t,e){S(t,n,e),kt(r,n,null),o=!0},p:t,i(t){o||(gt(r.$$.fragment,t),o=!0)},o(t){mt(r.$$.fragment,t),o=!1},d(t){t&&O(n),xt(r)}}}function or(t){let e,n,r=Object.entries(t[3]),o=[];for(let e=0;e<r.length;e+=1)o[e]=lr(Yn(t,r,e));const s=t=>mt(o[t],1,1,(()=>{o[t]=null}));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=M()},m(t,r){for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,r);S(t,e,r),n=!0},p(t,n){if(139&n){let i;for(r=Object.entries(t[3]),i=0;i<r.length;i+=1){const s=Yn(t,r,i);o[i]?(o[i].p(s,n),gt(o[i],1)):(o[i]=lr(s),o[i].c(),gt(o[i],1),o[i].m(e.parentNode,e))}for(dt(),i=r.length;i<o.length;i+=1)s(i);ft()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)gt(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)mt(o[t]);n=!1},d(t){E(o,t),t&&O(e)}}}function sr(t,e){let n,r,o;return r=new oe({props:{item:e[14],isSquare:!1,isCopied:e[0](e[14])}}),r.$on("copyRef",(function(){s(e[1])&&e[1].apply(this,arguments)})),{key:t,first:null,c(){n=M(),yt(r.$$.fragment),this.first=n},m(t,e){S(t,n,e),kt(r,t,e),o=!0},p(t,n){e=t;const o={};8&n&&(o.item=e[14]),9&n&&(o.isCopied=e[0](e[14])),r.$set(o)},i(t){o||(gt(r.$$.fragment,t),o=!0)},o(t){mt(r.$$.fragment,t),o=!1},d(t){t&&O(n),xt(r,t)}}}function ir(t){let e,n,r=[],o=new Map,s=Object.values(t[11]);const i=t=>t[14].id;for(let e=0;e<s.length;e+=1){let n=tr(t,s,e),l=i(n);o.set(l,r[e]=sr(l,n))}return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=_()},m(t,o){for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,o);S(t,e,o),n=!0},p(t,n){11&n&&(s=Object.values(t[11]),dt(),r=vt(r,n,i,1,t,s,o,e.parentNode,bt,sr,e,tr),ft())},i(t){if(!n){for(let t=0;t<s.length;t+=1)gt(r[t]);n=!0}},o(t){for(let t=0;t<r.length;t+=1)mt(r[t]);n=!1},d(t){for(let e=0;e<r.length;e+=1)r[e].d(t);t&&O(e)}}}function lr(t){let e,n;return e=new Wn({props:{canvasImg:t[7](t[10]),canvasNb:t[10],$$slots:{default:[ir]},$$scope:{ctx:t}}}),{c(){yt(e.$$.fragment)},m(t,r){kt(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.canvasImg=t[7](t[10])),8&n&&(r.canvasNb=t[10]),262155&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(gt(e.$$.fragment,t),n=!0)},o(t){mt(e.$$.fragment,t),n=!1},d(t){xt(e,t)}}}function cr(e){let n;return{c(){n=R("tr"),n.textContent=""+("en"===Lt?"Retrieving paginated regions...":"Récupération des pages..."),T(n,"class","faded is-center")},m(t,e){S(t,n,e)},p:t,i:t,o:t,d(t){t&&O(n)}}}function ar(t){let e,n,r,o={ctx:t,current:null,token:null,hasCatch:!0,pending:cr,then:nr,catch:er,value:9,error:17,blocks:[,,,]};return $t(n=t[2],o),{c(){e=M(),o.block.c()},m(t,n){S(t,e,n),o.block.m(t,o.anchor=n),o.mount=()=>e.parentNode,o.anchor=e,r=!0},p(e,r){t=e,o.ctx=t,4&r&&n!==(n=t[2])&&$t(n,o)||wt(o,t,r)},i(t){r||(gt(o.block),r=!0)},o(t){for(let t=0;t<3;t+=1){mt(o.blocks[t])}r=!1},d(t){t&&O(e),o.block.d(t),o.token=null,o=null}}}function ur(t){let e,n,r,o,s,i;return e=new Fe({props:{store:Bt,nbOfItems:t[6]}}),r=new qe({props:{$$slots:{default:[ar]},$$scope:{ctx:t}}}),s=new Fe({props:{store:Bt,nbOfItems:t[6]}}),{c(){yt(e.$$.fragment),n=_(),yt(r.$$.fragment),o=_(),yt(s.$$.fragment)},m(t,l){kt(e,t,l),S(t,n,l),kt(r,t,l),S(t,o,l),kt(s,t,l),i=!0},p(t,[e]){const n={};262159&e&&(n.$$scope={dirty:e,ctx:t}),r.$set(n)},i(t){i||(gt(e.$$.fragment,t),gt(r.$$.fragment,t),gt(s.$$.fragment,t),i=!0)},o(t){mt(e.$$.fragment,t),mt(r.$$.fragment,t),mt(s.$$.fragment,t),i=!1},d(t){xt(e,t),t&&O(n),xt(r,t),t&&O(o),xt(s,t)}}}function dr(t,e,n){let r,o;const{pageRegions:s,fetchPages:i}=Bt;d(t,s,(t=>n(3,o=t))),d(t,i,(t=>n(2,r=t)));let{isItemCopied:l}=e,{handleCopyRef:c}=e;const a=Q("nbOfPages");return t.$$set=t=>{"isItemCopied"in t&&n(0,l=t.isItemCopied),"handleCopyRef"in t&&n(1,c=t.handleCopyRef)},[l,c,r,o,s,i,a,function(t){return`${imgPrefix}_${e=t,n=String(a).length+1,e.toString().padStart(n,"0")}`;var e,n}]}class fr extends St{constructor(t){super(),It(this,t,dr,ur,i,{isItemCopied:0,handleCopyRef:1})}}function gr(t,e,n){const r=t.slice();return r[24]=e[n][0],r[25]=e[n][1],r}function mr(t,e,n){const r=t.slice();return r[29]=e[n],r}function pr(t,e,n){const r=t.slice();return r[33]=e[n][0],r[25]=e[n][1],r}function hr(t){let e,n,r,s,i,l,c=t[25].text+"";function a(){return t[22](t[33])}return{c(){e=R("li"),n=R("a"),r=P(c),s=_(),T(n,"href",null),U(e,"is-active",t[33]===t[4])},m(t,o){S(t,e,o),x(e,n),x(n,r),x(e,s),i||(l=[j(e,"click",a),j(e,"keyup",Lr)],i=!0)},p(n,o){t=n,4&o[0]&&c!==(c=t[25].text+"")&&q(r,c),20&o[0]&&U(e,"is-active",t[33]===t[4])},d(t){t&&O(e),i=!1,o(l)}}}function $r(e){let n;return{c(){n=R("div"),n.textContent="tout doux"},m(t,e){S(t,n,e)},p:t,i:t,o:t,d(t){t&&O(n)}}}function wr(e){let n,r;return n=new Qn({}),{c(){yt(n.$$.fragment)},m(t,e){kt(n,t,e),r=!0},p:t,i(t){r||(gt(n.$$.fragment,t),r=!0)},o(t){mt(n.$$.fragment,t),r=!1},d(t){xt(n,t)}}}function br(t){let e,n;return e=new fr({props:{isItemCopied:t[3],handleCopyRef:t[14]}}),{c(){yt(e.$$.fragment)},m(t,r){kt(e,t,r),n=!0},p(t,n){const r={};8&n[0]&&(r.isItemCopied=t[3]),e.$set(r)},i(t){n||(gt(e.$$.fragment,t),n=!0)},o(t){mt(e.$$.fragment,t),n=!1},d(t){xt(e,t)}}}function vr(t){let e,n,r={ctx:t,current:null,token:null,hasCatch:!0,pending:Ir,then:kr,catch:yr,value:28,error:32,blocks:[,,,]};return $t(t[10],r),{c(){e=R("div"),r.block.c(),T(e,"class","grid is-gap-2")},m(t,o){S(t,e,o),r.block.m(e,r.anchor=null),r.mount=()=>e,r.anchor=null,n=!0},p(e,n){wt(r,t=e,n)},i(t){n||(gt(r.block),n=!0)},o(t){for(let t=0;t<3;t+=1){mt(r.blocks[t])}n=!1},d(t){t&&O(e),r.block.d(),r.token=null,r=null}}}function yr(e){let n,r,o,s=e[32]+"";return{c(){n=R("div"),r=P("Error when retrieving regions: "),o=P(s)},m(t,e){S(t,n,e),x(n,r),x(n,o)},p:t,i:t,o:t,d(t){t&&O(n)}}}function kr(t){let e,n,r=[],o=new Map,s=Object.values(t[7]);const i=t=>t[29].id;for(let e=0;e<s.length;e+=1){let n=mr(t,s,e),l=i(n);o.set(l,r[e]=Cr(l,n))}let l=null;return s.length||(l=xr(t)),{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=M(),l&&l.c()},m(t,o){for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,o);S(t,e,o),l&&l.m(t,o),n=!0},p(t,n){22664&n[0]&&(s=Object.values(t[7]),dt(),r=vt(r,n,i,1,t,s,o,e.parentNode,bt,Cr,e,mr),ft(),!s.length&&l?l.p(t,n):s.length?l&&(dt(),mt(l,1,1,(()=>{l=null})),ft()):(l=xr(t),l.c(),gt(l,1),l.m(e.parentNode,e)))},i(t){if(!n){for(let t=0;t<s.length;t+=1)gt(r[t]);n=!0}},o(t){for(let t=0;t<r.length;t+=1)mt(r[t]);n=!1},d(t){for(let e=0;e<r.length;e+=1)r[e].d(t);t&&O(e),l&&l.d(t)}}}function xr(e){let n,r;return n=new pe({props:{currentRegionId:e[12],baseUrl:e[11]}}),{c(){yt(n.$$.fragment)},m(t,e){kt(n,t,e),r=!0},p:t,i(t){r||(gt(n.$$.fragment,t),r=!0)},o(t){mt(n.$$.fragment,t),r=!1},d(t){xt(n,t)}}}function Cr(t,e){let n,r,o;return r=new oe({props:{item:e[29],isCopied:e[3](e[29])}}),r.$on("copyRef",e[14]),{key:t,first:null,c(){n=M(),yt(r.$$.fragment),this.first=n},m(t,e){S(t,n,e),kt(r,t,e),o=!0},p(t,n){e=t;const o={};128&n[0]&&(o.item=e[29]),136&n[0]&&(o.isCopied=e[3](e[29])),r.$set(o)},i(t){o||(gt(r.$$.fragment,t),o=!0)},o(t){mt(r.$$.fragment,t),o=!1},d(t){t&&O(n),xt(r,t)}}}function Ir(e){let n;return{c(){n=R("div"),n.textContent=""+("en"===Lt?"Retrieving regions...":"Récupération des régions..."),T(n,"class","faded is-center")},m(t,e){S(t,n,e)},p:t,i:t,o:t,d(t){t&&O(n)}}}function Sr(e){let n;return{c(){n=R("div"),n.textContent=""+("en"===Lt?"No regions in selection":"Aucune région sélectionnée")},m(t,e){S(t,n,e)},p:t,d(t){t&&O(n)}}}function Or(t){let e,n,r=Object.entries(t[1]),o=[];for(let e=0;e<r.length;e+=1)o[e]=Er(gr(t,r,e));return{c(){e=R("div"),n=R("div");for(let t=0;t<o.length;t+=1)o[t].c();T(n,"class","grid is-gap-2"),T(e,"class","fixed-grid has-6-cols")},m(t,r){S(t,e,r),x(e,n);for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(n,null)},p(t,e){if(2&e[0]){let s;for(r=Object.entries(t[1]),s=0;s<r.length;s+=1){const i=gr(t,r,s);o[s]?o[s].p(i,e):(o[s]=Er(i),o[s].c(),o[s].m(n,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=r.length}},d(t){t&&O(e),E(o,t)}}}function Er(t){let e,n,r,o,s,i,l,a,u,d,f,g,m,p=t[25].title+"";function h(){return t[23](t[24])}return{c(){e=R("div"),n=R("figure"),r=R("img"),s=_(),i=R("div"),l=R("span"),a=P(p),u=_(),d=R("button"),f=_(),c(r.src,o=Ut(t[25].img,t[25].xyhw,"96,"))||T(r,"src",o),T(r,"alt","Extracted region"),T(l,"class","overlay-desc"),T(i,"class","overlay is-center svelte-403wty"),T(n,"class","image is-64x64 card"),T(d,"class","delete region-btn"),T(d,"aria-label","remove from selection"),T(e,"class","selection cell svelte-403wty")},m(t,o){S(t,e,o),x(e,n),x(n,r),x(n,s),x(n,i),x(i,l),x(l,a),x(e,u),x(e,d),x(e,f),g||(m=j(d,"click",h),g=!0)},p(e,n){t=e,2&n[0]&&!c(r.src,o=Ut(t[25].img,t[25].xyhw,"96,"))&&T(r,"src",o),2&n[0]&&p!==(p=t[25].title+"")&&q(a,p)},d(t){t&&O(e),g=!1,m()}}}function Rr(t){let e,n,r,o,s,i,l,c,a,u,d,f,g,m,p,h,$,w,b,v,y,k,C,I,L,M,j,N,A,U,V,z,H,B,F,D,J,Z,X,Q="en"===Lt?"Selected regions":"Regions sélectionnées";e=new Kt({props:{visible:t[6]}}),r=new fe({}),s=new le({props:{selectionLength:t[0]}}),u=new ke({props:{baseUrl:t[11],currentRegionId:t[12]}}),g=new Me({});let K=Object.entries(t[2]),G=[];for(let e=0;e<K.length;e+=1)G[e]=hr(pr(t,K,e));const W=[vr,br,wr,$r],Y=[];function tt(t,e){return"all"===t[4]?0:"page"===t[4]?1:"similarity"===t[4]?2:"vectorization"===t[4]?3:-1}function et(t,e){return t[5]?Or:Sr}~(w=tt(t))&&(b=Y[w]=W[w](t));let nt=et(t),rt=nt(t);return Z=new ue({props:{isRegion:!0}}),{c(){yt(e.$$.fragment),n=_(),yt(r.$$.fragment),o=_(),yt(s.$$.fragment),i=_(),l=R("div"),c=R("div"),a=R("div"),yt(u.$$.fragment),d=_(),f=R("div"),yt(g.$$.fragment),m=_(),p=R("div"),h=R("ul");for(let t=0;t<G.length;t+=1)G[t].c();$=_(),b&&b.c(),v=_(),y=R("div"),k=R("div"),C=_(),I=R("div"),L=R("div"),M=R("div"),j=R("i"),N=_(),A=P(Q),U=P("\n                ("),V=P(t[0]),z=P(")"),H=_(),B=R("button"),F=_(),D=R("section"),rt.c(),J=_(),yt(Z.$$.fragment),T(a,"class","cell is-right is-middle"),T(f,"class","cell"),T(c,"class","actions grid"),T(h,"class","panel-tabs"),T(p,"class","tabs is-centered"),T(l,"id","nav-actions"),T(l,"class","mb-5 svelte-403wty"),T(k,"class","modal-background"),T(j,"class","fa-solid fa-book-bookmark"),T(M,"class","title is-4 mb-0 media-content"),T(B,"class","delete media-left"),T(B,"aria-label","close"),T(L,"class","modal-card-head media mb-0"),T(D,"class","modal-card-body"),T(I,"class","modal-content"),T(y,"id","selection-modal"),T(y,"class","modal fade"),T(y,"tabindex","-1"),T(y,"aria-labelledby","selection-modal-label"),T(y,"aria-hidden","true")},m(t,b){kt(e,t,b),S(t,n,b),kt(r,t,b),S(t,o,b),kt(s,t,b),S(t,i,b),S(t,l,b),x(l,c),x(c,a),kt(u,a,null),x(c,d),x(c,f),kt(g,f,null),x(l,m),x(l,p),x(p,h);for(let t=0;t<G.length;t+=1)G[t]&&G[t].m(h,null);S(t,$,b),~w&&Y[w].m(t,b),S(t,v,b),S(t,y,b),x(y,k),x(y,C),x(y,I),x(I,L),x(L,M),x(M,j),x(M,N),x(M,A),x(M,U),x(M,V),x(M,z),x(L,H),x(L,B),x(I,F),x(I,D),rt.m(D,null),x(I,J),kt(Z,I,null),X=!0},p(t,n){const r={};64&n[0]&&(r.visible=t[6]),e.$set(r);const o={};if(1&n[0]&&(o.selectionLength=t[0]),s.$set(o),8212&n[0]){let e;for(K=Object.entries(t[2]),e=0;e<K.length;e+=1){const r=pr(t,K,e);G[e]?G[e].p(r,n):(G[e]=hr(r),G[e].c(),G[e].m(h,null))}for(;e<G.length;e+=1)G[e].d(1);G.length=K.length}let i=w;w=tt(t),w===i?~w&&Y[w].p(t,n):(b&&(dt(),mt(Y[i],1,1,(()=>{Y[i]=null})),ft()),~w?(b=Y[w],b?b.p(t,n):(b=Y[w]=W[w](t),b.c()),gt(b,1),b.m(v.parentNode,v)):b=null),(!X||1&n[0])&&q(V,t[0]),nt===(nt=et(t))&&rt?rt.p(t,n):(rt.d(1),rt=nt(t),rt&&(rt.c(),rt.m(D,null)))},i(t){X||(gt(e.$$.fragment,t),gt(r.$$.fragment,t),gt(s.$$.fragment,t),gt(u.$$.fragment,t),gt(g.$$.fragment,t),gt(b),gt(Z.$$.fragment,t),X=!0)},o(t){mt(e.$$.fragment,t),mt(r.$$.fragment,t),mt(s.$$.fragment,t),mt(u.$$.fragment,t),mt(g.$$.fragment,t),mt(b),mt(Z.$$.fragment,t),X=!1},d(t){xt(e,t),t&&O(n),xt(r,t),t&&O(o),xt(s,t),t&&O(i),t&&O(l),xt(u),xt(g),E(G,t),t&&O($),~w&&Y[w].d(t),t&&O(v),t&&O(y),rt.d(),xt(Z)}}}const Lr=()=>null;function Pr(t,e,n){let r,o,s,i,l,c,a,u,f;d(t,qt,(t=>n(6,u=t)));const{selected:g}=Ht;d(t,g,(t=>n(21,a=t)));const{allRegions:m,fetchAll:p}=Bt;d(t,m,(t=>n(7,f=t)));let{manifest:h=""}=e,{isValidated:$=!1}=e,{imgPrefix:w=""}=e,{nbOfPages:b=1}=e,{witness:v={}}=e;X("witness",v),X("nbOfPages",b),X("imgPrefix",w),X("manifest",h),X("isValidated",$);const y=`${window.location.origin}${window.location.pathname}`,k=parseInt(y.split("regions/")[1].replace("/","")),x={all:{text:"en"===Lt?"All regions":"Toutes les régions"},page:{text:"en"===Lt?"Per page":"Par page"}};function C(t){n(4,i=t);const e=new URL(window.location);e.searchParams.set("tab",t),window.history.pushState({},"",e)}Mt.includes("similarity")&&(x.similarity={text:"en"===Lt?"Similarity":"Similarité"}),Mt.includes("vectorization")&&(x.vectorization={text:"en"===Lt?"Vectorization":"Vectorisation"});return t.$$set=t=>{"manifest"in t&&n(15,h=t.manifest),"isValidated"in t&&n(16,$=t.isValidated),"imgPrefix"in t&&n(17,w=t.imgPrefix),"nbOfPages"in t&&n(18,b=t.nbOfPages),"witness"in t&&n(19,v=t.witness)},t.$$.update=()=>{2097152&t.$$.dirty[0]&&n(1,r=a(!0)),2&t.$$.dirty[0]&&n(0,o=Object.keys(r).length),1&t.$$.dirty[0]&&n(5,s=o>0),1048576&t.$$.dirty[0]&&n(3,c=t=>l===t.ref)},n(4,i=new URLSearchParams(window.location.search).get("tab")??"all"),n(20,l=""),[o,r,x,c,i,s,u,f,g,m,p,y,k,C,function(t){const{item:e}=t.detail,r=c(e)?"":e.ref;navigator.clipboard.writeText(r),n(20,l=r)},h,$,w,b,v,l,a,t=>C(t),t=>Ht.remove(t,jt)]}return new class extends St{constructor(t){super(),It(this,t,Pr,Rr,i,{manifest:15,isValidated:16,imgPrefix:17,nbOfPages:18,witness:19},null,[-1,-1])}}({target:document.getElementById("region-list"),props:{witness:witness,manifest:manifest,isValidated:isValidated,imgPrefix:imgPrefix,nbOfPages:nbOfPages}})}();
//# sourceMappingURL=regionList.js.map
