var regionList=function(){"use strict";function e(){}const t=e=>e;function n(e){return e()}function i(){return Object.create(null)}function s(e){e.forEach(n)}function o(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let l;function c(e,t){return l||(l=document.createElement("a")),l.href=t,e===l.href}function a(t,...n){if(null==t)return e;const i=t.subscribe(...n);return i.unsubscribe?()=>i.unsubscribe():i}function u(e,t,n){e.$$.on_destroy.push(a(t,n))}function d(e,t,n,i){if(e){const s=f(e,t,n,i);return e[0](s)}}function f(e,t,n,i){return e[1]&&i?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](i(t))):n.ctx}function g(e,t,n,i){if(e[2]&&i){const s=e[2](i(n));if(void 0===t.dirty)return s;if("object"==typeof s){const e=[],n=Math.max(t.dirty.length,s.length);for(let i=0;i<n;i+=1)e[i]=t.dirty[i]|s[i];return e}return t.dirty|s}return t.dirty}function p(e,t,n,i,s,o){if(s){const r=f(t,n,i,o);e.p(r,s)}}function m(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}const h="undefined"!=typeof window;let $=h?()=>window.performance.now():()=>Date.now(),b=h?e=>requestAnimationFrame(e):e;const v=new Set;function w(e){v.forEach((t=>{t.c(e)||(v.delete(t),t.f())})),0!==v.size&&b(w)}function y(e,t){e.appendChild(t)}function k(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function x(e){const t=O("style");return function(e,t){y(e.head||e,t),t.sheet}(k(e),t),t.sheet}function L(e,t,n){e.insertBefore(t,n||null)}function R(e){e.parentNode&&e.parentNode.removeChild(e)}function S(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function O(e){return document.createElement(e)}function E(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function P(e){return document.createTextNode(e)}function I(){return P(" ")}function C(){return P("")}function _(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function N(e){return function(t){return t.preventDefault(),e.call(this,t)}}function T(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function j(e,t){t=""+t,e.data!==t&&(e.data=t)}function A(e,t,n,i){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,i?"important":"")}function V(e,t,n){e.classList[n?"add":"remove"](t)}function q(e,t,{bubbles:n=!1,cancelable:i=!1}={}){const s=document.createEvent("CustomEvent");return s.initCustomEvent(e,n,i,t),s}const M=new Map;let U,z=0;function D(e,t,n,i,s,o,r,l=0){const c=16.666/i;let a="{\n";for(let e=0;e<=1;e+=c){const i=t+(n-t)*o(e);a+=100*e+`%{${r(i,1-i)}}\n`}const u=a+`100% {${r(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${l}`,f=k(e),{stylesheet:g,rules:p}=M.get(f)||function(e,t){const n={stylesheet:x(t),rules:{}};return M.set(e,n),n}(f,e);p[d]||(p[d]=!0,g.insertRule(`@keyframes ${d} ${u}`,g.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${d} ${i}ms linear ${s}ms 1 both`,z+=1,d}function H(e,t){const n=(e.style.animation||"").split(", "),i=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),s=n.length-i.length;s&&(e.style.animation=i.join(", "),z-=s,z||b((()=>{z||(M.forEach((e=>{const{ownerNode:t}=e.stylesheet;t&&R(t)})),M.clear())})))}function F(e){U=e}function B(){if(!U)throw new Error("Function called outside component initialization");return U}const J=[],X=[];let K=[];const G=[],Q=Promise.resolve();let Y=!1;function W(e){K.push(e)}const Z=new Set;let ee,te=0;function ne(){if(0!==te)return;const e=U;do{try{for(;te<J.length;){const e=J[te];te++,F(e),ie(e.$$)}}catch(e){throw J.length=0,te=0,e}for(F(null),J.length=0,te=0;X.length;)X.pop()();for(let e=0;e<K.length;e+=1){const t=K[e];Z.has(t)||(Z.add(t),t())}K.length=0}while(J.length);for(;G.length;)G.pop()();Y=!1,Z.clear(),F(e)}function ie(e){if(null!==e.fragment){e.update(),s(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(W)}}function se(e,t,n){e.dispatchEvent(q(`${t?"intro":"outro"}${n}`))}const oe=new Set;let re;function le(){re={r:0,c:[],p:re}}function ce(){re.r||s(re.c),re=re.p}function ae(e,t){e&&e.i&&(oe.delete(e),e.i(t))}function ue(e,t,n,i){if(e&&e.o){if(oe.has(e))return;oe.add(e),re.c.push((()=>{oe.delete(e),i&&(n&&e.d(1),i())})),e.o(t)}else i&&i()}const de={duration:0};function fe(n,i,r,l){const c={direction:"both"};let a=i(n,r,c),u=l?0:1,d=null,f=null,g=null;function p(){g&&H(n,g)}function m(e,t){const n=e.b-u;return t*=Math.abs(n),{a:u,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function h(i){const{delay:o=0,duration:r=300,easing:l=t,tick:c=e,css:h}=a||de,y={start:$()+o,b:i};i||(y.group=re,re.r+=1),d||f?f=y:(h&&(p(),g=D(n,u,i,r,o,l,h)),i&&c(0,1),d=m(y,r),W((()=>se(n,i,"start"))),function(e){let t;0===v.size&&b(w),new Promise((n=>{v.add(t={c:e,f:n})}))}((e=>{if(f&&e>f.start&&(d=m(f,r),f=null,se(n,d.b,"start"),h&&(p(),g=D(n,u,d.b,d.duration,0,l,a.css))),d)if(e>=d.end)c(u=d.b,1-u),se(n,d.b,"end"),f||(d.b?p():--d.group.r||s(d.group.c)),d=null;else if(e>=d.start){const t=e-d.start;u=d.a+d.d*l(t/d.duration),c(u,1-u)}return!(!d&&!f)})))}return{run(e){o(a)?(ee||(ee=Promise.resolve(),ee.then((()=>{ee=null}))),ee).then((()=>{a=a(c),h(e)})):h(e)},end(){p(),d=f=null}}}function ge(e,t){const n=t.token={};function i(e,i,s,o){if(t.token!==n)return;t.resolved=o;let r=t.ctx;void 0!==s&&(r=r.slice(),r[s]=o);const l=e&&(t.current=e)(r);let c=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==i&&e&&(le(),ue(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),ce())})):t.block.d(1),l.c(),ae(l,1),l.m(t.mount(),t.anchor),c=!0),t.block=l,t.blocks&&(t.blocks[i]=l),c&&ne()}if(!(s=e)||"object"!=typeof s&&"function"!=typeof s||"function"!=typeof s.then){if(t.current!==t.then)return i(t.then,1,t.value,e),!0;t.resolved=e}else{const n=B();if(e.then((e=>{F(n),i(t.then,1,t.value,e),F(null)}),(e=>{if(F(n),i(t.catch,2,t.error,e),F(null),!t.hasCatch)throw e})),t.current!==t.pending)return i(t.pending,0),!0}var s}function pe(e,t,n){const i=t.slice(),{resolved:s}=e;e.current===e.then&&(i[e.value]=s),e.current===e.catch&&(i[e.error]=s),e.block.p(i,n)}function me(e,t){ue(e,1,1,(()=>{t.delete(e.key)}))}function he(e,t,n,i,o,r,l,c,a,u,d,f){let g=e.length,p=r.length,m=g;const h={};for(;m--;)h[e[m].key]=m;const $=[],b=new Map,v=new Map,w=[];for(m=p;m--;){const e=f(o,r,m),s=n(e);let c=l.get(s);c?i&&w.push((()=>c.p(e,t))):(c=u(s,e),c.c()),b.set(s,$[m]=c),s in h&&v.set(s,Math.abs(m-h[s]))}const y=new Set,k=new Set;function x(e){ae(e,1),e.m(c,d),l.set(e.key,e),d=e.first,p--}for(;g&&p;){const t=$[p-1],n=e[g-1],i=t.key,s=n.key;t===n?(d=t.first,g--,p--):b.has(s)?!l.has(i)||y.has(i)?x(t):k.has(s)?g--:v.get(i)>v.get(s)?(k.add(i),x(t)):(y.add(s),g--):(a(n,l),g--)}for(;g--;){const t=e[g];b.has(t.key)||a(t,l)}for(;p;)x($[p-1]);return s(w),$}function $e(e){e&&e.c()}function be(e,t,i,r){const{fragment:l,after_update:c}=e.$$;l&&l.m(t,i),r||W((()=>{const t=e.$$.on_mount.map(n).filter(o);e.$$.on_destroy?e.$$.on_destroy.push(...t):s(t),e.$$.on_mount=[]})),c.forEach(W)}function ve(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];K.forEach((i=>-1===e.indexOf(i)?t.push(i):n.push(i))),n.forEach((e=>e())),K=t}(n.after_update),s(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function we(e,t){-1===e.$$.dirty[0]&&(J.push(e),Y||(Y=!0,Q.then(ne)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ye(t,n,o,r,l,c,a,u=[-1]){const d=U;F(t);const f=t.$$={fragment:null,ctx:[],props:c,update:e,not_equal:l,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(d?d.$$.context:[])),callbacks:i(),dirty:u,skip_bound:!1,root:n.target||d.$$.root};a&&a(f.root);let g=!1;if(f.ctx=o?o(t,n.props||{},((e,n,...i)=>{const s=i.length?i[0]:n;return f.ctx&&l(f.ctx[e],f.ctx[e]=s)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](s),g&&we(t,e)),n})):[],f.update(),g=!0,s(f.before_update),f.fragment=!!r&&r(f.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);f.fragment&&f.fragment.l(e),e.forEach(R)}else f.fragment&&f.fragment.c();n.intro&&ae(t.$$.fragment),be(t,n.target,n.anchor,n.customElement),ne()}F(d)}class ke{$destroy(){ve(this,1),this.$destroy=e}$on(t,n){if(!o(n))return e;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const e=i.indexOf(n);-1!==e&&i.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const xe=[];function Le(t,n=e){let i;const s=new Set;function o(e){if(r(t,e)&&(t=e,i)){const e=!xe.length;for(const e of s)e[1](),xe.push(e,t);if(e){for(let e=0;e<xe.length;e+=2)xe[e][0](xe[e+1]);xe.length=0}}}return{set:o,update:function(e){o(e(t))},subscribe:function(r,l=e){const c=[r,l];return s.add(c),1===s.size&&(i=n(o)||e),r(t),()=>{s.delete(c),0===s.size&&i&&(i(),i=null)}}}}function Re(t,n,i){const r=!Array.isArray(t),l=r?[t]:t,c=n.length<2;return u=t=>{let i=!1;const u=[];let d=0,f=e;const g=()=>{if(d)return;f();const i=n(r?u[0]:u,t);c?t(i):f=o(i)?i:e},p=l.map(((e,t)=>a(e,(e=>{u[t]=e,d&=~(1<<t),i&&g()}),(()=>{d|=1<<t}))));return i=!0,g(),function(){s(p),f(),i=!1}},{subscribe:Le(i,u).subscribe};var u}const Se=Le(!1);async function Oe(e){Se.set(!0);try{return await e()}finally{Se.set(!1)}}function Ee(e=null,t="full",n="full"){if(!e)return"https://via.placeholder.com/96x96?text=No+Image";if((e=e.split("_")).length<3)return"https://via.placeholder.com/96x96?text=No+Image";const i=e[e.length-1].includes(",")?e.pop().replace(".jpg",""):t,s=e.join("_").replace(".jpg","");return`${CANTALOUPE_APP_URL??"http://localhost:8182"}/iiif/2/${s}.jpg/${i}/${n}/0/default.jpg`}function Pe(e=null,t=1){return`${SAS_APP_URL??"http://localhost:3000"}/index.html?iiif-content=${e}&canvas=${t}`}function Ie(e,t=null,n=!1){return new Promise((i=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:i(void 0),t&&(document.getElementById("modal-title").textContent=t),document.getElementById("modal-body").textContent=e,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),o=document.getElementById("ok-btn"),r=document.getElementById("modal-bkg"),l=()=>{s.removeEventListener("click",c),r.removeEventListener("click",c),o.removeEventListener("click",a),document.getElementById("modal-footer").hidden=!0},c=()=>{l(),i(!1)},a=()=>{l(),i(!0)};s.addEventListener("click",c),o.addEventListener("click",a)}else n?i(window.confirm(e)):(window.alert(e),i(void 0))}))}const Ce="Regions";const _e=function(){const e=Le(JSON.parse(localStorage.getItem("documentSet"))||{}),{subscribe:t,get:n,update:i}=e;function s(e){localStorage.setItem("documentSet",JSON.stringify(e))}function o(e,t=!0){return t?e[Ce]??{}:Object.entries(e).filter((([e,t])=>e!==Ce))}function r(e,t,n){if(e[n]){const{[t]:i,...s}=e[n];e={...e,[n]:s}}return s(e),e}function l(e,t){return e.hasOwnProperty(t.type)||(e[t.type]={}),e[t.type]={...e[t.type],[t.id]:t},s(e),e}return{subscribe:t,save:()=>i((e=>(console.log(e),e))),empty:e=>i((t=>(e?delete t[Ce]:Object.keys(t).forEach((e=>{e!==Ce&&delete t[e]})),s(t),t))),addAll:e=>i((t=>function(e,t){return t.forEach((t=>{e[t.type]||(e[t.type]={}),e[t.type][t.id]=t})),s(e),e}(t,e))),removeAll:(e,t)=>i((n=>function(e,t,n){return e[n]?(t.forEach((t=>{delete e[n][t]})),s(e),e):e}(n,e,t))),remove:(e,t)=>i((n=>r(n,e,t))),add:e=>i((t=>l(t,e))),toggle:e=>i((t=>t[e.type]?.[e.id]?r(t,e.id,e.type):l(t,e))),toggleAll:(e,t,n)=>i((e=>{})),isSelected:Re(e,(e=>t=>e[t.type]?.hasOwnProperty(t.id)||!1)),selected:Re(e,(e=>t=>o(e,t))),nbSelected:Re(e,(e=>t=>{const n=o(e,t);return t?Object.keys(n).length:n.reduce(((e,[t,n])=>e+Object.keys(n).length),0)}))}}();const Ne=function(){const e=Le(1),t=Le({}),n=Le({}),i=`${window.location.origin}${window.location.pathname}`;if("undefined"!=typeof window){const t=new URLSearchParams(window.location.search).get("p");t&&e.set(parseInt(t))}const s=(async()=>{const e=await fetch(`${i}canvas`),n=await e.json();let s={};return Object.values(n).forEach((e=>{Object.entries(e).forEach((([e,t])=>{s[e]=t}))})),t.set(s),n})(),o=Re(e,(e=>(async()=>{const t=await fetch(`${i}canvas?p=${e}`),s=await t.json();return n.set(s),s})()));return{currentPage:e,pageRegions:n,allRegions:t,fetchPages:o,fetchAll:s,handlePageUpdate:function(t){if(e.set(t),"undefined"!=typeof window){const e=new URL(window.location.href);e.searchParams.set("p",t),window.history.pushState({},"",e)}},remove:function(e){t.update((t=>(delete t[e],{...t}))),n.update((t=>{for(const n in t)if(t[n][e]){const{[e]:i,...s}=t[n];return t[n]=s,t}return t}))}}}();function Te(e,{delay:n=0,duration:i=400,easing:s=t}={}){const o=+getComputedStyle(e).opacity;return{delay:n,duration:i,easing:s,css:e=>"opacity: "+e*o}}function je(e){let t,n,i;return{c(){t=O("div"),t.innerHTML='<div class="loader svelte-vizlcg"></div>',T(t,"class","bkg-shade svelte-vizlcg")},m(e,n){L(e,t,n),i=!0},i(e){i||(W((()=>{i&&(n||(n=fe(t,Te,{duration:150},!0)),n.run(1))})),i=!0)},o(e){n||(n=fe(t,Te,{duration:150},!1)),n.run(0),i=!1},d(e){e&&R(t),e&&n&&n.end()}}}function Ae(e){let t,n,i=e[0]&&je();return{c(){i&&i.c(),t=C()},m(e,s){i&&i.m(e,s),L(e,t,s),n=!0},p(e,[n]){e[0]?i?1&n&&ae(i,1):(i=je(),i.c(),ae(i,1),i.m(t.parentNode,t)):i&&(le(),ue(i,1,1,(()=>{i=null})),ce())},i(e){n||(ae(i),n=!0)},o(e){ue(i),n=!1},d(e){i&&i.d(e),e&&R(t)}}}function Ve(e,t,n){let{visible:i=!1}=t;return e.$$set=e=>{"visible"in e&&n(0,i=e.visible)},[i]}class qe extends ke{constructor(e){super(),ye(this,e,Ve,Ae,r,{visible:0})}}function Me(e){let t;return{c(){t=E("path"),T(t,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),T(t,"class","svelte-1fqh2ri")},m(e,n){L(e,t,n)},d(e){e&&R(t)}}}function Ue(e){let t;return{c(){t=E("path"),T(t,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),T(t,"class","svelte-1fqh2ri")},m(e,n){L(e,t,n)},d(e){e&&R(t)}}}function ze(e){let t,n="en"===e[2]?"Copy ID":"Copier l'ID";return{c(){t=P(n)},m(e,n){L(e,t,n)},p(e,i){4&i&&n!==(n="en"===e[2]?"Copy ID":"Copier l'ID")&&j(t,n)},d(e){e&&R(t)}}}function De(e){let t,n="en"===e[2]?"Copied!":"Copié !";return{c(){t=P(n)},m(e,n){L(e,t,n)},p(e,i){4&i&&n!==(n="en"===e[2]?"Copied!":"Copié !")&&j(t,n)},d(e){e&&R(t)}}}function He(e){let t,n,i,o,r,l,a,u,d,f,g,p,m,h,$,b,v,w,k,x=e[0].title+"";function S(e,t){return e[1]?Ue:Me}let C=S(e),N=C(e);function A(e,t){return e[1]?De:ze}let V=A(e),q=V(e);return{c(){t=O("div"),n=O("figure"),i=O("img"),r=I(),l=O("div"),a=O("span"),u=P(x),f=I(),g=O("button"),p=E("svg"),N.c(),m=I(),h=O("span"),q.c(),c(i.src,o=Ee(e[0].img,e[0].xyhw,e[3]?"96,":"140,"))||T(i,"src",o),T(i,"alt","Extracted region"),T(a,"class","overlay-desc"),T(l,"class","overlay is-center svelte-1fqh2ri"),T(n,"class",d="image card "+(e[3]?"is-96x96":"")+" svelte-1fqh2ri"),T(n,"tabindex","-1"),T(p,"xmlns","http://www.w3.org/2000/svg"),T(p,"viewBox","0 0 384 512"),T(p,"class","svelte-1fqh2ri"),T(h,"class","tooltip svelte-1fqh2ri"),T(g,"class","button region-btn tag svelte-1fqh2ri"),T(t,"class",$="region image is-center "+(e[4](e[0])?"checked":"")+" svelte-1fqh2ri")},m(s,o){L(s,t,o),y(t,n),y(n,i),y(n,r),y(n,l),y(l,a),y(a,u),y(t,f),y(t,g),y(g,p),N.m(p,null),y(g,m),y(g,h),q.m(h,null),v=!0,w||(k=[_(n,"click",e[7]),_(n,"keyup",Fe),_(g,"click",e[8])],w=!0)},p(e,[s]){(!v||9&s&&!c(i.src,o=Ee(e[0].img,e[0].xyhw,e[3]?"96,":"140,")))&&T(i,"src",o),(!v||1&s)&&x!==(x=e[0].title+"")&&j(u,x),(!v||8&s&&d!==(d="image card "+(e[3]?"is-96x96":"")+" svelte-1fqh2ri"))&&T(n,"class",d),C!==(C=S(e))&&(N.d(1),N=C(e),N&&(N.c(),N.m(p,null))),V===(V=A(e))&&q?q.p(e,s):(q.d(1),q=V(e),q&&(q.c(),q.m(h,null))),(!v||17&s&&$!==($="region image is-center "+(e[4](e[0])?"checked":"")+" svelte-1fqh2ri"))&&T(t,"class",$)},i(e){v||(W((()=>{v&&(b||(b=fe(t,Te,{duration:500},!0)),b.run(1))})),v=!0)},o(e){b||(b=fe(t,Te,{duration:500},!1)),b.run(0),v=!1},d(e){e&&R(t),N.d(),q.d(),e&&b&&b.end(),w=!1,s(k)}}}const Fe=()=>null;function Be(e,t,n){let i;const{isSelected:s}=_e;u(e,s,(e=>n(4,i=e)));const o=function(){const e=B();return(t,n,{cancelable:i=!1}={})=>{const s=e.$$.callbacks[t];if(s){const o=q(t,n,{cancelable:i});return s.slice().forEach((t=>{t.call(e,o)})),!o.defaultPrevented}return!0}}();let{item:r}=t,{isCopied:l=!1}=t,{appLang:c="en"}=t,{isSquare:a=!0}=t;function d(){o("copyRef",{item:r})}return e.$$set=e=>{"item"in e&&n(0,r=e.item),"isCopied"in e&&n(1,l=e.isCopied),"appLang"in e&&n(2,c=e.appLang),"isSquare"in e&&n(3,a=e.isSquare)},[r,l,c,a,i,s,d,()=>_e.toggle(r),()=>d()]}class Je extends ke{constructor(e){super(),ye(this,e,Be,He,r,{item:0,isCopied:1,appLang:2,isSquare:3})}}function Xe(t){let n,i,s,o,r,l,c,a,u,d="en"===t[1]?"Selection":"Sélection";return{c(){n=O("div"),i=O("button"),s=O("span"),o=O("i"),r=I(),l=P(d),c=P("\n            ("),a=P(t[0]),u=P(")"),T(o,"class","fa-solid fa-book-bookmark"),T(s,"id","btn-content"),T(i,"id","set-btn"),T(i,"class","button px-5 py-4 is-link js-modal-trigger svelte-hs48f9"),T(i,"data-target","selection-modal"),T(n,"class","set-container svelte-hs48f9")},m(e,t){L(e,n,t),y(n,i),y(i,s),y(s,o),y(s,r),y(s,l),y(s,c),y(s,a),y(s,u)},p(e,[t]){2&t&&d!==(d="en"===e[1]?"Selection":"Sélection")&&j(l,d),1&t&&j(a,e[0])},i:e,o:e,d(e){e&&R(n)}}}function Ke(e,t,n){let{selectionLength:i=0}=t,{appLang:s="en"}=t,o=i;return e.$$set=e=>{"selectionLength"in e&&n(0,i=e.selectionLength),"appLang"in e&&n(1,s=e.appLang)},e.$$.update=()=>{if(5&e.$$.dirty&&i!==o){const e=i>o;n(2,o=i);const t=document.getElementById("btn-content");t&&t.animate([{transform:e?"translateY(-7px)":"translateX(-5px)"},{transform:e?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[i,s,o]}class Ge extends ke{constructor(e){super(),ye(this,e,Ke,Xe,r,{selectionLength:0,appLang:1})}}function Qe(t){let n,i,o,r,l,c,a,u,d,f,g,p="en"===t[0]?"Clear selection":"Vider la sélection",m="en"===t[0]?"Save selection":"Sauvegarder la sélection";return{c(){n=O("footer"),i=O("div"),o=O("button"),r=P(p),l=I(),c=O("button"),a=O("i"),u=I(),d=P(m),T(o,"class","button is-link is-light"),T(a,"class","fa-solid fa-floppy-disk"),T(c,"class","button is-link"),T(i,"class","buttons"),T(n,"class","modal-card-foot is-center")},m(e,s){L(e,n,s),y(n,i),y(i,o),y(o,r),y(i,l),y(i,c),y(c,a),y(c,u),y(c,d),f||(g=[_(o,"click",t[2]),_(c,"click",t[3])],f=!0)},p(e,[t]){1&t&&p!==(p="en"===e[0]?"Clear selection":"Vider la sélection")&&j(r,p),1&t&&m!==(m="en"===e[0]?"Save selection":"Sauvegarder la sélection")&&j(d,m)},i:e,o:e,d(e){e&&R(n),f=!1,s(g)}}}function Ye(e,t,n){let{appLang:i="en"}=t,{isRegion:s=!0}=t;return e.$$set=e=>{"appLang"in e&&n(0,i=e.appLang),"isRegion"in e&&n(1,s=e.isRegion)},[i,s,()=>_e.empty(s),()=>_e.save()]}class We extends ke{constructor(e){super(),ye(this,e,Ye,Qe,r,{appLang:0,isRegion:1})}}function Ze(e){let t,n,i,s,o,r,l,a,u,f,h,$,b,v,w,k,x,S;const E=e[4].default,C=d(E,e,e[3],null);return{c(){t=O("tr"),n=O("th"),i=O("div"),s=O("img"),l=I(),a=O("div"),u=O("a"),f=O("i"),h=P("\n                    Page "),$=P(e[0]),v=I(),w=O("td"),k=O("div"),x=O("div"),C&&C.c(),c(s.src,o=Ee(e[1],"full","250,"))||T(s,"src",o),T(s,"alt",r="Canvas "+e[0]),T(s,"class","mb-3 card"),T(f,"class","fa-solid fa-pen-to-square"),T(u,"class","tag px-2 py-1 is-rounded"),T(u,"href",b=Pe(e[2],e[0])),T(u,"target","_blank"),T(a,"class","is-center mb-1"),T(i,"class","content-wrapper py-5"),T(n,"class","is-3 center-flex is-narrow"),A(n,"width","260px"),T(x,"class","grid is-gap-2"),T(k,"class","fixed-grid has-6-cols"),T(w,"class","p-5 is-fullwidth")},m(e,o){L(e,t,o),y(t,n),y(n,i),y(i,s),y(i,l),y(i,a),y(a,u),y(u,f),y(u,h),y(u,$),y(t,v),y(t,w),y(w,k),y(k,x),C&&C.m(x,null),S=!0},p(e,[t]){(!S||2&t&&!c(s.src,o=Ee(e[1],"full","250,")))&&T(s,"src",o),(!S||1&t&&r!==(r="Canvas "+e[0]))&&T(s,"alt",r),(!S||1&t)&&j($,e[0]),(!S||5&t&&b!==(b=Pe(e[2],e[0])))&&T(u,"href",b),C&&C.p&&(!S||8&t)&&p(C,E,e,e[3],S?g(E,e[3],t,null):m(e[3]),null)},i(e){S||(ae(C,e),S=!0)},o(e){ue(C,e),S=!1},d(e){e&&R(t),C&&C.d(e)}}}function et(e,t,n){let{$$slots:i={},$$scope:s}=t,{canvasNb:o}=t,{canvasImg:r}=t,{manifest:l}=t;return e.$$set=e=>{"canvasNb"in e&&n(0,o=e.canvasNb),"canvasImg"in e&&n(1,r=e.canvasImg),"manifest"in e&&n(2,l=e.manifest),"$$scope"in e&&n(3,s=e.$$scope)},[o,r,l,s,i]}class tt extends ke{constructor(e){super(),ye(this,e,et,Ze,r,{canvasNb:0,canvasImg:1,manifest:2})}}function nt(e){let t,n,i,s,o,r,l=e[1]-1>1&&it(e);return{c(){t=O("li"),n=O("a"),n.textContent="1",i=I(),l&&l.c(),s=C(),T(n,"class","pagination-link"),T(n,"href",null)},m(c,a){L(c,t,a),y(t,n),L(c,i,a),l&&l.m(c,a),L(c,s,a),o||(r=_(n,"click",N(e[5])),o=!0)},p(e,t){e[1]-1>1?l?l.p(e,t):(l=it(e),l.c(),l.m(s.parentNode,s)):l&&(l.d(1),l=null)},d(e){e&&R(t),e&&R(i),l&&l.d(e),e&&R(s),o=!1,r()}}}function it(e){let t,n,i,s,o,r,l,c=e[1]-1+"";return{c(){t=O("li"),t.innerHTML='<span class="pagination-ellipsis">…</span>',n=I(),i=O("li"),s=O("a"),o=P(c),T(s,"class","pagination-link"),T(s,"href",null)},m(c,a){L(c,t,a),L(c,n,a),L(c,i,a),y(i,s),y(s,o),r||(l=_(s,"click",N(e[6])),r=!0)},p(e,t){2&t&&c!==(c=e[1]-1+"")&&j(o,c)},d(e){e&&R(t),e&&R(n),e&&R(i),r=!1,l()}}}function st(e){let t,n,i,s,o,r=e[1]+1<e[3]&&ot(e);return{c(){r&&r.c(),t=I(),n=O("li"),i=O("a"),i.textContent=`${e[3]}`,T(i,"class","pagination-link"),T(i,"href",null)},m(l,c){r&&r.m(l,c),L(l,t,c),L(l,n,c),y(n,i),s||(o=_(i,"click",N(e[9])),s=!0)},p(e,n){e[1]+1<e[3]?r?r.p(e,n):(r=ot(e),r.c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null)},d(e){r&&r.d(e),e&&R(t),e&&R(n),s=!1,o()}}}function ot(e){let t,n,i,s,o,r,l,c=e[1]+1+"";return{c(){t=O("li"),n=O("a"),i=P(c),s=I(),o=O("li"),o.innerHTML='<span class="pagination-ellipsis">…</span>',T(n,"class","pagination-link"),T(n,"href",null)},m(c,a){L(c,t,a),y(t,n),y(n,i),L(c,s,a),L(c,o,a),r||(l=_(n,"click",N(e[8])),r=!0)},p(e,t){2&t&&c!==(c=e[1]+1+"")&&j(i,c)},d(e){e&&R(t),e&&R(s),e&&R(o),r=!1,l()}}}function rt(t){let n,i=t[3]>1&&function(e){let t,n,i,s,o,r,l,c,a,u=e[1]>1&&nt(e),d=e[1]<e[3]&&st(e);return{c(){t=O("nav"),n=O("ul"),u&&u.c(),i=I(),s=O("li"),o=O("a"),r=P(e[1]),l=I(),d&&d.c(),T(o,"class","pagination-link is-current"),T(o,"href",null),T(n,"class","pagination-list"),T(t,"class","pagination is-centered"),T(t,"aria-label","pagination")},m(f,g){L(f,t,g),y(t,n),u&&u.m(n,null),y(n,i),y(n,s),y(s,o),y(o,r),y(n,l),d&&d.m(n,null),c||(a=_(o,"click",N(e[7])),c=!0)},p(e,t){e[1]>1?u?u.p(e,t):(u=nt(e),u.c(),u.m(n,i)):u&&(u.d(1),u=null),2&t&&j(r,e[1]),e[1]<e[3]?d?d.p(e,t):(d=st(e),d.c(),d.m(n,null)):d&&(d.d(1),d=null)},d(e){e&&R(t),u&&u.d(),d&&d.d(),c=!1,a()}}}(t);return{c(){i&&i.c(),n=C()},m(e,t){i&&i.m(e,t),L(e,n,t)},p(e,[t]){e[3]>1&&i.p(e,t)},i:e,o:e,d(e){i&&i.d(e),e&&R(n)}}}function lt(e,t,n){let i,{store:s}=t;const{currentPage:o}=s;u(e,o,(e=>n(1,i=e)));let{nbOfPages:r}=t;const l=Math.ceil(r/50);return e.$$set=e=>{"store"in e&&n(0,s=e.store),"nbOfPages"in e&&n(4,r=e.nbOfPages)},[s,i,o,l,r,()=>s.handlePageUpdate(1),()=>s.handlePageUpdate(i-1),()=>s.handlePageUpdate(i),()=>s.handlePageUpdate(i+1),()=>s.handlePageUpdate(l)]}class ct extends ke{constructor(e){super(),ye(this,e,lt,rt,r,{store:0,nbOfPages:4})}}function at(t){let n,i,s,o,r,l,c,a,u,d,f,g,p,m,h,$,b="en"===t[0]?"Cancel":"Annuler";return{c(){n=O("button"),i=I(),s=O("div"),o=O("div"),r=I(),l=O("div"),c=O("div"),c.innerHTML='<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div> \n            <button class="delete media-left" aria-label="close"></button>',a=I(),u=O("section"),d=I(),f=O("footer"),g=O("div"),p=O("button"),m=P(b),h=I(),$=O("button"),$.textContent="OK",T(n,"id","hidden-msg-btn"),T(n,"class","js-modal-trigger"),T(n,"data-target","msg-modal"),n.hidden=!0,T(o,"id","modal-bkg"),T(o,"class","modal-background"),T(c,"class","modal-card-head media mb-0"),T(u,"id","modal-body"),T(u,"class","modal-card-body"),T(p,"id","cancel-btn"),T(p,"class","button is-link is-light"),T($,"id","ok-btn"),T($,"class","button is-link"),T(g,"class","buttons"),T(f,"id","modal-footer"),T(f,"class","modal-card-foot is-center pt-3"),f.hidden=!0,T(l,"class","modal-content"),T(s,"id","msg-modal"),T(s,"class","modal fade"),T(s,"tabindex","-1"),T(s,"aria-labelledby","selection-modal-label"),T(s,"aria-hidden","true")},m(e,t){L(e,n,t),L(e,i,t),L(e,s,t),y(s,o),y(s,r),y(s,l),y(l,c),y(l,a),y(l,u),y(l,d),y(l,f),y(f,g),y(g,p),y(p,m),y(g,h),y(g,$)},p(e,[t]){1&t&&b!==(b="en"===e[0]?"Cancel":"Annuler")&&j(m,b)},i:e,o:e,d(e){e&&R(n),e&&R(i),e&&R(s)}}}function ut(e,t,n){let{appLang:i="en"}=t;return e.$$set=e=>{"appLang"in e&&n(0,i=e.appLang)},[i]}class dt extends ke{constructor(e){super(),ye(this,e,ut,at,r,{appLang:0})}}function ft(e){let t,n,i="en"===e[0]?"Automatic region extraction":"Extraction automatique des régions";return{c(){t=O("button"),n=P(i),T(t,"class","button is-link is-inverted")},m(e,i){L(e,t,i),y(t,n)},p(e,t){1&t&&i!==(i="en"===e[0]?"Automatic region extraction":"Extraction automatique des régions")&&j(n,i)},d(e){e&&R(t)}}}function gt(t){let n,i,s,o,r,l,c,a,u,d="en"===t[0]?"Manually annotate":"Annoter manuellement",f="en"===t[0]?"Import regions file":"Importer un fichier de région",g=t[1].includes("regions"),p=g&&ft(t);return{c(){n=O("div"),i=O("button"),s=P(d),o=I(),r=O("button"),l=P(f),c=I(),p&&p.c(),T(i,"class","button is-link"),T(r,"class","button is-link is-light"),T(n,"class","is-center buttons is-centered pt-5")},m(e,d){L(e,n,d),y(n,i),y(i,s),y(n,o),y(n,r),y(r,l),y(n,c),p&&p.m(n,null),a||(u=_(i,"click",t[2]),a=!0)},p(e,[t]){1&t&&d!==(d="en"===e[0]?"Manually annotate":"Annoter manuellement")&&j(s,d),1&t&&f!==(f="en"===e[0]?"Import regions file":"Importer un fichier de région")&&j(l,f),2&t&&(g=e[1].includes("regions")),g?p?p.p(e,t):(p=ft(e),p.c(),p.m(n,null)):p&&(p.d(1),p=null)},i:e,o:e,d(e){e&&R(n),p&&p.d(),a=!1,u()}}}function pt(e,t,n){let{appLang:i="en"}=t,{modules:s=[]}=t,{witness:o={}}=t,{currentRegionId:r}=t,{baseUrl:l}=t;return e.$$set=e=>{"appLang"in e&&n(0,i=e.appLang),"modules"in e&&n(1,s=e.modules),"witness"in e&&n(3,o=e.witness),"currentRegionId"in e&&n(4,r=e.currentRegionId),"baseUrl"in e&&n(5,l=e.baseUrl)},[i,s,async function(){const e=window.location.origin;let t=`${e}/witness/${o.id}/regions/add`;if(1===o.regions.length||r){const n=r||o.regions[0];t=`${e}/witness/${o.id}/regions/${n}/add`}const n=await Oe((()=>fetch(t,{method:"POST",headers:{"X-CSRFToken":CSRF_TOKEN}})));if(!n.ok)throw await Ie(`Failed to create regions: '${n.statusText}'`,"Error"),new Error(`Failed to create regions: '${n.statusText}'`);let i;try{i=await n.json()}catch(e){throw await Ie(`Failed to parse JSON response: '${e}'`,"Error"),new Error(`Failed to parse JSON response: '${e}'`)}console.log(i),i.hasOwnProperty("mirador_url")&&window.open(i.mirador_url),i.hasOwnProperty("regions_id")&&(window.location.href=`${l.split("regions/")[0]}regions/${i.regions_id}`)},o,r,l]}class mt extends ke{constructor(e){super(),ye(this,e,pt,gt,r,{appLang:0,modules:1,witness:3,currentRegionId:4,baseUrl:5})}}function ht(e,t,n){const i=e.slice();return i[5]=t[n],i}function $t(e){let t,n=e[0].regions,i=[];for(let t=0;t<n.length;t+=1)i[t]=vt(ht(e,n,t));return{c(){for(let e=0;e<i.length;e+=1)i[e].c();t=C()},m(e,n){for(let t=0;t<i.length;t+=1)i[t]&&i[t].m(e,n);L(e,t,n)},p(e,s){if(5&s){let o;for(n=e[0].regions,o=0;o<n.length;o+=1){const r=ht(e,n,o);i[o]?i[o].p(r,s):(i[o]=vt(r),i[o].c(),i[o].m(t.parentNode,t))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}},d(e){S(i,e),e&&R(t)}}}function bt(e){let t,n,i,s,o="en"===e[1]?"Delete regions record":"Supprimer l'intégralité des régions";return{c(){t=O("button"),n=P(o),T(t,"class","tag is-danger")},m(o,r){L(o,t,r),y(t,n),i||(s=_(t,"click",e[4]),i=!0)},p(e,t){2&t&&o!==(o="en"===e[1]?"Delete regions record":"Supprimer l'intégralité des régions")&&j(n,o)},d(e){e&&R(t),i=!1,s()}}}function vt(e){let t,n,i,s,o=e[5]+"";return{c(){t=O("a"),n=P("Regions #"),i=P(o),T(t,"href",s=""+(e[2]+e[5])),T(t,"class","tag is-dark mr-3 is-rounded")},m(e,s){L(e,t,s),y(t,n),y(t,i)},p(e,n){1&n&&o!==(o=e[5]+"")&&j(i,o),5&n&&s!==(s=""+(e[2]+e[5]))&&T(t,"href",s)},d(e){e&&R(t)}}}function wt(t){let n;function i(e,t){return e[3]?bt:$t}let s=i(t),o=s(t);return{c(){n=O("div"),o.c(),T(n,"class","is-right")},m(e,t){L(e,n,t),o.m(n,null)},p(e,[t]){s===(s=i(e))&&o?o.p(e,t):(o.d(1),o=s(e),o&&(o.c(),o.m(n,null)))},i:e,o:e,d(e){e&&R(n),o.d()}}}function yt(e,t,n){let{witness:i}=t,{appLang:s="en"}=t,{baseUrl:o=`${window.location.origin}${window.location.pathname}`}=t,{currentRegionId:r}=t;return e.$$set=e=>{"witness"in e&&n(0,i=e.witness),"appLang"in e&&n(1,s=e.appLang),"baseUrl"in e&&n(2,o=e.baseUrl),"currentRegionId"in e&&n(3,r=e.currentRegionId)},[i,s,o,r,async function(){if(!await Ie("en"===s?"Are you sure you want to delete this record?":"Voulez-vous vraiment supprimer cet enregistrement?","en"===s?"Confirm deletion":"Confirmer la suppression",!0))return;if("number"!=typeof r)throw new Error("Invalid region ID");const e=`${window.location.origin}/regions/${r}/delete`;try{const t=await Oe((()=>fetch(e,{method:"DELETE",headers:{"X-CSRFToken":CSRF_TOKEN}})));if(204!==t.status)throw new Error(`Failed to delete regions: '${t.statusText}'`);window.location.href=`${o.split("regions/")[0]}regions/`}catch(e){console.error(e)}}]}class kt extends ke{constructor(e){super(),ye(this,e,yt,wt,r,{witness:0,appLang:1,baseUrl:2,currentRegionId:3})}}function xt(e){let t;return{c(){t=E("path"),T(t,"d","M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"),T(t,"class","svelte-h0t5l9")},m(e,n){L(e,t,n)},d(e){e&&R(t)}}}function Lt(e){let t;return{c(){t=E("path"),T(t,"d","M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"),T(t,"class","svelte-h0t5l9")},m(e,n){L(e,t,n)},d(e){e&&R(t)}}}function Rt(e){let t,n="en"===e[0]?"Edit":"Modifier";return{c(){t=P(n)},m(e,n){L(e,t,n)},p(e,i){1&i&&n!==(n="en"===e[0]?"Edit":"Modifier")&&j(t,n)},d(e){e&&R(t)}}}function St(e){let t,n="en"===e[0]?"Validate":"Valider";return{c(){t=P(n)},m(e,n){L(e,t,n)},p(e,i){1&i&&n!==(n="en"===e[0]?"Validate":"Valider")&&j(t,n)},d(e){e&&R(t)}}}function Ot(e){let t;return{c(){t=E("path"),T(t,"d","m10.6 16.2l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21z"),T(t,"class","svelte-h0t5l9")},m(e,n){L(e,t,n)},d(e){e&&R(t)}}}function Et(e){let t;return{c(){t=E("path"),T(t,"d","m10.6 16.2l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21zm0-2h14V5H5zM5 5v14z"),T(t,"class","svelte-h0t5l9")},m(e,n){L(e,t,n)},d(e){e&&R(t)}}}function Pt(e){let t,n,i,o,r,l,c,a,u,d,f,g,p,m,h,$,b,v="en"===e[0]?"Reload":"Recharger",w="en"===e[0]?"Go to editor":"Aller à l'éditeur",k="en"===e[0]?"Delete selected regions":"Supprimer les régions sélectionnées";return{c(){t=O("button"),n=O("i"),i=I(),o=P(v),r=I(),l=O("a"),c=O("i"),a=I(),u=P(w),f=I(),g=O("button"),p=O("i"),m=I(),h=P(k),T(n,"class","fa-solid fa-rotate-right"),T(t,"class","tag is-link is-light is-rounded mr-3"),T(c,"class","fa-solid fa-edit"),T(l,"class","tag is-link is-rounded mr-3"),T(l,"href",d=Pe(e[1])),T(l,"target","_blank"),T(p,"class","fa-solid fa-trash"),T(g,"class","tag is-danger is-rounded")},m(s,d){L(s,t,d),y(t,n),y(t,i),y(t,o),L(s,r,d),L(s,l,d),y(l,c),y(l,a),y(l,u),L(s,f,d),L(s,g,d),y(g,p),y(g,m),y(g,h),$||(b=[_(t,"click",e[18]),_(g,"click",e[8])],$=!0)},p(e,t){1&t&&v!==(v="en"===e[0]?"Reload":"Recharger")&&j(o,v),1&t&&w!==(w="en"===e[0]?"Go to editor":"Aller à l'éditeur")&&j(u,w),2&t&&d!==(d=Pe(e[1]))&&T(l,"href",d),1&t&&k!==(k="en"===e[0]?"Delete selected regions":"Supprimer les régions sélectionnées")&&j(h,k)},d(e){e&&R(t),e&&R(r),e&&R(l),e&&R(f),e&&R(g),$=!1,s(b)}}}function It(t){let n,i,o,r,l,c,a,u,d,f,g,p,m,h,$,b,v,w,k,x,S,C,N="en"===t[0]?"Select all":"Tout sélectionner",A="en"===t[0]?"Download":"Télécharger";function V(e,t){return e[3]?Lt:xt}let q=V(t),M=q(t);function U(e,t){return e[3]?St:Rt}let z=U(t),D=z(t);function H(e,t){return e[2]?Et:Ot}let F=H(t),B=F(t),J=t[3]&&Pt(t);return{c(){n=O("div"),i=O("button"),o=E("svg"),M.c(),r=I(),D.c(),c=I(),a=O("button"),u=E("svg"),B.c(),d=I(),f=O("i"),g=I(),p=O("span"),m=P(N),h=I(),$=O("button"),b=O("i"),v=I(),w=P(A),k=I(),x=O("div"),J&&J.c(),T(o,"xmlns","http://www.w3.org/2000/svg"),T(o,"viewBox","0 0 384 512"),T(o,"class","pr-3 svelte-h0t5l9"),T(i,"class",l="button "+(t[3]?"is-success":"is-link")+" mr-3"),T(u,"xmlns","http://www.w3.org/2000/svg"),T(u,"viewBox","0 0 448 512"),T(u,"class","svelte-h0t5l9"),T(f,"class","fa-solid fa-square-check"),T(p,"id","all-selection"),T(a,"class","button is-link is-light mr-3"),T(b,"class","fa-solid fa-download"),T($,"class","button is-link is-light"),T(n,"class","is-left mb-3"),T(x,"class","edit-action is-left svelte-h0t5l9")},m(e,s){L(e,n,s),y(n,i),y(i,o),M.m(o,null),y(i,r),D.m(i,null),y(n,c),y(n,a),y(a,u),B.m(u,null),y(a,d),y(a,f),y(a,g),y(a,p),y(p,m),y(n,h),y(n,$),y($,b),y($,v),y($,w),L(e,k,s),L(e,x,s),J&&J.m(x,null),S||(C=[_(i,"click",t[17]),_(a,"click",t[9]),_($,"click",t[10])],S=!0)},p(e,[t]){q!==(q=V(e))&&(M.d(1),M=q(e),M&&(M.c(),M.m(o,null))),z===(z=U(e))&&D?D.p(e,t):(D.d(1),D=z(e),D&&(D.c(),D.m(i,null))),8&t&&l!==(l="button "+(e[3]?"is-success":"is-link")+" mr-3")&&T(i,"class",l),F!==(F=H(e))&&(B.d(1),B=F(e),B&&(B.c(),B.m(u,null))),1&t&&N!==(N="en"===e[0]?"Select all":"Tout sélectionner")&&j(m,N),1&t&&A!==(A="en"===e[0]?"Download":"Télécharger")&&j(w,A),e[3]?J?J.p(e,t):(J=Pt(e),J.c(),J.m(x,null)):J&&(J.d(1),J=null)},i:e,o:e,d(e){e&&R(n),M.d(),D.d(),B.d(),e&&R(k),e&&R(x),J&&J.d(),S=!1,s(C)}}}async function Ct(e){const t=SAS_APP_URL.replace("https","http"),n=`${SAS_APP_URL}/annotation/destroy?uri=${t}/annotation/${e}`,i=await fetch(n,{method:"DELETE"});if(204!==i.status)throw new Error(`Failed to delete ${n} due to ${i.status}: '${i.statusText}'`)}function _t(e,t,n){let i,s,o,r,l,c,a;const{selected:d,nbSelected:f}=_e;u(e,d,(e=>n(14,l=e))),u(e,f,(e=>n(16,a=e)));const{allRegions:g}=Ne;u(e,g,(e=>n(15,c=e)));let{appLang:p}=t,{manifest:m}=t,{isValidated:h}=t,{regionsType:$}=t;function b(){n(3,s=!s)}return e.$$set=e=>{"appLang"in e&&n(0,p=e.appLang),"manifest"in e&&n(1,m=e.manifest),"isValidated"in e&&n(11,h=e.isValidated),"regionsType"in e&&n(12,$=e.regionsType)},e.$$.update=()=>{65536&e.$$.dirty&&n(13,i=a(!0)),2048&e.$$.dirty&&n(3,s=!h),16384&e.$$.dirty&&(o=l(!0)),40960&e.$$.dirty&&n(2,r=i>=Object.keys(c).length)},[p,m,r,s,d,f,g,b,async function(){if(await Ie("en"===p?"Are you sure you want to delete regions?":"Voulez-vous vraiment supprimer les régions?","en"===p?"Confirm deletion":"Confirmer la suppression",!0))for(const e of Object.keys(o))try{if(!c.hasOwnProperty(e))continue;await Ct(e),Ne.remove(e),_e.remove(e,$)}catch(t){await Ie(`Failed to delete region ${e}: ${t.message}`,"Error")}},function(){r?_e.removeAll(Object.keys(c),$):_e.addAll(Object.values(c))},async function(){const e=Object.values(l(!0)).map((e=>e.ref)),t=await Oe((()=>fetch(`${window.location.origin}/regions/export`,{method:"POST",headers:{"X-CSRFToken":CSRF_TOKEN},body:JSON.stringify({regionsRef:e})})));!function(e,t){const n=window.URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=`${t}`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(n),document.body.removeChild(i)}(await t.blob(),"regions.zip")},h,$,i,l,c,a,()=>b(),()=>location.reload()]}class Nt extends ke{constructor(e){super(),ye(this,e,_t,It,r,{appLang:0,manifest:1,isValidated:11,regionsType:12})}}const Tt=function(){const e=`${window.location.origin}${window.location.pathname}`,t=Le(1),n=Le(0),i=Le({}),s=Le([]),o=Le([]),r=Le({}),l=Le({});if("undefined"!=typeof window){const e=parseInt(new URLSearchParams(window.location.search).get("sp"));isNaN(e)?t.set(1):t.set(e)}const c=(async()=>{const t=await fetch(`${e}similar-regions`).then((e=>e.json())).then((e=>(i.set(e),e))).catch((e=>console.error("Error:",e))),o=await fetch(`${e}query-images`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":CSRF_TOKEN},body:JSON.stringify({regionsRefs:Object.keys(t)})}).then((e=>e.json())).then((e=>{s.set(e)}));return n.set(Math.ceil(o.length/50)),await a(),o})(),a=async()=>{const t=await fetch(`${e}similarity-page`,{method:"POST",body:JSON.stringify({regionsIds:Object.keys(get(l)),pageImgs:get(o)}),headers:{"Content-Type":"application/json","X-CSRFToken":CSRF_TOKEN}}),n=await t.json();return r.set(n),n},u=Re(t,(e=>async()=>await a()));return{currentPage:t,nbOfPage:n,comparedRegions:i,qImgs:s,pageQImgs:o,pageSImgs:r,selectedRegions:l,fetchPage:u,fetchSimilarity:c,getSimilarImg:function(e){return get(r)[e]},getRegionsInfo:function(e){return`TODO: ${e}`},handlePageUpdate:function(e){const n=50*(e-1),i=n+50;if(o.set(get(s).slice(n,i)),t.set(e),"undefined"!=typeof window){const t=new URL(window.location.href);t.searchParams.set("sp",e),window.history.pushState({},"",t)}},unselect:function(e){l.update((t=>(delete t[e],{...t})))},select:function(e){l.update((t=>(t[e.id]=e,e)))}}}();function jt(e){let t,n,i;const s=e[1].default,o=d(s,e,e[0],null);return{c(){t=O("table"),n=O("tbody"),o&&o.c(),T(t,"class","table is-fullwidth")},m(e,s){L(e,t,s),y(t,n),o&&o.m(n,null),i=!0},p(e,[t]){o&&o.p&&(!i||1&t)&&p(o,s,e,e[0],i?g(s,e[0],t,null):m(e[0]),null)},i(e){i||(ae(o,e),i=!0)},o(e){ue(o,e),i=!1},d(e){e&&R(t),o&&o.d(e)}}}function At(e,t,n){let{$$slots:i={},$$scope:s}=t;return e.$$set=e=>{"$$scope"in e&&n(0,s=e.$$scope)},[s,i]}class Vt extends ke{constructor(e){super(),ye(this,e,At,jt,r,{})}}function qt(e){let t,n,i,s,o,r,l,c,a;const u=e[2].default,f=d(u,e,e[1],null);return{c(){t=O("tr"),n=O("th"),i=O("div"),s=P(e[0]),o=I(),r=O("td"),l=O("div"),c=O("div"),f&&f.c(),T(i,"class","content-wrapper py-5"),T(n,"class","is-3 center-flex is-narrow"),A(n,"width","260px"),T(c,"class","grid is-gap-2"),T(l,"class","fixed-grid has-6-cols"),T(r,"class","p-5 is-fullwidth")},m(e,u){L(e,t,u),y(t,n),y(n,i),y(i,s),y(t,o),y(t,r),y(r,l),y(l,c),f&&f.m(c,null),a=!0},p(e,[t]){(!a||1&t)&&j(s,e[0]),f&&f.p&&(!a||2&t)&&p(f,u,e,e[1],a?g(u,e[1],t,null):m(e[1]),null)},i(e){a||(ae(f,e),a=!0)},o(e){ue(f,e),a=!1},d(e){e&&R(t),f&&f.d(e)}}}function Mt(e,t,n){let{$$slots:i={},$$scope:s}=t,{qImg:o}=t;return e.$$set=e=>{"qImg"in e&&n(0,o=e.qImg),"$$scope"in e&&n(1,s=e.$$scope)},[o,s,i]}class Ut extends ke{constructor(e){super(),ye(this,e,Mt,qt,r,{qImg:0})}}function zt(e){let t,n,i,s,o,r,l,a,u,d,f=e[0](`${e[2]}_${e[3]}`).title+"";return{c(){t=O("div"),n=O("figure"),i=O("img"),o=I(),r=O("div"),l=O("span"),a=P(f),c(i.src,s=Ee(e[5],e[4],"140,"))||T(i,"src",s),T(i,"alt","Similar region"),T(l,"class","overlay-desc"),T(r,"class","overlay is-center svelte-fw1kqn"),T(n,"class","image card svelte-fw1kqn"),T(n,"tabindex","-1"),T(t,"class","region image is-center svelte-fw1kqn")},m(e,s){L(e,t,s),y(t,n),y(n,i),y(n,o),y(n,r),y(r,l),y(l,a),d=!0},p(e,[t]){(!d||1&t)&&f!==(f=e[0](`${e[2]}_${e[3]}`).title+"")&&j(a,f)},i(e){d||(W((()=>{d&&(u||(u=fe(t,Te,{duration:500},!0)),u.run(1))})),d=!0)},o(e){u||(u=fe(t,Te,{duration:500},!1)),u.run(0),d=!1},d(e){e&&R(t),e&&u&&u.end()}}}function Dt(e,t,n){let i;const{getRegionsInfo:s}=Tt;u(e,s,(e=>n(0,i=e)));let{sImg:o}=t;const[r,l,c,a]=o.split("_"),d=`${r}_${l}_${c}`;return e.$$set=e=>{"sImg"in e&&n(6,o=e.sImg)},[i,s,r,l,a,d,o]}class Ht extends ke{constructor(e){super(),ye(this,e,Dt,zt,r,{sImg:6})}}function Ft(e,t,n){const i=e.slice();return i[10]=t[n],i}function Bt(e,t,n){const i=e.slice();return i[13]=t[n][0],i[14]=t[n][1],i}function Jt(e){let t,n;return t=new Vt({props:{$$slots:{default:[Xt]},$$scope:{ctx:e}}}),{c(){$e(t.$$.fragment)},m(e,i){be(t,e,i),n=!0},p(e,n){const i={};262144&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(ae(t.$$.fragment,e),n=!0)},o(e){ue(t.$$.fragment,e),n=!1},d(e){ve(t,e)}}}function Xt(t){let n,i,s,o=t[17]+"";return{c(){n=O("tr"),i=P("Error when retrieving similarities: "),s=P(o)},m(e,t){L(e,n,t),y(n,i),y(n,s)},p:e,d(e){e&&R(n)}}}function Kt(e){let t,n;return t=new Vt({props:{$$slots:{default:[nn]},$$scope:{ctx:e}}}),{c(){$e(t.$$.fragment)},m(e,i){be(t,e,i),n=!0},p(e,n){const i={};262157&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(ae(t.$$.fragment,e),n=!0)},o(e){ue(t.$$.fragment,e),n=!1},d(e){ve(t,e)}}}function Gt(e){let t,n,i,s="en"===e[0]?"No similarity":"Pas de similarités";return{c(){t=O("tr"),n=P(s),i=I(),T(t,"class","faded is-center")},m(e,s){L(e,t,s),y(t,n),L(e,i,s)},p(e,t){1&t&&s!==(s="en"===e[0]?"No similarity":"Pas de similarités")&&j(n,s)},d(e){e&&R(t),e&&R(i)}}}function Qt(t){let n,i,s,o=t[17]+"";return{c(){n=O("tr"),i=P("Error when retrieving similar regions: "),s=P(o)},m(e,t){L(e,n,t),y(n,i),y(n,s)},p:e,i:e,o:e,d(e){e&&R(n)}}}function Yt(e){let t,n,i=e[3](e[10]),s=[];for(let t=0;t<i.length;t+=1)s[t]=Wt(Bt(e,i,t));const o=e=>ue(s[e],1,1,(()=>{s[e]=null}));return{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=C()},m(e,i){for(let t=0;t<s.length;t+=1)s[t]&&s[t].m(e,i);L(e,t,i),n=!0},p(e,n){if(13&n){let r;for(i=e[3](e[10]),r=0;r<i.length;r+=1){const o=Bt(e,i,r);s[r]?(s[r].p(o,n),ae(s[r],1)):(s[r]=Wt(o),s[r].c(),ae(s[r],1),s[r].m(t.parentNode,t))}for(le(),r=i.length;r<s.length;r+=1)o(r);ce()}},i(e){if(!n){for(let e=0;e<i.length;e+=1)ae(s[e]);n=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)ue(s[e]);n=!1},d(e){S(s,e),e&&R(t)}}}function Wt(e){let t,n;return t=new Ht({props:{sImg:e[13],score:e[14],appLang:e[0]}}),{c(){$e(t.$$.fragment)},m(e,i){be(t,e,i),n=!0},p(e,n){const i={};12&n&&(i.sImg=e[13]),12&n&&(i.score=e[14]),1&n&&(i.appLang=e[0]),t.$set(i)},i(e){n||(ae(t.$$.fragment,e),n=!0)},o(e){ue(t.$$.fragment,e),n=!1},d(e){ve(t,e)}}}function Zt(t){let n,i,s="en"===t[0]?"Retrieving similar regions...":"Récupération des régions similaires...";return{c(){n=O("tr"),i=P(s),T(n,"class","faded is-center")},m(e,t){L(e,n,t),y(n,i)},p(e,t){1&t&&s!==(s="en"===e[0]?"Retrieving similar regions...":"Récupération des régions similaires...")&&j(i,s)},i:e,o:e,d(e){e&&R(n)}}}function en(e){let t,n,i={ctx:e,current:null,token:null,hasCatch:!0,pending:Zt,then:Yt,catch:Qt,value:9,error:17,blocks:[,,,]};return ge(e[5],i),{c(){i.block.c(),t=I()},m(e,s){i.block.m(e,i.anchor=s),i.mount=()=>t.parentNode,i.anchor=t,L(e,t,s),n=!0},p(t,n){pe(i,e=t,n)},i(e){n||(ae(i.block),n=!0)},o(e){for(let e=0;e<3;e+=1){ue(i.blocks[e])}n=!1},d(e){i.block.d(e),i.token=null,i=null,e&&R(t)}}}function tn(e,t){let n,i,s;return i=new Ut({props:{qImg:t[10],appLang:t[0],$$slots:{default:[en]},$$scope:{ctx:t}}}),{key:e,first:null,c(){n=C(),$e(i.$$.fragment),this.first=n},m(e,t){L(e,n,t),be(i,e,t),s=!0},p(e,n){t=e;const s={};4&n&&(s.qImg=t[10]),1&n&&(s.appLang=t[0]),262157&n&&(s.$$scope={dirty:n,ctx:t}),i.$set(s)},i(e){s||(ae(i.$$.fragment,e),s=!0)},o(e){ue(i.$$.fragment,e),s=!1},d(e){e&&R(n),ve(i,e)}}}function nn(e){let t,n,i=[],s=new Map,o=Object.values(e[2]);const r=e=>e[10].id;for(let t=0;t<o.length;t+=1){let n=Ft(e,o,t),l=r(n);s.set(l,i[t]=tn(l,n))}let l=null;return o.length||(l=Gt(e)),{c(){for(let e=0;e<i.length;e+=1)i[e].c();t=C(),l&&l.c()},m(e,s){for(let t=0;t<i.length;t+=1)i[t]&&i[t].m(e,s);L(e,t,s),l&&l.m(e,s),n=!0},p(e,n){45&n&&(o=Object.values(e[2]),le(),i=he(i,n,r,1,e,o,s,t.parentNode,me,tn,t,Ft),ce(),!o.length&&l?l.p(e,n):o.length?l&&(l.d(1),l=null):(l=Gt(e),l.c(),l.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<o.length;e+=1)ae(i[e]);n=!0}},o(e){for(let e=0;e<i.length;e+=1)ue(i[e]);n=!1},d(e){for(let t=0;t<i.length;t+=1)i[t].d(e);e&&R(t),l&&l.d(e)}}}function sn(e){let t,n;return t=new Vt({props:{$$slots:{default:[on]},$$scope:{ctx:e}}}),{c(){$e(t.$$.fragment)},m(e,i){be(t,e,i),n=!0},p(e,n){const i={};262145&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(ae(t.$$.fragment,e),n=!0)},o(e){ue(t.$$.fragment,e),n=!1},d(e){ve(t,e)}}}function on(e){let t,n,i="en"===e[0]?"Retrieving similarities...":"Récupération des similarités...";return{c(){t=O("tr"),n=P(i),T(t,"class","faded is-center")},m(e,i){L(e,t,i),y(t,n)},p(e,t){1&t&&i!==(i="en"===e[0]?"Retrieving similarities...":"Récupération des similarités...")&&j(n,i)},d(e){e&&R(t)}}}function rn(e){let t,n,i,s;t=new ct({props:{store:Tt,$nbOfPages:e[1]}});let o={ctx:e,current:null,token:null,hasCatch:!0,pending:sn,then:Kt,catch:Jt,value:9,error:17,blocks:[,,,]};return ge(e[4],o),{c(){$e(t.$$.fragment),n=I(),i=C(),o.block.c()},m(e,r){be(t,e,r),L(e,n,r),L(e,i,r),o.block.m(e,o.anchor=r),o.mount=()=>i.parentNode,o.anchor=i,s=!0},p(n,[i]){e=n;const s={};2&i&&(s.$nbOfPages=e[1]),t.$set(s),pe(o,e,i)},i(e){s||(ae(t.$$.fragment,e),ae(o.block),s=!0)},o(e){ue(t.$$.fragment,e);for(let e=0;e<3;e+=1){ue(o.blocks[e])}s=!1},d(e){ve(t,e),e&&R(n),e&&R(i),o.block.d(e),o.token=null,o=null}}}function ln(e,t,n){let i,s,o;const{fetchSimilarity:r,fetchSimilarityPage:l,nbOfPages:c,pageQImgs:a,getSimilarImg:d}=Tt;u(e,c,(e=>n(1,i=e))),u(e,a,(e=>n(2,s=e))),u(e,d,(e=>n(3,o=e)));let{appLang:f="en"}=t;return e.$$set=e=>{"appLang"in e&&n(0,f=e.appLang)},[f,i,s,o,r,l,c,a,d]}class cn extends ke{constructor(e){super(),ye(this,e,ln,rn,r,{appLang:0})}}function an(e,t,n){const i=e.slice();return i[32]=t[n][0],i[33]=t[n][1],i}function un(e,t,n){const i=e.slice();return i[41]=t[n][0],i[42]=t[n][1],i}function dn(e,t,n){const i=e.slice();return i[37]=t[n],i}function fn(e,t,n){const i=e.slice();return i[37]=t[n],i}function gn(e,t,n){const i=e.slice();return i[47]=t[n][0],i[33]=t[n][1],i}function pn(e){let t,n,i,o,r,l,c=e[33].text+"";function a(){return e[29](e[47])}return{c(){t=O("li"),n=O("a"),i=P(c),o=I(),T(n,"href",null),V(t,"is-active",e[47]===e[11])},m(e,s){L(e,t,s),y(t,n),y(n,i),y(t,o),r||(l=[_(t,"click",a),_(t,"keyup",Vn)],r=!0)},p(n,s){e=n,512&s[0]&&c!==(c=e[33].text+"")&&j(i,c),2560&s[0]&&V(t,"is-active",e[47]===e[11])},d(e){e&&R(t),r=!1,s(l)}}}function mn(t){let n;return{c(){n=O("div"),n.textContent="tout doux"},m(e,t){L(e,n,t)},p:e,i:e,o:e,d(e){e&&R(n)}}}function hn(t){let n,i;return n=new cn({}),{c(){$e(n.$$.fragment)},m(e,t){be(n,e,t),i=!0},p:e,i(e){i||(ae(n.$$.fragment,e),i=!0)},o(e){ue(n.$$.fragment,e),i=!1},d(e){ve(n,e)}}}function $n(e){let t,n,i,s;return t=new ct({props:{store:Ne,nbOfPages:e[4]}}),i=new Vt({props:{$$slots:{default:[On]},$$scope:{ctx:e}}}),{c(){$e(t.$$.fragment),n=I(),$e(i.$$.fragment)},m(e,o){be(t,e,o),L(e,n,o),be(i,e,o),s=!0},p(e,n){const s={};16&n[0]&&(s.nbOfPages=e[4]),t.$set(s);const o={};99430&n[0]|524288&n[1]&&(o.$$scope={dirty:n,ctx:e}),i.$set(o)},i(e){s||(ae(t.$$.fragment,e),ae(i.$$.fragment,e),s=!0)},o(e){ue(t.$$.fragment,e),ue(i.$$.fragment,e),s=!1},d(e){ve(t,e),e&&R(n),ve(i,e)}}}function bn(e){let t,n,i={ctx:e,current:null,token:null,hasCatch:!0,pending:_n,then:Pn,catch:En,value:36,error:40,blocks:[,,,]};return ge(e[19],i),{c(){t=O("div"),i.block.c(),T(t,"class","grid is-gap-2")},m(e,s){L(e,t,s),i.block.m(t,i.anchor=null),i.mount=()=>t,i.anchor=null,n=!0},p(t,n){pe(i,e=t,n)},i(e){n||(ae(i.block),n=!0)},o(e){for(let e=0;e<3;e+=1){ue(i.blocks[e])}n=!1},d(e){e&&R(t),i.block.d(),i.token=null,i=null}}}function vn(t){let n,i,s,o=t[40]+"";return{c(){n=O("tr"),i=P("Error when retrieving paginated regions: "),s=P(o)},m(e,t){L(e,n,t),y(n,i),y(n,s)},p(e,t){32768&t[0]&&o!==(o=e[40]+"")&&j(s,o)},i:e,o:e,d(e){e&&R(n)}}}function wn(e){let t,n,i,s,o;const r=[kn,yn],l=[];function c(e,n){return 65536&n[0]&&(t=null),null==t&&(t=!!(Object.values(e[16]).length>0)),t?0:1}return n=c(e,[-1,-1]),i=l[n]=r[n](e),{c(){i.c(),s=C()},m(e,t){l[n].m(e,t),L(e,s,t),o=!0},p(e,t){let o=n;n=c(e,t),n===o?l[n].p(e,t):(le(),ue(l[o],1,1,(()=>{l[o]=null})),ce(),i=l[n],i?i.p(e,t):(i=l[n]=r[n](e),i.c()),ae(i,1),i.m(s.parentNode,s))},i(e){o||(ae(i),o=!0)},o(e){ue(i),o=!1},d(e){l[n].d(e),e&&R(s)}}}function yn(e){let t,n,i;return n=new mt({props:{appLang:e[1],modules:e[5],witness:e[6]}}),{c(){t=O("tr"),$e(n.$$.fragment)},m(e,s){L(e,t,s),be(n,t,null),i=!0},p(e,t){const i={};2&t[0]&&(i.appLang=e[1]),32&t[0]&&(i.modules=e[5]),64&t[0]&&(i.witness=e[6]),n.$set(i)},i(e){i||(ae(n.$$.fragment,e),i=!0)},o(e){ue(n.$$.fragment,e),i=!1},d(e){e&&R(t),ve(n)}}}function kn(e){let t,n,i=Object.entries(e[16]),s=[];for(let t=0;t<i.length;t+=1)s[t]=Rn(un(e,i,t));const o=e=>ue(s[e],1,1,(()=>{s[e]=null}));return{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=C()},m(e,i){for(let t=0;t<s.length;t+=1)s[t]&&s[t].m(e,i);L(e,t,i),n=!0},p(e,n){if(50398214&n[0]){let r;for(i=Object.entries(e[16]),r=0;r<i.length;r+=1){const o=un(e,i,r);s[r]?(s[r].p(o,n),ae(s[r],1)):(s[r]=Rn(o),s[r].c(),ae(s[r],1),s[r].m(t.parentNode,t))}for(le(),r=i.length;r<s.length;r+=1)o(r);ce()}},i(e){if(!n){for(let e=0;e<i.length;e+=1)ae(s[e]);n=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)ue(s[e]);n=!1},d(e){S(s,e),e&&R(t)}}}function xn(e,t){let n,i,s;return i=new Je({props:{item:t[37],appLang:t[1],isSquare:!1,isCopied:t[10](t[37])}}),i.$on("copyRef",t[25]),{key:e,first:null,c(){n=C(),$e(i.$$.fragment),this.first=n},m(e,t){L(e,n,t),be(i,e,t),s=!0},p(e,n){t=e;const s={};65536&n[0]&&(s.item=t[37]),2&n[0]&&(s.appLang=t[1]),66560&n[0]&&(s.isCopied=t[10](t[37])),i.$set(s)},i(e){s||(ae(i.$$.fragment,e),s=!0)},o(e){ue(i.$$.fragment,e),s=!1},d(e){e&&R(n),ve(i,e)}}}function Ln(e){let t,n,i=[],s=new Map,o=Object.values(e[42]);const r=e=>e[37].id;for(let t=0;t<o.length;t+=1){let n=dn(e,o,t),l=r(n);s.set(l,i[t]=xn(l,n))}return{c(){for(let e=0;e<i.length;e+=1)i[e].c();t=I()},m(e,s){for(let t=0;t<i.length;t+=1)i[t]&&i[t].m(e,s);L(e,t,s),n=!0},p(e,n){33620994&n[0]&&(o=Object.values(e[42]),le(),i=he(i,n,r,1,e,o,s,t.parentNode,me,xn,t,dn),ce())},i(e){if(!n){for(let e=0;e<o.length;e+=1)ae(i[e]);n=!0}},o(e){for(let e=0;e<i.length;e+=1)ue(i[e]);n=!1},d(e){for(let t=0;t<i.length;t+=1)i[t].d(e);e&&R(t)}}}function Rn(e){let t,n;return t=new tt({props:{canvasImg:e[24](e[41]),canvasNb:e[41],manifest:e[2],$$slots:{default:[Ln]},$$scope:{ctx:e}}}),{c(){$e(t.$$.fragment)},m(e,i){be(t,e,i),n=!0},p(e,n){const i={};65536&n[0]&&(i.canvasImg=e[24](e[41])),65536&n[0]&&(i.canvasNb=e[41]),4&n[0]&&(i.manifest=e[2]),66562&n[0]|524288&n[1]&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(ae(t.$$.fragment,e),n=!0)},o(e){ue(t.$$.fragment,e),n=!1},d(e){ve(t,e)}}}function Sn(t){let n,i,s="en"===t[1]?"Retrieving paginated regions...":"Récupération des pages...";return{c(){n=O("tr"),i=P(s),T(n,"class","faded is-center")},m(e,t){L(e,n,t),y(n,i)},p(e,t){2&t[0]&&s!==(s="en"===e[1]?"Retrieving paginated regions...":"Récupération des pages...")&&j(i,s)},i:e,o:e,d(e){e&&R(n)}}}function On(e){let t,n,i,s={ctx:e,current:null,token:null,hasCatch:!0,pending:Sn,then:wn,catch:vn,value:36,error:40,blocks:[,,,]};return ge(n=e[15],s),{c(){t=C(),s.block.c()},m(e,n){L(e,t,n),s.block.m(e,s.anchor=n),s.mount=()=>t.parentNode,s.anchor=t,i=!0},p(t,i){e=t,s.ctx=e,32768&i[0]&&n!==(n=e[15])&&ge(n,s)||pe(s,e,i)},i(e){i||(ae(s.block),i=!0)},o(e){for(let e=0;e<3;e+=1){ue(s.blocks[e])}i=!1},d(e){e&&R(t),s.block.d(e),s.token=null,s=null}}}function En(t){let n,i,s,o=t[40]+"";return{c(){n=O("div"),i=P("Error when retrieving regions: "),s=P(o)},m(e,t){L(e,n,t),y(n,i),y(n,s)},p:e,i:e,o:e,d(e){e&&R(n)}}}function Pn(e){let t,n,i=[],s=new Map,o=Object.values(e[14]);const r=e=>e[37].id;for(let t=0;t<o.length;t+=1){let n=fn(e,o,t),l=r(n);s.set(l,i[t]=Cn(l,n))}let l=null;return o.length||(l=In(e)),{c(){for(let e=0;e<i.length;e+=1)i[e].c();t=C(),l&&l.c()},m(e,s){for(let t=0;t<i.length;t+=1)i[t]&&i[t].m(e,s);L(e,t,s),l&&l.m(e,s),n=!0},p(e,n){46154850&n[0]&&(o=Object.values(e[14]),le(),i=he(i,n,r,1,e,o,s,t.parentNode,me,Cn,t,fn),ce(),!o.length&&l?l.p(e,n):o.length?l&&(le(),ue(l,1,1,(()=>{l=null})),ce()):(l=In(e),l.c(),ae(l,1),l.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<o.length;e+=1)ae(i[e]);n=!0}},o(e){for(let e=0;e<i.length;e+=1)ue(i[e]);n=!1},d(e){for(let t=0;t<i.length;t+=1)i[t].d(e);e&&R(t),l&&l.d(e)}}}function In(e){let t,n;return t=new mt({props:{appLang:e[1],modules:e[5],witness:e[6],currentRegionId:e[23],baseUrl:e[22]}}),{c(){$e(t.$$.fragment)},m(e,i){be(t,e,i),n=!0},p(e,n){const i={};2&n[0]&&(i.appLang=e[1]),32&n[0]&&(i.modules=e[5]),64&n[0]&&(i.witness=e[6]),t.$set(i)},i(e){n||(ae(t.$$.fragment,e),n=!0)},o(e){ue(t.$$.fragment,e),n=!1},d(e){ve(t,e)}}}function Cn(e,t){let n,i,s;return i=new Je({props:{item:t[37],appLang:t[1],isCopied:t[10](t[37])}}),i.$on("copyRef",t[25]),{key:e,first:null,c(){n=C(),$e(i.$$.fragment),this.first=n},m(e,t){L(e,n,t),be(i,e,t),s=!0},p(e,n){t=e;const s={};16384&n[0]&&(s.item=t[37]),2&n[0]&&(s.appLang=t[1]),17408&n[0]&&(s.isCopied=t[10](t[37])),i.$set(s)},i(e){s||(ae(i.$$.fragment,e),s=!0)},o(e){ue(i.$$.fragment,e),s=!1},d(e){e&&R(n),ve(i,e)}}}function _n(t){let n,i,s="en"===t[1]?"Retrieving regions...":"Récupération des régions...";return{c(){n=O("div"),i=P(s),T(n,"class","faded is-center")},m(e,t){L(e,n,t),y(n,i)},p(e,t){2&t[0]&&s!==(s="en"===e[1]?"Retrieving regions...":"Récupération des régions...")&&j(i,s)},i:e,o:e,d(e){e&&R(n)}}}function Nn(e){let t,n,i="en"===e[1]?"No regions in selection":"Aucune région sélectionnée";return{c(){t=O("div"),n=P(i)},m(e,i){L(e,t,i),y(t,n)},p(e,t){2&t[0]&&i!==(i="en"===e[1]?"No regions in selection":"Aucune région sélectionnée")&&j(n,i)},d(e){e&&R(t)}}}function Tn(e){let t,n,i=Object.entries(e[8]),s=[];for(let t=0;t<i.length;t+=1)s[t]=jn(an(e,i,t));return{c(){t=O("div"),n=O("div");for(let e=0;e<s.length;e+=1)s[e].c();T(n,"class","grid is-gap-2"),T(t,"class","fixed-grid has-6-cols")},m(e,i){L(e,t,i),y(t,n);for(let e=0;e<s.length;e+=1)s[e]&&s[e].m(n,null)},p(e,t){if(257&t[0]){let o;for(i=Object.entries(e[8]),o=0;o<i.length;o+=1){const r=an(e,i,o);s[o]?s[o].p(r,t):(s[o]=jn(r),s[o].c(),s[o].m(n,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=i.length}},d(e){e&&R(t),S(s,e)}}}function jn(e){let t,n,i,s,o,r,l,a,u,d,f,g,p,m=e[33].title+"";function h(){return e[30](e[32])}return{c(){t=O("div"),n=O("figure"),i=O("img"),o=I(),r=O("div"),l=O("span"),a=P(m),u=I(),d=O("button"),f=I(),c(i.src,s=Ee(e[33].img,e[33].xyhw,"96,"))||T(i,"src",s),T(i,"alt","Extracted region"),T(l,"class","overlay-desc"),T(r,"class","overlay is-center svelte-403wty"),T(n,"class","image is-64x64 card"),T(d,"class","delete region-btn"),T(d,"aria-label","remove from selection"),T(t,"class","selection cell svelte-403wty")},m(e,s){L(e,t,s),y(t,n),y(n,i),y(n,o),y(n,r),y(r,l),y(l,a),y(t,u),y(t,d),y(t,f),g||(p=_(d,"click",h),g=!0)},p(t,n){e=t,256&n[0]&&!c(i.src,s=Ee(e[33].img,e[33].xyhw,"96,"))&&T(i,"src",s),256&n[0]&&m!==(m=e[33].title+"")&&j(a,m)},d(e){e&&R(t),g=!1,p()}}}function An(e){let t,n,i,s,o,r,l,c,a,u,d,f,g,p,m,h,$,b,v,w,k,x,E,C,_,N,A,V,q,M,U,z,D,H,F,B,J,X,K,G="en"===e[1]?"Selected regions":"Regions sélectionnées";t=new qe({props:{visible:e[13]}}),i=new dt({props:{appLang:e[1]}}),o=new Ge({props:{selectionLength:e[7],appLang:e[1]}}),u=new kt({props:{appLang:e[1],witness:e[6],baseUrl:e[22],currentRegionId:e[23]}}),g=new Nt({props:{appLang:e[1],manifest:e[2],isValidated:e[3],regionsType:e[0]}});let Q=Object.entries(e[9]),Y=[];for(let t=0;t<Q.length;t+=1)Y[t]=pn(gn(e,Q,t));const W=[bn,$n,hn,mn],Z=[];function ee(e,t){return"all"===e[11]?0:"page"===e[11]?1:"similarity"===e[11]?2:"vectorization"===e[11]?3:-1}function te(e,t){return e[12]?Tn:Nn}~(b=ee(e))&&(v=Z[b]=W[b](e));let ne=te(e),ie=ne(e);return X=new We({props:{appLang:e[1],isRegion:!0}}),{c(){$e(t.$$.fragment),n=I(),$e(i.$$.fragment),s=I(),$e(o.$$.fragment),r=I(),l=O("div"),c=O("div"),a=O("div"),$e(u.$$.fragment),d=I(),f=O("div"),$e(g.$$.fragment),p=I(),m=O("div"),h=O("ul");for(let e=0;e<Y.length;e+=1)Y[e].c();$=I(),v&&v.c(),w=I(),k=O("div"),x=O("div"),E=I(),C=O("div"),_=O("div"),N=O("div"),A=O("i"),V=I(),q=P(G),M=P("\n                ("),U=P(e[7]),z=P(")"),D=I(),H=O("button"),F=I(),B=O("section"),ie.c(),J=I(),$e(X.$$.fragment),T(a,"class","cell is-right is-middle"),T(f,"class","cell"),T(c,"class","actions grid"),T(h,"class","panel-tabs"),T(m,"class","tabs is-centered"),T(l,"id","nav-actions"),T(l,"class","mb-5 svelte-403wty"),T(x,"class","modal-background"),T(A,"class","fa-solid fa-book-bookmark"),T(N,"class","title is-4 mb-0 media-content"),T(H,"class","delete media-left"),T(H,"aria-label","close"),T(_,"class","modal-card-head media mb-0"),T(B,"class","modal-card-body"),T(C,"class","modal-content"),T(k,"id","selection-modal"),T(k,"class","modal fade"),T(k,"tabindex","-1"),T(k,"aria-labelledby","selection-modal-label"),T(k,"aria-hidden","true")},m(e,v){be(t,e,v),L(e,n,v),be(i,e,v),L(e,s,v),be(o,e,v),L(e,r,v),L(e,l,v),y(l,c),y(c,a),be(u,a,null),y(c,d),y(c,f),be(g,f,null),y(l,p),y(l,m),y(m,h);for(let e=0;e<Y.length;e+=1)Y[e]&&Y[e].m(h,null);L(e,$,v),~b&&Z[b].m(e,v),L(e,w,v),L(e,k,v),y(k,x),y(k,E),y(k,C),y(C,_),y(_,N),y(N,A),y(N,V),y(N,q),y(N,M),y(N,U),y(N,z),y(_,D),y(_,H),y(C,F),y(C,B),ie.m(B,null),y(C,J),be(X,C,null),K=!0},p(e,n){const s={};8192&n[0]&&(s.visible=e[13]),t.$set(s);const r={};2&n[0]&&(r.appLang=e[1]),i.$set(r);const l={};128&n[0]&&(l.selectionLength=e[7]),2&n[0]&&(l.appLang=e[1]),o.$set(l);const c={};2&n[0]&&(c.appLang=e[1]),64&n[0]&&(c.witness=e[6]),u.$set(c);const a={};if(2&n[0]&&(a.appLang=e[1]),4&n[0]&&(a.manifest=e[2]),8&n[0]&&(a.isValidated=e[3]),g.$set(a),2560&n[0]){let t;for(Q=Object.entries(e[9]),t=0;t<Q.length;t+=1){const i=gn(e,Q,t);Y[t]?Y[t].p(i,n):(Y[t]=pn(i),Y[t].c(),Y[t].m(h,null))}for(;t<Y.length;t+=1)Y[t].d(1);Y.length=Q.length}let d=b;b=ee(e),b===d?~b&&Z[b].p(e,n):(v&&(le(),ue(Z[d],1,1,(()=>{Z[d]=null})),ce()),~b?(v=Z[b],v?v.p(e,n):(v=Z[b]=W[b](e),v.c()),ae(v,1),v.m(w.parentNode,w)):v=null),(!K||2&n[0])&&G!==(G="en"===e[1]?"Selected regions":"Regions sélectionnées")&&j(q,G),(!K||128&n[0])&&j(U,e[7]),ne===(ne=te(e))&&ie?ie.p(e,n):(ie.d(1),ie=ne(e),ie&&(ie.c(),ie.m(B,null)));const f={};2&n[0]&&(f.appLang=e[1]),X.$set(f)},i(e){K||(ae(t.$$.fragment,e),ae(i.$$.fragment,e),ae(o.$$.fragment,e),ae(u.$$.fragment,e),ae(g.$$.fragment,e),ae(v),ae(X.$$.fragment,e),K=!0)},o(e){ue(t.$$.fragment,e),ue(i.$$.fragment,e),ue(o.$$.fragment,e),ue(u.$$.fragment,e),ue(g.$$.fragment,e),ue(v),ue(X.$$.fragment,e),K=!1},d(e){ve(t,e),e&&R(n),ve(i,e),e&&R(s),ve(o,e),e&&R(r),e&&R(l),ve(u),ve(g),S(Y,e),e&&R($),~b&&Z[b].d(e),e&&R(w),e&&R(k),ie.d(),ve(X)}}}const Vn=()=>null;function qn(e,t,n){let i,s,o,r,l,c,a,d,f,g,p;u(e,Se,(e=>n(13,d=e)));const{selected:m}=_e;u(e,m,(e=>n(28,a=e)));const{allRegions:h,fetchAll:$,pageRegions:b,fetchPages:v}=Ne;u(e,h,(e=>n(14,f=e))),u(e,b,(e=>n(16,p=e))),u(e,v,(e=>n(15,g=e)));const w="Regions";let{appLang:y="en"}=t,{manifest:k=""}=t,{isValidated:x=!1}=t,{imgPrefix:L=""}=t,{nbOfPages:R=1}=t,{modules:S=[]}=t,{witness:O={}}=t;const E=`${window.location.origin}${window.location.pathname}`,P=parseInt(E.split("regions/")[1].replace("/",""));const I={all:{text:"en"===y?"All regions":"Toutes les régions"},page:{text:"en"===y?"Per page":"Par page"}};S.includes("similarity")&&(I.similarity={text:"en"===y?"Similarity":"Similarité"}),S.includes("vectorization")&&(I.vectorization={text:"en"===y?"Vectorization":"Vectorisation"});return e.$$set=e=>{"appLang"in e&&n(1,y=e.appLang),"manifest"in e&&n(2,k=e.manifest),"isValidated"in e&&n(3,x=e.isValidated),"imgPrefix"in e&&n(26,L=e.imgPrefix),"nbOfPages"in e&&n(4,R=e.nbOfPages),"modules"in e&&n(5,S=e.modules),"witness"in e&&n(6,O=e.witness)},e.$$.update=()=>{268435456&e.$$.dirty[0]&&n(8,i=a(!0)),256&e.$$.dirty[0]&&n(7,s=Object.keys(i).length),128&e.$$.dirty[0]&&n(12,o=s>0),134217728&e.$$.dirty[0]&&n(10,c=e=>l===e.ref)},n(11,r="all"),n(27,l=""),[w,y,k,x,R,S,O,s,i,I,c,r,o,d,f,g,p,m,h,$,b,v,E,P,function(e){return`${L}_${t=e,n=String(R).length+1,t.toString().padStart(n,"0")}`;var t,n},function(e){const{item:t}=e.detail,i=c(t)?"":t.ref;navigator.clipboard.writeText(i),n(27,l=i)},L,l,a,e=>n(11,r=e),e=>_e.remove(e,w)]}return new class extends ke{constructor(e){super(),ye(this,e,qn,An,r,{regionsType:0,appLang:1,manifest:2,isValidated:3,imgPrefix:26,nbOfPages:4,modules:5,witness:6},null,[-1,-1])}get regionsType(){return this.$$.ctx[0]}}({target:document.getElementById("region-list"),props:{witness:witness,regionsType:"Regions",appLang:APP_LANG,modules:ADDITIONAL_MODULES,manifest:manifest,isValidated:isValidated,imgPrefix:imgPrefix,nbOfPages:nbOfPages}})}();
//# sourceMappingURL=regionList.js.map
